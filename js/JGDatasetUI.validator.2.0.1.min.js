(function(d,f,b){if(b===undefined){console.error("can't not initialize JGValidator, JGDataset UI not found");return;}function g(k,j){for(var i in k){if(i.toUpperCase()===j.toUpperCase()){return k[i];}}return undefined;}function a(j){var k=0;for(var i in j){if(j.hasOwnProperty(i)){++k;}}return k;}function c(j,l){var k=0;for(var i in j){if(j.hasOwnProperty(i)){if(k===l){return j[i];}++k;}}return undefined;}_JGKeyword=f.extend(true,_JGKeyword,{validator:{errorColumn:"jg-error-column"}});var h=d.JGValidator=(function(k){this._datasetUI=k;this._engine=f.extend(true,{},h.prototype._engine);this._failedMessages=f.extend(true,{},h.prototype._failedMessages);this._validators={};this._cause={};this._onValidate=false;var i=this;var j=this.dataset();f(j).on(_JGKeyword.trigger._columnValueChanged,function(l,n,m){if(i._options.realtimeCheck){i._singleValidate(n,m,function(){});}});f(j).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved+" "+_JGKeyword.trigger._rowInserted+" "+_JGKeyword.trigger._rowRemoved+" "+_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged,function(l,m){i.refresh();});this.refresh();});h.prototype.datasetUI=(function(){return this._datasetUI;});h.prototype.dataset=(function(){return this._datasetUI.dataset();});h.prototype.isValid=(function(){var k=this.dataset();var o=k.getRowCount();var l=this._validators;for(var n in this._validators){var i=this._cause[n];if(i===undefined){return false;}var p=this._validators[n];if(o!==i.length){return false;}for(var j in i){var m=i[j];if(isNull(m)||a(m)>0){return false;}}}return true;});h.prototype.engine=(function(i){if(i!==undefined){this._engine=f.extend(true,this._engine,i);}return this._engine;});h.prototype.failedMessages=(function(i){if(i!==undefined){this._failedMessages=f.extend(true,this._failedMessages,i);}return this._failedMessages;});h.prototype.commonFailedMessages=(function(i){if(i!==undefined){this._commonFailedMessages=f.extend(true,this._commonFailedMessages,i);}return this._commonFailedMessages;});h.prototype.cause=(function(){var i={};for(var k in this._cause){i[k]={};for(var j=this._cause[k].length-1;j>=0;--j){if(a(this._cause[k][j])>0){i[k][j]=this._cause[k][j];}}if(a(i[k])===0){delete i[k];}}return i;});h.prototype.refresh=(function(){this._validators={};this._cause={};var i=this.datasetUI();var j=this.dataset();var k=i._originalRowContent;var l=j.getColumnCount();for(var m=0;m<l;++m){var p=j.getColumn(m).getName();var q=k.find("*["+_JGKeyword.ui.attrColumn+"]").filter(function(){return f(this).attr(_JGKeyword.ui.attrColumn).toUpperCase()===p;});this._validators[p]={};var o=q.filter(function(){return f(this).attr("required")!==undefined;});var s=o.length;for(var r=0;r<s;++r){this._validators[p].required={name:"required"};}o=q.filter(function(){return f(this).attr("maxLength")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].maxLength={name:"maxLength",length:parseInt(t.attr("maxLength"))};}o=q.filter(function(){return f(this).attr("minLength")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].minLength={name:"minLength",length:parseInt(t.attr("minLength"))};}o=q.filter(function(){return f(this).attr("length")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].length={name:"length",length:parseInt(t.attr("length"))};}o=q.filter(function(){return f(this).attr("equals")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].equals={name:"equals",value:t.attr("equals")};}o=q.filter(function(){return f(this).attr("notEquals")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].equals={name:"notEquals",value:t.attr("notEquals")};}o=q.filter(function(){return f(this).attr("range")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));var u=t.attr("range").split(",");this._validators[p].range={name:"range",from:parseInt(u[0]),to:parseInt(u[1])};}o=q.filter(function(){return f(this).attr("rangeLength")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));var u=t.attr("rangeLength").split(",");this._validators[p].rangeLength={name:"rangeLength",from:parseInt(u[0]),to:parseInt(u[1])};}o=q.filter(function(){return f(this).attr("pattern")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].pattern={name:"pattern",pattern:t.attr("pattern")};}o=q.filter(function(){return f(this).attr("patternWord")!==undefined;});s=o.length;for(var r=0;r<s;++r){this._validators[p].patternWord={name:"patternWord"};}o=q.filter(function(){return f(this).attr("patternAlphabet")!==undefined;});s=o.length;for(var r=0;r<s;++r){this._validators[p].patternAlphabet={name:"patternAlphabet"};}o=q.filter(function(){return f(this).attr("patternAlphanum")!==undefined;});s=o.length;for(var r=0;r<s;++r){this._validators[p].patternAlphanum={name:"patternAlphanum"};}o=q.filter(function(){return f(this).attr("patternEmail")!==undefined;});s=o.length;for(var r=0;r<s;++r){this._validators[p].patternEmail={name:"patternEmail"};}o=q.filter(function(){return f(this).attr("patternNumber")!==undefined;});s=o.length;for(var r=0;r<s;++r){this._validators[p].patternNumber={name:"patternNumber"};}o=q.filter(function(){return f(this).attr("patternPhone")!==undefined;});s=o.length;for(var r=0;r<s;++r){this._validators[p].patternPhone={name:"patternPhone"};}o=q.filter(function(){return f(this).attr("columnEquals")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].columnEquals={name:"columnEquals",value:t.attr("columnEquals")};}o=q.filter(function(){return f(this).attr("columnNotEquals")!==undefined;});s=o.length;for(var r=0;r<s;++r){var t=f(o.get(r));this._validators[p].columnNotEquals={name:"columnNotEquals",value:t.attr("columnNotEquals")};}var n=this;o=q.each(function(){var z=f(this).get(0).attributes;var v=z.length;for(var A=0;A<v;++A){var w=z[A];var x="(custom\\-validator\\-)+";if(new RegExp(x,"gi").test(w.name)){var y=w.name.replace("custom-validator-","");n._validators[p][y]={name:y,value:w.value};}}});this.validate(function(){});}});h.prototype._recursiveSingleValidate=(function(q,s,i,o){var m=this;var k=this.datasetUI();var l=this.dataset();var p=l.getColumnValue(q,s);var v=g(this._validators,q);o=NVL(o,function(){});var n=this._cause[q]=NVL(this._cause[q],[]);this._cause[q][s]=f.extend(true,this._cause[q][s],{});if(isNull(v)){var j=this.cause()[q];o.apply(k.element(),[j===undefined?null:j[s]]);return;}i=NVL(i,0);var u=a(v);if(i===u){var j=this.cause()[q];o.apply(k.element(),[j===undefined?null:j[s]]);return;}var r=c(v,i);var w=r.name.toLowerCase();var t=g(this._engine,w);if(isNull(t)){this._recursiveSingleValidate(q,s,i+1,o);return;}t.apply(l,[r,q,s,p,function(y){if(!y){var x={name:r.name};n[s][r.name]=x;if(m._options.stepValidation){i=u-1;}}else{delete n[s][r.name];}m._recursiveSingleValidate(q,s,i+1,o);}]);});h.prototype._singleValidate=(function(l,j,k){var i=this;this._recursiveSingleValidate(l.toUpperCase(),j,0,function(){i._updateErrorLabels();k.apply(i.datasetUI().element(),arguments);});});h.prototype._recursiveValidate=(function(n,l,m){var i=this;var k=this.datasetUI();var j=this.dataset();var p=j.getColumnCount();var o=j.getRowCount();n=NVL(n,0);l=NVL(l,0);m=NVL(m,function(){});if(n===p){m.apply(k.element(),[this.isValid(),this.cause()]);return;}else{if(n<p&&l===o){this._recursiveValidate(n+1,0,m);return;}else{this._singleValidate(j.getColumn(n).getName(),l,function(q){i._recursiveValidate(n,l+1,m);});return;}}});h.prototype.validate=(function(i){this._recursiveValidate(0,0,i);});h.prototype._updateErrorLabels=(function(){var l=this.datasetUI();var w=this.dataset();var y=w.getRowCount();for(var x=0;x<y;++x){var r=l.rowContent(x).rowContent();if(isNull(r)){continue;}var A=r.find("["+_JGKeyword.validator.errorColumn+"]");A.hide();A.html("");}var n=this.cause();for(var p in n){var i=n[p];for(var x in i){var v=i[x];var r=l.rowContent(x).rowContent();if(isNull(r)){continue;}var A=r.find("["+_JGKeyword.validator.errorColumn+"]").filter(function(){return(p.toUpperCase()===f(this).attr(_JGKeyword.validator.errorColumn).toUpperCase());});for(var t in v){var o="";var u=g(this._failedMessages,p);if(!isNull(u)){var m=g(u,t);if(!isNull(m)){o=m;}}if(isNull(o)||o.length===0){o=BLK(g(this._commonFailedMessages,t));}var s=(function(B){return new RegExp("\\{("+B+")\\}","gi");});o=o.replace(s("columnName"),p);o=o.replace(s("rowIndex"),x);o=o.replace(s("columnValue"),w.getColumnValue(p,x));for(var z in this._validators[p][t]){o=o.replace(s(z),this._validators[p][t][z]);}if(o.length>0){var q=A.length;for(var k=0;k<q;++k){var j=f(A[k]);j.show();o=f(this._options.errorMessageTag).html(o);if(NVL(this._options.appendErrorMessage,false)){j.append(o);}else{j.html(o);}}}}}}});h.prototype._options={errorMessageTag:"<span style='display:block;' />",appendErrorMessage:true,stepValidation:true,realtimeCheck:true};h.prototype.options=(function(){if(f.type(arguments[0])==="string"){if(arguments.length===2){this._options[arguments[0]]=arguments[1];if(arguments[0]==="errorMessageTag"||arguments[0]==="appendErrorMessage"){this._updateErrorLabels();}}return this._options[arguments[0]];}else{if(f.type(arguments[0])==="object"){this._options=f.extend(true,this._options,arguments[0]);this.refresh();}}return this._options;});h.prototype._commonFailedMessages={required:"field is required",maxLength:"max length : {length}",minLength:"min length : {length}",length:"length : {length}",range:"range : {from} ~ {to}",rangeLength:"length : {from} ~ {to}",equals:"equals : {value}",notEquals:"not equals : {value}",pattern:"pattern : {pattern}",patternWord:"pattern word",patternAlphabet:"pattern alphabet",patternAlphanum:"pattern alphanum",patternEmail:"pattern email",patternNumber:"pattern number",patternPhone:"pattern phone",columnEquals:"column be equals to {value}",columnNotEquals:"column be not equals to {value}"};function e(l,i,j){var k=new RegExp(l,j);return k.test(BLK(i));}h.prototype._engine={_customValidate:function(m,l,i,k,j){this[m.name](m,l,i,k,j);},required:function(m,l,i,k,j){j(0<BLK(k).length);},maxLength:function(m,l,i,k,j){j(m.length>=BLK(k).length);},minLength:function(m,l,i,k,j){j(m.length<=BLK(k).length);},length:function(m,l,i,k,j){j(m.length===BLK(k).length);},range:function(n,m,i,l,k){var j=parseInt(l);k(n.from<=j&&n.to>=j);},rangeLength:function(n,m,j,l,k){var i=BLK(l).length;k(n.from<=i&&n.to>=i);},equals:function(m,l,i,k,j){j(m.value===k);},notEquals:function(m,l,i,k,j){j(m.value!==k);},pattern:function(m,l,i,k,j){j(e(m.pattern,k));},patternWord:function(m,l,i,k,j){j(e("^[\\w]+$",k));},patternAlphabet:function(m,l,i,k,j){j(e("^[a-zA-Z]+$",k));},patternAlphanum:function(m,l,i,k,j){j(e("^[0-9a-zA-Z]+$",k));},patternEmail:function(m,l,i,k,j){j(e("^[\\w\\-\\.]+@[\\w\\-\\.]+\\.[\\w]{1,5}$",k));},patternNumber:function(m,l,i,k,j){j(e("^[\\-]?[0-9]+$",k));},patternPhone:function(m,l,i,k,j){j(e("^(\\+?\\d{0,2}\\s?\\d{2,3}\\s?\\-?\\s?\\d{3,4}\\s?\\-?\\s?\\d{4})$",k));},columnEquals:function(n,m,i,l,j){var k=n.value;j(BLK(this.getColumnValue(k,i))===BLK(l));},columnNotEquals:function(n,m,i,l,j){var k=n.value;j(BLK(this.getColumnValue(k,i))!==BLK(l));}};f.fn._jgValidator=(function(i){if(i!==undefined){this.data("jgdataset_jgValidator",i);}return this.data("jgdataset_jgValidator");});f.fn._jgValidatorInitialized=(function(i){if(i!==undefined){this.data("jgdataset_jgValidatorInitialized",i);}return NVL(this.data("jgdataset_jgValidatorInitialized"),false);});f.fn.JGValidator=(function(){if(!this._jgValidatorInitialized()){this._jgValidator(new h(this.JGDatasetUI()));this._jgValidatorInitialized(true);}return JGSelector(this._jgValidator(),arguments);});})(window,jQuery,JGDatasetUI);