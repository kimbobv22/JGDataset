!function(t,e){var a={value:function(t,a){if("number"===e.type(a)){var r,n=0;return e.each(t,function(e){return n===a?(r=t[e],!1):void++n}),r}var r,i=a.toUpperCase();return e.each(t,function(e,a){return e.toUpperCase()===i?(r=t[e],!1):void 0}),r},key:function(t,a){var r,n=0;return e.each(t,function(t){return n===a?(r=t,!1):void++n}),r},length:function(t){var a=0;return e.each(t,function(t){++a}),a}};_JGKeyword=e.extend(!0,_JGKeyword,{validator:{failedColumn:"jg-failed-column",validColumn:"jg-valid-column",failedLabelLastDisplay:"jgValidatorUI_failedLabel_lastDisplay",validLabelLastDisplay:"jgValidatorUI_validLabel_lastDisplay",trigger:{rowValidationChange:"rowvalidationchange"}}});var r=t.JGValidatorRow=function(t,e){this._validator=t,this._errorLabels=new Array,this._validLabels=new Array,this._lastCause=null,this.rowContent(e)};r.prototype.validator=function(){return this._validator},r.prototype.dataset=function(){return this._validator.datasetUI().dataset()},r.prototype.rowContent=function(t){return void 0!==t&&(this._rowContent=t,this.reload()),this._rowContent},r.prototype.reload=function(){this._errorLabels.removeAll(),this._validLabels.removeAll();var t=this._rowContent.rowContent(),a=this;t.find("*["+_JGKeyword.validator.failedColumn+"]").each(function(){a._errorLabels.push(e(this))}),t.find("*["+_JGKeyword.validator.validColumn+"]").each(function(){a._validLabels.push(e(this))}),this.validate(function(){})},r.prototype.lastCause=function(){return this._lastCause},r.prototype.isValid=function(){var t=!0,a=isNull(this._lastCause)?!1:!0;return a&&e.each(this._lastCause,function(e){return this.length>0?t=!1:void 0}),t&&a},r.prototype.__rValidate=function(t,e,r,n,i,o){var s=a.length(t._validators);if(n>=s)return void o(r);var l=a.key(t._validators,n),d=t._validators[l],u=a.length(d);if(i>=u)return void this.__rValidate(t,e,r,n+1,0,o);l=l.toUpperCase();var h=this.rowContent().rowIndex(),p=e.getColumnValue(l,h),v=a.value(d,i),f=a.value(t._engine,v.name);if(!f)return console.error("can't find validation engine : "+v.name),void this.__rValidate(t,e,r,n,i+1,o);var g=this;f.apply(e,[v,l,h,p,function(a){void 0===r[l]&&(r[l]=new Array),a||r[l].push(v.name),!a&&BLK(t._options.stepValidation,!0)?(++n,i=0):++i,g.__rValidate(t,e,r,n,i,o)}])},r.prototype.validate=function(t){var a=this._validator,r=a.datasetUI(),n=r.dataset(),i=this._rowContent.rowIndex(),o=(a._validators,a._engine,this);this.__rValidate(a,n,{},0,0,function(a){var s=e.extend(!0,{},a);e.each(a,function(t){0===s[t].length&&delete s[t]}),o._lastCause=s,o.refresh();var l=o.isValid();l!==o.__lastValid&&r.element().trigger(_JGKeyword.validator.trigger.rowValidationChange,[l,i]),o.__lastValid=l,isNull(t)||t.apply(n,[l,o._lastCause])})},r.prototype.refresh=function(){var t=this,r=this.dataset(),n=t.validator(),i=this.rowContent().rowIndex(),o=this.lastCause();e.each(this._errorLabels,function(){var t=this.attr(_JGKeyword.validator.failedColumn);if(t.indexOf(",")>=0)t=t.split(",");else{var s=t;t=new Array,t.push(s)}for(var l=t.length,d=0;l>d;++d){var u=t[d].toUpperCase(),h=o[u.toUpperCase()];if(void 0===h){var p=n._options.animateFailedLabelHide;!isNull(p)&&BLK(this.data(_JGKeyword.validator.failedLabelLastDisplay),!0)&&(this.data(_JGKeyword.validator.failedLabelLastDisplay,!1),p.apply(this,[h,r,u,i]))}else{var v=a.length(h);this.empty();for(var f=0;v>f;++f){var g=a.value(h,f),_=n.failedMessage(u,g);isNull(_)&&(_=NVL(n.commonFailedMessage(g),""));var c=function(t){return new RegExp("\\{("+t+")\\}","gi")};_=_.replace(c("columnName"),u),_=_.replace(c("rowIndex"),i),_=_.replace(c("columnValue"),r.getColumnValue(u,i));var m=n._validator(u,g);e.each(m,function(t,e){_=_.replace(c(t),e)});var y=e(n._options.failedMessageTag);if(y.html(_),this.append(y),NVL(n.options.stepValidation,!1))break}var p=n._options.animateFailedLabelShow;isNull(p)||BLK(this.data(_JGKeyword.validator.failedLabelLastDisplay),!1)||(this.data(_JGKeyword.validator.failedLabelLastDisplay,!0),p.apply(this,[h,r,u,i]))}}}),e.each(this._validLabels,function(){var t=this.attr(_JGKeyword.validator.validColumn);if(t.indexOf(",")>=0)t=t.split(",");else{var e=t;t=new Array,t.push(e)}for(var a=t.length,s=0;a>s;++s){var l=t[s].toUpperCase(),d=o[l];if(void 0===d){var u=n._options.animateValidLabelShow;isNull(u)||BLK(this.data(_JGKeyword.validator.validLabelLastDisplay),!1)||(this.data(_JGKeyword.validator.validLabelLastDisplay,!0),u.apply(this,[d,r,l,i]))}else{var u=n._options.animateValidLabelHide;!isNull(u)&&BLK(this.data(_JGKeyword.validator.validLabelLastDisplay),!0)&&(this.data(_JGKeyword.validator.validLabelLastDisplay,!1),u.apply(this,[d,r,l,i]))}}})};var n=t.JGValidator=function(t,a){var r,i,o,s;a=NVL(a,{}),isNull(a.options)?o=a:(r=a.failedMessages,i=a.commonFailedMessages,o=a.options,s=a.engine),this._datasetUI=t,this._engine=e.extend(!0,n.prototype._engine,s),this._commonFailedMessages=e.extend(!0,n.prototype._commonFailedMessages,i),this._failedMessages=e.extend(!0,n.prototype._failedMessages,r),this._options=e.extend(!0,n.prototype._options,o),this._validators={},this._rows=new Array;var l=this.dataset(),d=this;e(l).on(_JGKeyword.trigger._rowInserted,function(t,e){d._insertValidatorRow(e)}),e(l).on(_JGKeyword.trigger._rowRemoved,function(t,e){d._removeValidatorRow(e)}),e(l).on(_JGKeyword.trigger._rowMoved,function(t,e,a){e>a?d.refresh(a,e):d.refresh(e,a)}),e(l).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved,function(t,e){d.refresh()}),e(l).on(_JGKeyword.trigger._columnValueChanged,function(t,e,a){d._options.realtimeCheck&&(isNull(d.__realtimeCheckTimeout)||clearTimeout(d.__realtimeCheckTimeout),d.__realtimeCheckTimeout=setTimeout(function(){d._rows[a].validate(),d.__realtimeCheckTimeout=null},BLK(d._options.realtimeCheckDelay,0)))}),e(l).on(_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(t,e,a){d.reload()}),this.reload()};n.prototype.datasetUI=function(){return this._datasetUI},n.prototype.dataset=function(){return this._datasetUI.dataset()},n.prototype.engine=function(t){return void 0!==t&&(this._engine=e.extend(!0,this._engine,t)),this._engine},n.prototype.failedMessages=function(t){return void 0!==t&&(this._failedMessages=e.extend(!0,this._failedMessages,t),this.refresh()),this._failedMessages},n.prototype.failedMessage=function(t,e){var r=a.value(this._failedMessages,t);return isNull(r)?void 0:a.value(r,e)},n.prototype.commonFailedMessages=function(t){return void 0!==t&&(this._commonFailedMessages=e.extend(!0,this._commonFailedMessages,t),this.refresh()),this._commonFailedMessages},n.prototype.commonFailedMessage=function(t){return a.value(this._commonFailedMessages,t)},n.prototype._validator=function(t,e){var r=a.value(this._validators,t);return isNull(r)?void 0:a.value(r,e)},n.prototype.lastCause=function(){for(var t=new Array,a=this._rows.length,r=0;a>r;++r){var n=this._rows[r];t[r]=e.extend({isValid:n.isValid()},n.lastCause())}return t},n.prototype.isValid=function(){var t=!0,a=this.lastCause();return e.each(a,function(){return this.isValid?void 0:t=!1}),t},n.prototype.reload=function(t){this._validators={};for(var a=this._datasetUI,r=a.dataset(),n=a._originalRowContent,i=r.getColumnCount(),o=0;i>o;++o){var s=r.getColumn(o).getName(),l=n.find("*["+_JGKeyword.ui.attrColumn+"]").filter(function(){return e(this).attr(_JGKeyword.ui.attrColumn).toUpperCase()===s});this._validators[s]={};for(var d=l.filter(function(){return void 0!==e(this).attr("required")}),u=d.length,h=0;u>h;++h)this._validators[s].required={name:"required"};d=l.filter(function(){return void 0!==e(this).attr("maxLength")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].maxLength={name:"maxLength",length:parseInt(p.attr("maxLength"))}}d=l.filter(function(){return void 0!==e(this).attr("minLength")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].minLength={name:"minLength",length:parseInt(p.attr("minLength"))}}d=l.filter(function(){return void 0!==e(this).attr("length")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].length={name:"length",length:parseInt(p.attr("length"))}}d=l.filter(function(){return void 0!==e(this).attr("equals")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].equals={name:"equals",value:p.attr("equals")}}d=l.filter(function(){return void 0!==e(this).attr("notEquals")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].notEquals={name:"notEquals",value:p.attr("notEquals")}}d=l.filter(function(){return void 0!==e(this).attr("range")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h)),v=p.attr("range").split(",");this._validators[s].range={name:"range",from:parseInt(v[0]),to:parseInt(v[1])}}d=l.filter(function(){return void 0!==e(this).attr("rangeLength")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h)),v=p.attr("rangeLength").split(",");this._validators[s].rangeLength={name:"rangeLength",from:parseInt(v[0]),to:parseInt(v[1])}}d=l.filter(function(){return void 0!==e(this).attr("pattern")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].pattern={name:"pattern",pattern:p.attr("pattern")}}d=l.filter(function(){return void 0!==e(this).attr("patternWord")}),u=d.length;for(var h=0;u>h;++h)this._validators[s].patternWord={name:"patternWord"};d=l.filter(function(){return void 0!==e(this).attr("patternAlphabet")}),u=d.length;for(var h=0;u>h;++h)this._validators[s].patternAlphabet={name:"patternAlphabet"};d=l.filter(function(){return void 0!==e(this).attr("patternAlphanum")}),u=d.length;for(var h=0;u>h;++h)this._validators[s].patternAlphanum={name:"patternAlphanum"};d=l.filter(function(){return void 0!==e(this).attr("patternEmail")}),u=d.length;for(var h=0;u>h;++h)this._validators[s].patternEmail={name:"patternEmail"};d=l.filter(function(){return void 0!==e(this).attr("patternNumber")}),u=d.length;for(var h=0;u>h;++h)this._validators[s].patternNumber={name:"patternNumber"};d=l.filter(function(){return void 0!==e(this).attr("patternPhone")}),u=d.length;for(var h=0;u>h;++h)this._validators[s].patternPhone={name:"patternPhone"};d=l.filter(function(){return void 0!==e(this).attr("columnEquals")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].columnEquals={name:"columnEquals",value:p.attr("columnEquals")}}d=l.filter(function(){return void 0!==e(this).attr("columnNotEquals")}),u=d.length;for(var h=0;u>h;++h){var p=e(d.get(h));this._validators[s].columnNotEquals={name:"columnNotEquals",value:p.attr("columnNotEquals")}}var f=this;d=l.each(function(){for(var t=e(this).get(0).attributes,a=t.length,r=0;a>r;++r){var n=t[r],i="(jg\\-validator\\-)+";if(new RegExp(i,"gi").test(n.name)){var o=n.name.replace("jg-validator-","");f._validators[s][o]={name:o,value:n.value}}}})}NVL(t,!0)&&this.reloadRow(),this.validate(function(){})},n.prototype.reloadRow=function(t,e){var a=this;a._rows.removeAll(),this.dataset().each(t,e,function(t){a._insertValidatorRow(t)})},n.prototype.refresh=function(t,e){var a=this;this.dataset().each(t,e,function(t){a._rows[t].refresh()})},n.prototype.__rValidate=function(t,a,r){var n=this.dataset().getRowCount();if(t>=n)return void r(a);var i=this;this._rows[t].validate(function(n,o){a[t]=e.extend({},o),a[t].isValid=n,i.__rValidate(t+1,a,r)})},n.prototype.validate=function(t){var e=this;this.__rValidate(0,new Array,function(a){e._lastCause=a,t(e.isValid(),a)})},n.prototype._insertValidatorRow=function(t){this._rows.insert(new r(this,this._datasetUI.rowContent(t)),t),this.refresh(t)},n.prototype._removeValidatorRow=function(t){this._rows.remove(t),this.refresh(t)},n.prototype._options={failedMessageTag:"<span style='display:block;' />",stepValidation:!0,realtimeCheck:!0,realtimeCheckDelay:200,animateFailedLabelShow:function(){this.stop(),this.fadeIn()},animateFailedLabelHide:function(){this.stop(),this.fadeOut()},animateValidLabelShow:function(){this.stop(),this.fadeIn()},animateValidLabelHide:function(){this.stop(),this.fadeOut()}},n.prototype.options=function(){return"string"===e.type(arguments[0])?(2===arguments.length&&(this._options[arguments[0]]=arguments[1],"failedMessageTag"===arguments[0]&&this.refresh()),this._options[arguments[0]]):("object"===e.type(arguments[0])&&(this._options=e.extend(!0,this._options,arguments[0]),this.refresh()),this._options)},n.prototype._engine={required:function(t,e,a,r,n){n(0<BLK(r).length)},maxLength:function(t,e,a,r,n){n(t.length>=BLK(r).length)},minLength:function(t,e,a,r,n){n(t.length<=BLK(r).length)},length:function(t,e,a,r,n){n(t.length===BLK(r).length)},range:function(t,e,a,r,n){var i=parseInt(r);n(t.from<=i&&t.to>=i)},rangeLength:function(t,e,a,r,n){var i=BLK(r).length;n(t.from<=i&&t.to>=i)},equals:function(t,e,a,r,n){n(t.value===r)},notEquals:function(t,e,a,r,n){n(t.value!==r)},pattern:function(t,e,a,r,n){n(new RegExp(t.pattern).test(BLK(r)))},patternWord:function(t,e,a,r,n){n(new RegExp("^[\\w]+$").test(BLK(r)))},patternAlphabet:function(t,e,a,r,n){n(new RegExp("^[a-zA-Z]+$").test(BLK(r)))},patternAlphanum:function(t,e,a,r,n){n(new RegExp("^[0-9a-zA-Z]+$").test(BLK(r)))},patternEmail:function(t,e,a,r,n){n(new RegExp("^[\\w\\-\\.]+@[\\w\\-\\.]+\\.[\\w]{1,5}$").test(BLK(r)))},patternNumber:function(t,e,a,r,n){n(new RegExp("^[\\-]?[0-9]+$").test(BLK(r)))},patternPhone:function(t,e,a,r,n){n(new RegExp("^(\\+?\\d{0,2}\\s?\\d{2,3}\\s?\\-?\\s?\\d{3,4}\\s?\\-?\\s?\\d{4})$").test(BLK(r)))},columnEquals:function(t,e,a,r,n){var i=t.value;n(BLK(this.getColumnValue(i,a))===BLK(r))},columnNotEquals:function(t,e,a,r,n){var i=t.value;n(BLK(this.getColumnValue(i,a))!==BLK(r))}},n.prototype._commonFailedMessages={required:"field is required",maxLength:"max length : {length}",minLength:"min length : {length}",length:"length : {length}",range:"range : {from} ~ {to}",rangeLength:"length : {from} ~ {to}",equals:"equals : {value}",notEquals:"not equals : {value}",pattern:"pattern : {pattern}",patternWord:"pattern word",patternAlphabet:"pattern alphabet",patternAlphanum:"pattern alphanum",patternEmail:"pattern email",patternNumber:"pattern number",patternPhone:"pattern phone",columnEquals:"column be equals to {value}",columnNotEquals:"column be not equals to {value}"},e.fn._jgValidator=function(t){return void 0!==t&&this.data("jgdataset_jgValidator",t),this.data("jgdataset_jgValidator")},e.fn._jgValidatorInitialized=function(t){return void 0!==t&&this.data("jgdataset_jgValidatorInitialized",t),NVL(this.data("jgdataset_jgValidatorInitialized"),!1)},e.fn.JGValidator=function(){return this._jexecute(function(t){return this._jgValidatorInitialized()?JGSelector(this._jgValidator(),t):(this._jgValidator(new n(this.JGDatasetUI(),t[0])),this._jgValidatorInitialized(!0),this)},arguments)}}(window,jQuery);