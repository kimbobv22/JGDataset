!function(t){var e={value:function(t,e){if("number"===$.type(e)){var a,r=0;return $.each(t,function(n){return r===e?(a=t[n],!1):void++r}),a}var a,n=e.toUpperCase();return $.each(t,function(e){return e.toUpperCase()===n?(a=t[e],!1):void 0}),a},key:function(t,e){var a,r=0;return $.each(t,function(t){return r===e?(a=t,!1):void++r}),a},length:function(t){var e=0;return $.each(t,function(){++e}),e}};_JGKeyword=$.extend(!0,_JGKeyword,{validator:{failedColumn:"jg-failed-column",validColumn:"jg-valid-column",failedLabelLastDisplay:"jgValidatorUI_failedLabel_lastDisplay",validLabelLastDisplay:"jgValidatorUI_validLabel_lastDisplay",trigger:{rowValidationChange:"rowvalidationchange"}}});var a=t.JGValidatorRow=function(t,e){this._validator=t,this._errorLabels=new Array,this._validLabels=new Array,this._lastCause=null,this.rowContent(e)};a.prototype.validator=function(){return this._validator},a.prototype.dataset=function(){return this._validator.datasetUI().dataset()},a.prototype.rowContent=function(t){return void 0!==t&&(this._rowContent=t,this.reload()),this._rowContent},a.prototype.reload=function(){this._errorLabels.removeAll(),this._validLabels.removeAll();var t=this._rowContent.rowContent(),e=this;t.find("*["+_JGKeyword.validator.failedColumn+"]").each(function(){e._errorLabels.push($(this))}),t.find("*["+_JGKeyword.validator.validColumn+"]").each(function(){e._validLabels.push($(this))}),this.validate(function(){})},a.prototype.lastCause=function(){return this._lastCause},a.prototype.isValid=function(){var t=!0,e=isNull(this._lastCause)?!1:!0;return e&&$.each(this._lastCause,function(){return this.length>0?t=!1:void 0}),t&&e},a.prototype.__rValidate=function(t,a,r,n,i,o){var s=e.length(t._validators);if(n>=s)return void o(r);var l=e.key(t._validators,n),d=t._validators[l],u=e.length(d);if(i>=u)return void this.__rValidate(t,a,r,n+1,0,o);l=l.toUpperCase();var h=this.rowContent().rowIndex(),p=a.getColumnValue(l,h),v=e.value(d,i),f=e.value(t._engine,v.name);if(!f)return console.error("can't find validation engine : "+v.name),void this.__rValidate(t,a,r,n,i+1,o);var g=this;f.apply(a,[v,l,h,p,function(e){void 0===r[l]&&(r[l]=new Array),e||r[l].push(v.name),!e&&BLK(t._options.stepValidation,!0)?(++n,i=0):++i,g.__rValidate(t,a,r,n,i,o)}])},a.prototype.validate=function(t){var e=this._validator,a=e.datasetUI(),r=a.dataset(),n=this._rowContent.rowIndex(),i=(e._validators,e._engine,this);this.__rValidate(e,r,{},0,0,function(e){var o=$.extend(!0,{},e);$.each(e,function(t){0===o[t].length&&delete o[t]}),i._lastCause=o,i.refresh();var s=i.isValid();s!==i.__lastValid&&a.element().trigger(_JGKeyword.validator.trigger.rowValidationChange,[s,n]),i.__lastValid=s,isNull(t)||t.apply(r,[s,i._lastCause])})},a.prototype.refresh=function(){var t=this,a=this.dataset(),r=t.validator(),n=this.rowContent().rowIndex(),i=this.lastCause();$.each(this._errorLabels,function(){var t=this.attr(_JGKeyword.validator.failedColumn);if(t.indexOf(",")>=0)t=t.split(",");else{var o=t;t=new Array,t.push(o)}for(var s=t.length,l=0;s>l;++l){var d=t[l].toUpperCase(),u=i[d.toUpperCase()];if(void 0===u){var h=r._options.animateFailedLabelHide;!isNull(h)&&BLK(this.data(_JGKeyword.validator.failedLabelLastDisplay),!0)&&(this.data(_JGKeyword.validator.failedLabelLastDisplay,!1),h.apply(this,[u,a,d,n]))}else{var p=e.length(u);this.empty();for(var v=0;p>v;++v){var f=e.value(u,v),g=r.failedMessage(d,f);isNull(g)&&(g=NVL(r.commonFailedMessage(f),""));var _=function(t){return new RegExp("\\{("+t+")\\}","gi")};g=g.replace(_("columnName"),d),g=g.replace(_("rowIndex"),n),g=g.replace(_("columnValue"),a.getColumnValue(d,n));var c=r._validator(d,f);$.each(c,function(t,e){g=g.replace(_(t),e)});var m=$(r._options.failedMessageTag);if(m.html(g),this.append(m),NVL(r.options.stepValidation,!1))break}var h=r._options.animateFailedLabelShow;isNull(h)||BLK(this.data(_JGKeyword.validator.failedLabelLastDisplay),!1)||(this.data(_JGKeyword.validator.failedLabelLastDisplay,!0),h.apply(this,[u,a,d,n]))}}}),$.each(this._validLabels,function(){var t=this.attr(_JGKeyword.validator.validColumn);if(t.indexOf(",")>=0)t=t.split(",");else{var e=t;t=new Array,t.push(e)}for(var o=t.length,s=0;o>s;++s){var l=t[s].toUpperCase(),d=i[l];if(void 0===d){var u=r._options.animateValidLabelShow;isNull(u)||BLK(this.data(_JGKeyword.validator.validLabelLastDisplay),!1)||(this.data(_JGKeyword.validator.validLabelLastDisplay,!0),u.apply(this,[d,a,l,n]))}else{var u=r._options.animateValidLabelHide;!isNull(u)&&BLK(this.data(_JGKeyword.validator.validLabelLastDisplay),!0)&&(this.data(_JGKeyword.validator.validLabelLastDisplay,!1),u.apply(this,[d,a,l,n]))}}})};var r=t.JGValidator=function(t,e){var a,n,i,o;e=NVL(e,{}),isNull(e.options)?i=e:(a=e.failedMessages,n=e.commonFailedMessages,i=e.options,o=e.engine),this._datasetUI=t,this._engine=$.extend(!0,r.prototype._engine,o),this._commonFailedMessages=$.extend(!0,r.prototype._commonFailedMessages,n),this._failedMessages=$.extend(!0,r.prototype._failedMessages,a),this._options=$.extend(!0,r.prototype._options,i),this._validators={},this._rows=new Array;var s=this.dataset(),l=this;$(s).on(_JGKeyword.trigger._rowInserted,function(t,e){l._insertValidatorRow(e)}),$(s).on(_JGKeyword.trigger._rowRemoved,function(t,e){l._removeValidatorRow(e)}),$(s).on(_JGKeyword.trigger._rowMoved,function(t,e,a){e>a?l.refresh(a,e):l.refresh(e,a)}),$(s).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved,function(){l.refresh()}),$(s).on(_JGKeyword.trigger._columnValueChanged,function(t,e,a){l._options.realtimeCheck&&(isNull(l.__realtimeCheckTimeout)||clearTimeout(l.__realtimeCheckTimeout),l.__realtimeCheckTimeout=setTimeout(function(){l._rows[a].validate(),l.__realtimeCheckTimeout=null},BLK(l._options.realtimeCheckDelay,0)))}),$(s).on(_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(){l.reload()}),this.reload()};r.prototype.datasetUI=function(){return this._datasetUI},r.prototype.dataset=function(){return this._datasetUI.dataset()},r.prototype.engine=function(t){return void 0!==t&&(this._engine=$.extend(!0,this._engine,t)),this._engine},r.prototype.failedMessages=function(t){return void 0!==t&&(this._failedMessages=$.extend(!0,this._failedMessages,t),this.refresh()),this._failedMessages},r.prototype.failedMessage=function(t,a){var r=e.value(this._failedMessages,t);return isNull(r)?void 0:e.value(r,a)},r.prototype.commonFailedMessages=function(t){return void 0!==t&&(this._commonFailedMessages=$.extend(!0,this._commonFailedMessages,t),this.refresh()),this._commonFailedMessages},r.prototype.commonFailedMessage=function(t){return e.value(this._commonFailedMessages,t)},r.prototype._validator=function(t,a){var r=e.value(this._validators,t);return isNull(r)?void 0:e.value(r,a)},r.prototype.lastCause=function(){for(var t=new Array,e=this._rows.length,a=0;e>a;++a){var r=this._rows[a];t[a]=$.extend({isValid:r.isValid()},r.lastCause())}return t},r.prototype.isValid=function(){var t=!0,e=this.lastCause();return $.each(e,function(){return this.isValid?void 0:t=!1}),t},r.prototype.reload=function(t){this._validators={};for(var e=this._datasetUI,a=e.dataset(),r=e._originalRowContent,n=a.getColumnCount(),i=0;n>i;++i){var o=a.getColumn(i).getName(),s=r.find("*["+_JGKeyword.ui.attrColumn+"]").filter(function(){return $(this).attr(_JGKeyword.ui.attrColumn).toUpperCase()===o});this._validators[o]={};for(var l=s.filter(function(){return void 0!==$(this).attr("required")}),d=l.length,u=0;d>u;++u)this._validators[o].required={name:"required"};l=s.filter(function(){return void 0!==$(this).attr("maxLength")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].maxLength={name:"maxLength",length:parseInt(h.attr("maxLength"))}}l=s.filter(function(){return void 0!==$(this).attr("minLength")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].minLength={name:"minLength",length:parseInt(h.attr("minLength"))}}l=s.filter(function(){return void 0!==$(this).attr("length")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].length={name:"length",length:parseInt(h.attr("length"))}}l=s.filter(function(){return void 0!==$(this).attr("equals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].equals={name:"equals",value:h.attr("equals")}}l=s.filter(function(){return void 0!==$(this).attr("notEquals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].notEquals={name:"notEquals",value:h.attr("notEquals")}}l=s.filter(function(){return void 0!==$(this).attr("range")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u)),p=h.attr("range").split(",");this._validators[o].range={name:"range",from:parseInt(p[0]),to:parseInt(p[1])}}l=s.filter(function(){return void 0!==$(this).attr("rangeLength")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u)),p=h.attr("rangeLength").split(",");this._validators[o].rangeLength={name:"rangeLength",from:parseInt(p[0]),to:parseInt(p[1])}}l=s.filter(function(){return void 0!==$(this).attr("pattern")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].pattern={name:"pattern",pattern:h.attr("pattern")}}l=s.filter(function(){return void 0!==$(this).attr("patternWord")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternWord={name:"patternWord"};l=s.filter(function(){return void 0!==$(this).attr("patternAlphabet")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternAlphabet={name:"patternAlphabet"};l=s.filter(function(){return void 0!==$(this).attr("patternAlphanum")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternAlphanum={name:"patternAlphanum"};l=s.filter(function(){return void 0!==$(this).attr("patternEmail")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternEmail={name:"patternEmail"};l=s.filter(function(){return void 0!==$(this).attr("patternNumber")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternNumber={name:"patternNumber"};l=s.filter(function(){return void 0!==$(this).attr("patternPhone")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternPhone={name:"patternPhone"};l=s.filter(function(){return void 0!==$(this).attr("columnEquals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].columnEquals={name:"columnEquals",value:h.attr("columnEquals")}}l=s.filter(function(){return void 0!==$(this).attr("columnNotEquals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].columnNotEquals={name:"columnNotEquals",value:h.attr("columnNotEquals")}}var v=this;l=s.each(function(){for(var t=$(this).get(0).attributes,e=t.length,a=0;e>a;++a){var r=t[a],n="(jg\\-validator\\-)+";if(new RegExp(n,"gi").test(r.name)){var i=r.name.replace("jg-validator-","");v._validators[o][i]={name:i,value:r.value}}}})}NVL(t,!0)&&this.reloadRow(),this.validate(function(){})},r.prototype.reloadRow=function(t,e){var a=this;a._rows.removeAll(),this.dataset().each(t,e,function(t){a._insertValidatorRow(t)})},r.prototype.refresh=function(t,e){var a=this;this.dataset().each(t,e,function(t){a._rows[t].refresh()})},r.prototype.__rValidate=function(t,e,a){var r=this.dataset().getRowCount();if(t>=r)return void a(e);var n=this;this._rows[t].validate(function(r,i){e[t]=$.extend({},i),e[t].isValid=r,n.__rValidate(t+1,e,a)})},r.prototype.validate=function(t){var e=this;this.__rValidate(0,new Array,function(a){e._lastCause=a,t(e.isValid(),a)})},r.prototype._insertValidatorRow=function(t){this._rows.insert(new a(this,this._datasetUI.rowContent(t)),t),this.refresh(t)},r.prototype._removeValidatorRow=function(t){this._rows.remove(t),this.refresh(t)},r.prototype._options={failedMessageTag:"<span style='display:block;' />",stepValidation:!0,realtimeCheck:!0,realtimeCheckDelay:200,animateFailedLabelShow:function(){this.stop(),this.fadeIn()},animateFailedLabelHide:function(){this.stop(),this.fadeOut()},animateValidLabelShow:function(){this.stop(),this.fadeIn()},animateValidLabelHide:function(){this.stop(),this.fadeOut()}},r.prototype.options=function(){return"string"===$.type(arguments[0])?(2===arguments.length&&(this._options[arguments[0]]=arguments[1],"failedMessageTag"===arguments[0]&&this.refresh()),this._options[arguments[0]]):("object"===$.type(arguments[0])&&(this._options=$.extend(!0,this._options,arguments[0]),this.refresh()),this._options)},r.prototype._engine={required:function(t,e,a,r,n){n(0<BLK(r).length)},maxLength:function(t,e,a,r,n){n(t.length>=BLK(r).length)},minLength:function(t,e,a,r,n){n(t.length<=BLK(r).length)},length:function(t,e,a,r,n){n(t.length===BLK(r).length)},range:function(t,e,a,r,n){var i=parseInt(r);n(t.from<=i&&t.to>=i)},rangeLength:function(t,e,a,r,n){var i=BLK(r).length;n(t.from<=i&&t.to>=i)},equals:function(t,e,a,r,n){n(t.value===r)},notEquals:function(t,e,a,r,n){n(t.value!==r)},pattern:function(t,e,a,r,n){n(new RegExp(t.pattern).test(BLK(r)))},patternWord:function(t,e,a,r,n){n(new RegExp("^[\\w]+$").test(BLK(r)))},patternAlphabet:function(t,e,a,r,n){n(new RegExp("^[a-zA-Z]+$").test(BLK(r)))},patternAlphanum:function(t,e,a,r,n){n(new RegExp("^[0-9a-zA-Z]+$").test(BLK(r)))},patternEmail:function(t,e,a,r,n){n(new RegExp("^[\\w\\-\\.]+@[\\w\\-\\.]+\\.[\\w]{1,5}$").test(BLK(r)))},patternNumber:function(t,e,a,r,n){n(new RegExp("^[\\-]?[0-9]+$").test(BLK(r)))},patternPhone:function(t,e,a,r,n){n(new RegExp("^(\\+?\\d{0,2}\\s?\\d{2,3}\\s?\\-?\\s?\\d{3,4}\\s?\\-?\\s?\\d{4})$").test(BLK(r)))},columnEquals:function(t,e,a,r,n){var i=t.value;n(BLK(this.getColumnValue(i,a))===BLK(r))},columnNotEquals:function(t,e,a,r,n){var i=t.value;n(BLK(this.getColumnValue(i,a))!==BLK(r))}},r.prototype._commonFailedMessages={required:"field is required",maxLength:"max length : {length}",minLength:"min length : {length}",length:"length : {length}",range:"range : {from} ~ {to}",rangeLength:"length : {from} ~ {to}",equals:"equals : {value}",notEquals:"not equals : {value}",pattern:"pattern : {pattern}",patternWord:"pattern word",patternAlphabet:"pattern alphabet",patternAlphanum:"pattern alphanum",patternEmail:"pattern email",patternNumber:"pattern number",patternPhone:"pattern phone",columnEquals:"column be equals to {value}",columnNotEquals:"column be not equals to {value}"},$.fn._jgValidator=function(t){return void 0!==t&&this.data("jgdataset_jgValidator",t),this.data("jgdataset_jgValidator")},$.fn._jgValidatorInitialized=function(t){return void 0!==t&&this.data("jgdataset_jgValidatorInitialized",t),NVL(this.data("jgdataset_jgValidatorInitialized"),!1)},$.fn.JGValidator=function(){return this._jexecute(function(t){return this._jgValidatorInitialized()?JGSelector(this._jgValidator(),t):(this._jgValidator(new r(this.JGDatasetUI(),t[0])),this._jgValidatorInitialized(!0),this)},arguments)}}(window);