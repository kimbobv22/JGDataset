!function(t){var e={value:function(t,e){if("number"===$.type(e)){var a,n=0;return $.each(t,function(r){return n===e?(a=t[r],!1):void++n}),a}var a,r=e.toUpperCase();return $.each(t,function(e){return e.toUpperCase()===r?(a=t[e],!1):void 0}),a},key:function(t,e){var a,n=0;return $.each(t,function(t){return n===e?(a=t,!1):void++n}),a},length:function(t){var e=0;return $.each(t,function(){++e}),e}};_JGKeyword=$.extend(!0,_JGKeyword,{validator:{failedColumn:"jg-failed-column",validColumn:"jg-valid-column",failedLabelLastDisplay:"jgValidatorUI_failedLabel_lastDisplay",validLabelLastDisplay:"jgValidatorUI_validLabel_lastDisplay",trigger:{rowValidationChange:"rowvalidationchange"}}});var a=t.JGValidatorRow=function(t,e){this._validator=t,this._errorLabels=new Array,this._validLabels=new Array,this._lastCause=null,this.rowContent(e)};a.prototype.validator=function(){return this._validator},a.prototype.dataset=function(){return this._validator.datasetUI().dataset()},a.prototype.rowContent=function(t){return void 0!==t&&(this._rowContent=t,this.reload()),this._rowContent},a.prototype.reload=function(){this._errorLabels.removeAll(),this._validLabels.removeAll();var t=this._rowContent.rowContent(),e=this;t.find("*["+_JGKeyword.validator.failedColumn+"]").each(function(){e._errorLabels.push($(this))}),t.find("*["+_JGKeyword.validator.validColumn+"]").each(function(){e._validLabels.push($(this))}),this.validate(function(){})},a.prototype.lastCause=function(){return this._lastCause},a.prototype.isValid=function(){var t=!0,e=isNull(this._lastCause)?!1:!0;return e&&$.each(this._lastCause,function(){return this.length>0?t=!1:void 0}),t&&e},a.prototype.__rValidate=function(t,a,n,r,i,o){var s=e.length(t._validators);if(r>=s)return void o(n);var l=e.key(t._validators,r),d=t._validators[l],u=e.length(d);if(i>=u)return void this.__rValidate(t,a,n,r+1,0,o);l=l.toUpperCase();var h=this.rowContent().rowIndex(),p=a.getColumnValue(l,h),v=e.value(d,i),g=e.value(t._engine,v.name);if(!g)return console.error("can't find validation engine : "+v.name),void this.__rValidate(t,a,n,r,i+1,o);var f=this;g.apply(a,[v,l,h,p,function(e){void 0===n[l]&&(n[l]=new Array),e||n[l].push(v.name),!e&&BLK(t._options.stepValidation,!0)?(++r,i=0):++i,f.__rValidate(t,a,n,r,i,o)}])},a.prototype.validate=function(t){var e=this._validator,a=e.datasetUI(),n=a.dataset(),r=this._rowContent.rowIndex(),i=(e._validators,e._engine,this);this.__rValidate(e,n,{},0,0,function(e){var o=$.extend(!0,{},e);$.each(e,function(t){0===o[t].length&&delete o[t]}),i._lastCause=o,i.refresh();var s=i.isValid();s!==i.__lastValid&&a.element().trigger(_JGKeyword.validator.trigger.rowValidationChange,[s,r]),i.__lastValid=s,isNull(t)||t.apply(n,[s,i._lastCause])})},a.prototype.refresh=function(){var t=this,a=this.dataset(),n=t.validator(),r=this.rowContent().rowIndex(),i=this.lastCause();$.each(this._errorLabels,function(){var t=this.attr(_JGKeyword.validator.failedColumn);if(t.indexOf(",")>=0)t=t.split(",");else{var o=t;t=new Array,t.push(o)}for(var s=t.length,l=0;s>l;++l){var d=t[l].toUpperCase(),u=i[d.toUpperCase()];if(void 0===u){var h=n._options.animateFailedLabelHide;!isNull(h)&&BLK(this.data(_JGKeyword.validator.failedLabelLastDisplay),!0)&&(this.data(_JGKeyword.validator.failedLabelLastDisplay,!1),h.apply(this,[u,a,d,r]))}else{var p=e.length(u);this.empty();for(var v=0;p>v;++v){var g=e.value(u,v),f=n.failedMessage(d,g);isNull(f)&&(f=NVL(n.commonFailedMessage(g),""));var _=function(t){return new RegExp("\\{("+t+")\\}","gi")};f=f.replace(_("columnName"),d),f=f.replace(_("rowIndex"),r),f=f.replace(_("columnValue"),a.getColumnValue(d,r));var c=n._validator(d,g);$.each(c,function(t,e){f=f.replace(_(t),e)});var m=$(n._options.failedMessageTag);if(m.html(f),this.append(m),NVL(n.options.stepValidation,!1))break}var h=n._options.animateFailedLabelShow;isNull(h)||BLK(this.data(_JGKeyword.validator.failedLabelLastDisplay),!1)||(this.data(_JGKeyword.validator.failedLabelLastDisplay,!0),h.apply(this,[u,a,d,r]))}}}),$.each(this._validLabels,function(){var t=this.attr(_JGKeyword.validator.validColumn);if(t.indexOf(",")>=0)t=t.split(",");else{var e=t;t=new Array,t.push(e)}for(var o=t.length,s=0;o>s;++s){var l=t[s].toUpperCase(),d=i[l];if(void 0===d){var u=n._options.animateValidLabelShow;isNull(u)||BLK(this.data(_JGKeyword.validator.validLabelLastDisplay),!1)||(this.data(_JGKeyword.validator.validLabelLastDisplay,!0),u.apply(this,[d,a,l,r]))}else{var u=n._options.animateValidLabelHide;!isNull(u)&&BLK(this.data(_JGKeyword.validator.validLabelLastDisplay),!0)&&(this.data(_JGKeyword.validator.validLabelLastDisplay,!1),u.apply(this,[d,a,l,r]))}}})};var n=t.JGValidator=function(t,e){var a,r,i,o;e=NVL(e,{}),isNull(e.options)?i=e:(a=e.failedMessages,r=e.commonFailedMessages,i=e.options,o=e.engine),this._datasetUI=t,this._engine=$.extend(!0,n.prototype._engine,o),this._commonFailedMessages=$.extend(!0,n.prototype._commonFailedMessages,r),this._failedMessages=$.extend(!0,n.prototype._failedMessages,a),this._options=$.extend(!0,n.prototype._options,i),this._validators={},this._rows=new Array;var s=this.dataset(),l=this;$(s).on(_JGKeyword.trigger._rowInserted,function(t,e){l._insertValidatorRow(e)}),$(s).on(_JGKeyword.trigger._rowRemoved,function(t,e){l._removeValidatorRow(e)}),$(s).on(_JGKeyword.trigger._rowMoved,function(t,e,a){e>a?l.refresh(a,e):l.refresh(e,a)}),$(s).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved,function(){l.refresh()}),$(s).on(_JGKeyword.trigger._columnValueChanged,function(t,e,a){l._options.realtimeCheck&&l._rows[a].validate()}),$(s).on(_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(){l.reload()}),this.reload()};n.prototype.datasetUI=function(){return this._datasetUI},n.prototype.dataset=function(){return this._datasetUI.dataset()},n.prototype.engine=function(t){return void 0!==t&&(this._engine=$.extend(!0,this._engine,t)),this._engine},n.prototype.failedMessages=function(t){return void 0!==t&&(this._failedMessages=$.extend(!0,this._failedMessages,t),this.refresh()),this._failedMessages},n.prototype.failedMessage=function(t,a){var n=e.value(this._failedMessages,t);return isNull(n)?void 0:e.value(n,a)},n.prototype.commonFailedMessages=function(t){return void 0!==t&&(this._commonFailedMessages=$.extend(!0,this._commonFailedMessages,t),this.refresh()),this._commonFailedMessages},n.prototype.commonFailedMessage=function(t){return e.value(this._commonFailedMessages,t)},n.prototype._validator=function(t,a){var n=e.value(this._validators,t);return isNull(n)?void 0:e.value(n,a)},n.prototype.lastCause=function(){for(var t=new Array,e=this._rows.length,a=0;e>a;++a){var n=this._rows[a];t[a]=$.extend({isValid:n.isValid()},n.lastCause())}return t},n.prototype.isValid=function(){var t=!0,e=this.lastCause();return $.each(e,function(){return this.isValid?void 0:t=!1}),t},n.prototype.reload=function(t){this._validators={};for(var e=this._datasetUI,a=e.dataset(),n=e._originalRowContent,r=a.getColumnCount(),i=0;r>i;++i){var o=a.getColumn(i).getName(),s=n.find("*["+_JGKeyword.ui.attrColumn+"]").filter(function(){return $(this).attr(_JGKeyword.ui.attrColumn).toUpperCase()===o});this._validators[o]={};for(var l=s.filter(function(){return void 0!==$(this).attr("required")}),d=l.length,u=0;d>u;++u)this._validators[o].required={name:"required"};l=s.filter(function(){return void 0!==$(this).attr("maxLength")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].maxLength={name:"maxLength",length:parseInt(h.attr("maxLength"))}}l=s.filter(function(){return void 0!==$(this).attr("minLength")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].minLength={name:"minLength",length:parseInt(h.attr("minLength"))}}l=s.filter(function(){return void 0!==$(this).attr("length")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].length={name:"length",length:parseInt(h.attr("length"))}}l=s.filter(function(){return void 0!==$(this).attr("equals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].equals={name:"equals",value:h.attr("equals")}}l=s.filter(function(){return void 0!==$(this).attr("notEquals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].notEquals={name:"notEquals",value:h.attr("notEquals")}}l=s.filter(function(){return void 0!==$(this).attr("range")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u)),p=h.attr("range").split(",");this._validators[o].range={name:"range",from:parseInt(p[0]),to:parseInt(p[1])}}l=s.filter(function(){return void 0!==$(this).attr("rangeLength")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u)),p=h.attr("rangeLength").split(",");this._validators[o].rangeLength={name:"rangeLength",from:parseInt(p[0]),to:parseInt(p[1])}}l=s.filter(function(){return void 0!==$(this).attr("pattern")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].pattern={name:"pattern",pattern:h.attr("pattern")}}l=s.filter(function(){return void 0!==$(this).attr("patternWord")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternWord={name:"patternWord"};l=s.filter(function(){return void 0!==$(this).attr("patternAlphabet")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternAlphabet={name:"patternAlphabet"};l=s.filter(function(){return void 0!==$(this).attr("patternAlphanum")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternAlphanum={name:"patternAlphanum"};l=s.filter(function(){return void 0!==$(this).attr("patternEmail")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternEmail={name:"patternEmail"};l=s.filter(function(){return void 0!==$(this).attr("patternNumber")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternNumber={name:"patternNumber"};l=s.filter(function(){return void 0!==$(this).attr("patternPhone")}),d=l.length;for(var u=0;d>u;++u)this._validators[o].patternPhone={name:"patternPhone"};l=s.filter(function(){return void 0!==$(this).attr("columnEquals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].columnEquals={name:"columnEquals",value:h.attr("columnEquals")}}l=s.filter(function(){return void 0!==$(this).attr("columnNotEquals")}),d=l.length;for(var u=0;d>u;++u){var h=$(l.get(u));this._validators[o].columnNotEquals={name:"columnNotEquals",value:h.attr("columnNotEquals")}}var v=this;l=s.each(function(){for(var t=$(this).get(0).attributes,e=t.length,a=0;e>a;++a){var n=t[a],r="(jg\\-validator\\-)+";if(new RegExp(r,"gi").test(n.name)){var i=n.name.replace("jg-validator-","");v._validators[o][i]={name:i,value:n.value}}}})}NVL(t,!0)&&this.reloadRow(),this.validate(function(){})},n.prototype.reloadRow=function(t,e){var a=this;a._rows.removeAll(),this.dataset().each(t,e,function(t){a._insertValidatorRow(t)})},n.prototype.refresh=function(t,e){var a=this;this.dataset().each(t,e,function(t){a._rows[t].refresh()})},n.prototype.__rValidate=function(t,e,a){var n=this.dataset().getRowCount();if(t>=n)return void a(e);var r=this;this._rows[t].validate(function(n,i){e[t]=$.extend({},i),e[t].isValid=n,r.__rValidate(t+1,e,a)})},n.prototype.validate=function(t){var e=this;this.__rValidate(0,new Array,function(a){e._lastCause=a,t(e.isValid(),a)})},n.prototype._insertValidatorRow=function(t){this._rows.insert(new a(this,this._datasetUI.rowContent(t)),t),this.refresh(t)},n.prototype._removeValidatorRow=function(t){this._rows.remove(t),this.refresh(t)},n.prototype._options={failedMessageTag:"<span style='display:block;' />",stepValidation:!0,realtimeCheck:!0,animateFailedLabelShow:function(){this.stop(),this.fadeIn()},animateFailedLabelHide:function(){this.stop(),this.fadeOut()},animateValidLabelShow:function(){this.stop(),this.fadeIn()},animateValidLabelHide:function(){this.stop(),this.fadeOut()}},n.prototype.options=function(){return"string"===$.type(arguments[0])?(2===arguments.length&&(this._options[arguments[0]]=arguments[1],"failedMessageTag"===arguments[0]&&this.refresh()),this._options[arguments[0]]):("object"===$.type(arguments[0])&&(this._options=$.extend(!0,this._options,arguments[0]),this.refresh()),this._options)},n.prototype._engine={required:function(t,e,a,n,r){r(0<BLK(n).length)},maxLength:function(t,e,a,n,r){r(t.length>=BLK(n).length)},minLength:function(t,e,a,n,r){r(t.length<=BLK(n).length)},length:function(t,e,a,n,r){r(t.length===BLK(n).length)},range:function(t,e,a,n,r){var i=parseInt(n);r(t.from<=i&&t.to>=i)},rangeLength:function(t,e,a,n,r){var i=BLK(n).length;r(t.from<=i&&t.to>=i)},equals:function(t,e,a,n,r){r(t.value===n)},notEquals:function(t,e,a,n,r){r(t.value!==n)},pattern:function(t,e,a,n,r){r(new RegExp(t.pattern).test(BLK(n)))},patternWord:function(t,e,a,n,r){r(new RegExp("^[\\w]+$").test(BLK(n)))},patternAlphabet:function(t,e,a,n,r){r(new RegExp("^[a-zA-Z]+$").test(BLK(n)))},patternAlphanum:function(t,e,a,n,r){r(new RegExp("^[0-9a-zA-Z]+$").test(BLK(n)))},patternEmail:function(t,e,a,n,r){r(new RegExp("^[\\w\\-\\.]+@[\\w\\-\\.]+\\.[\\w]{1,5}$").test(BLK(n)))},patternNumber:function(t,e,a,n,r){r(new RegExp("^[\\-]?[0-9]+$").test(BLK(n)))},patternPhone:function(t,e,a,n,r){r(new RegExp("^(\\+?\\d{0,2}\\s?\\d{2,3}\\s?\\-?\\s?\\d{3,4}\\s?\\-?\\s?\\d{4})$").test(BLK(n)))},columnEquals:function(t,e,a,n,r){var i=t.value;r(BLK(this.getColumnValue(i,a))===BLK(n))},columnNotEquals:function(t,e,a,n,r){var i=t.value;r(BLK(this.getColumnValue(i,a))!==BLK(n))}},n.prototype._commonFailedMessages={required:"field is required",maxLength:"max length : {length}",minLength:"min length : {length}",length:"length : {length}",range:"range : {from} ~ {to}",rangeLength:"length : {from} ~ {to}",equals:"equals : {value}",notEquals:"not equals : {value}",pattern:"pattern : {pattern}",patternWord:"pattern word",patternAlphabet:"pattern alphabet",patternAlphanum:"pattern alphanum",patternEmail:"pattern email",patternNumber:"pattern number",patternPhone:"pattern phone",columnEquals:"column be equals to {value}",columnNotEquals:"column be not equals to {value}"},$.fn._jgValidator=function(t){return void 0!==t&&this.data("jgdataset_jgValidator",t),this.data("jgdataset_jgValidator")},$.fn._jgValidatorInitialized=function(t){return void 0!==t&&this.data("jgdataset_jgValidatorInitialized",t),NVL(this.data("jgdataset_jgValidatorInitialized"),!1)},$.fn.JGValidator=function(){return this._jexecute(function(t){return this._jgValidatorInitialized()?JGSelector(this._jgValidator(),t):(this._jgValidator(new n(this.JGDatasetUI(),t[0])),this._jgValidatorInitialized(!0),this)},arguments)}}(window);