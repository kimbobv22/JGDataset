!function(t){if(void 0===$||null===$)return void console.error("can't not initialize JGDataset, JQuery not found");t._JGKeyword={key:{row:"row",column:"col",columnInfo:"columninfo",rowData:"rowdata",deletedRowData:"deletedRowdata",name:"name",isKey:"isKey",value:"value",rowStatus:"status",modify:"modify"},trigger:{_rowInserted:"_jgRowInserted",_rowRemoved:"_jgRowRemoved",_rowMoved:"_jgRowMoved",_columnAdded:"_jgColumnAdded",_columnRemoved:"_jgColumnRemoved",_columnValueChanged:"_jgColumnValueChanged",_datasetSorted:"_jgDatasetSorted",_datasetChanged:"_jgDatasetChanged",_datasetClear:"_jgDatasetClear",_datasetReset:"_jgDatasetReset",_datasetApply:"_jgDatasetApply",rowInserted:"rowinserted",rowRemoved:"rowremoved",rowMoved:"rowmoved",columnAdded:"columnadded",columnRemoved:"columnremoved",columnValueChanged:"columnvaluechanged",datasetSorted:"datasetsorted",datasetChanged:"datasetchanged",datasetClear:"datasetclear",datasetReset:"datasetreset",datasetApply:"datasetapply"},rowStatus:{normal:0,insert:1,update:3}};t.JGSelector=function(t,e){if(0===e.length)return t;var o=Array.prototype.slice.call(e),r=t[o[0]];return void 0===r?void console.error(o[0]+" is undefined"):"function"!==$.type(r)?void console.error(o[0]+" is not function"):r.apply(t,o.slice(1))};t.isNull=function(t){return void 0===t||null===t},t.NVL=function(t,e){return NVL2(t,t,e)},t.NVL2=function(t,e,o){return isNull(t)?o:e},t.isBlank=function(t){return isNull(t)||0===t.length},t.BLK=function(t,e){return isBlank(t)?void 0===e?"":e:t},Array.prototype.indexOf=function(t){for(var e=this.length,o=0;e>o;++o)if(this[o]===t)return o;return-1},Array.prototype.insert=function(t,e){this.splice(e,0,t)},Array.prototype.remove=function(t){this.splice(t,1)},Array.prototype.removeAll=function(){this.splice(0,this.length)},Array.prototype.removeObject=function(t){this.remove(this.indexOf(t))},Array.prototype.move=function(t,e){var o=this[t];this[t]=this[e],this[e]=o};var e=function(t){this._name=t.toUpperCase(),this._isKey=!1};e.prototype.getName=function(){return this._name},e.prototype.isKey=function(t){return void 0!==t&&(this._isKey=t),this._isKey},e.prototype.clone=function(){var t=new e(this._name);return t._isKey=this._isKey,t};var o=function(){this._columns={},this._orgColumns={},this._columnStatus={},this._rowStatus=_JGKeyword.rowStatus.normal};o.prototype.getRowStatus=function(){return this._rowStatus},o.prototype.setRowStatus=function(t){this._rowStatus=t},o.prototype._updateRowStatus=function(){if(this._rowStatus!==_JGKeyword.rowStatus.insert){var t=!1;for(var e in this._columnStatus)if(NVL(this._columnStatus[e],!1)){t=!0;break}this._rowStatus=t?_JGKeyword.rowStatus.update:_JGKeyword.rowStatus.normal}},o.prototype.setColumn=function(t,e,o){t=t.toUpperCase(),this._columns[t]=e,this._columnStatus[t]=isNull(o)?this._orgColumns[t]!==e:o,this._updateRowStatus()},o.prototype.removeColumn=function(t){delete this._columns[t.toUpperCase()]},o.prototype.getColumnValue=function(t){return this._columns[t.toUpperCase()]},o.prototype.isColumnModified=function(t){var e=this._columnStatus[t.toUpperCase()];return NVL2(e,e,!1)},o.prototype.setColumnModification=function(t,e){this._columnStatus[t.toUpperCase()]=e},o.prototype.apply=function(){this._orgColumns=JSON.parse(JSON.stringify(this._columns)),this._rowStatus=_JGKeyword.rowStatus.normal,this._columnStatus={}},o.prototype.clone=function(){var t=new o;return t._columns=$.extend(!0,{},this._columns),t._orgColumns=$.extend(!0,{},this._orgColumns),t._columnStatus=$.extend(!0,{},this._columnStatus),t._rowStatus=this._rowStatus,t};var r=t.JGDataset=function(t){this._columnInfo=new Array,this._orgColumnInfo=new Array,this._rowData=new Array,this._orgRowData=new Array,this._deletedRowData=new Array,$(this).on(_JGKeyword.trigger._rowInserted,function(t,e,o){o&&$(this).trigger(_JGKeyword.trigger.rowInserted,[e])}),$(this).on(_JGKeyword.trigger._rowRemoved,function(t,e){$(this).trigger(_JGKeyword.trigger.rowRemoved,[e])}),$(this).on(_JGKeyword.trigger._columnAdded,function(t,e){$(this).trigger(_JGKeyword.trigger.columnAdded,[e])}),$(this).on(_JGKeyword.trigger._rowMoved,function(t,e,o,r){r&&$(this).trigger(_JGKeyword.trigger.rowMoved,[e,o])}),$(this).on(_JGKeyword.trigger._columnRemoved,function(t,e){$(this).trigger(_JGKeyword.trigger.columnRemoved,[e])}),$(this).on(_JGKeyword.trigger._columnValueChanged,function(t,e,o,r){r&&$(this).trigger(_JGKeyword.trigger.columnValueChanged,[e,o])}),$(this).on(_JGKeyword.trigger._datasetSorted,function(t,e,o,r){r&&$(this).trigger(_JGKeyword.trigger.datasetSorted,[e,o])}),$(this).on(_JGKeyword.trigger._datasetClear,function(t,e){e&&$(this).trigger(_JGKeyword.trigger.datasetClear)}),$(this).on(_JGKeyword.trigger._datasetReset,function(t,e){e&&$(this).trigger(_JGKeyword.trigger.datasetReset)}),$(this).on(_JGKeyword.trigger._datasetApply,function(t,e){e&&$(this).trigger(_JGKeyword.trigger.datasetApply)}),$(this).on(_JGKeyword.trigger._datasetChanged,function(t,e){e&&$(this).trigger(_JGKeyword.trigger.datasetChanged)}),isNull(t)||this.applyJSON(t)};r.prototype.getName=function(){return JGDS("datasetName",this)},r.prototype._convertColumnKeyToName=function(t){return"number"===$.type(t)?this.getColumn(t).getName():t.toUpperCase()},r.prototype._convertColumnKeyToIndex=function(t){return"number"===$.type(t)?t:this.indexOfColumn(t)},r.prototype.getColumnCount=function(){return this._columnInfo.length},r.prototype.getRowCount=function(){return this._rowData.length},r.prototype.getDeletedRowCount=function(){return this._deletedRowData.length},r.prototype.insertColumn=function(t,o,r){var n=new e(t);this._columnInfo[o]=n;for(var a=this._rowData.length,i=0;a>i;++i){var s=this._rowData[i];s.setColumn(t,null)}a=this._deletedRowData.length;for(var i=0;a>i;++i){var s=this._deletedRowData[i];s.setColumn(t,null)}return NVL(r,!0)&&$(this).trigger(_JGKeyword.trigger._columnAdded,[n.getName()]),n},r.prototype.addColumn=function(t,e){return this.insertColumn(t,this._columnInfo.length,e)},r.prototype.addColumns=function(){for(var t=arguments.length,e=0;t>e;++e)this.addColumn(arguments[e])},r.prototype.removeColumn=function(t){t=this._convertColumnKeyToIndex(t);var e=this.getColumn(t).getName();this._columnInfo.splice(t,1),$(this).trigger(_JGKeyword.trigger._columnRemoved,[e])},r.prototype.getColumn=function(t){return t=this._convertColumnKeyToIndex(t),this._columnInfo[t]},r.prototype.indexOfColumn=function(t){for(var e=this._columnInfo.length,o=0;e>o;++o)if(this._columnInfo[o].getName()===t.toUpperCase())return o;return-1},r.prototype._createRow=function(t){var e=new o;e.setRowStatus(t);for(var r=this._columnInfo.length,n=0;r>n;++n){var a=this._columnInfo[n];e.setColumn(a.getName(),null)}return e},r.prototype._insertRow=function(t){var e=this._createRow(_JGKeyword.rowStatus.insert);return this._rowData.insert(e,t),e},r.prototype.insertRow=function(t){var e=this._insertRow(t);return $(this).trigger(_JGKeyword.trigger._rowInserted,[t,!0]),e},r.prototype.addRow=function(){var t=this._rowData.length;return this.insertRow(t),t},r.prototype.addRows=function(t){for(var e=0;t>e;++e)this.addRow()},r.prototype._removeRow=function(t){var e=this.getRow(t);switch(e.getRowStatus()){case _JGKeyword.rowStatus.normal:case _JGKeyword.rowStatus.update:this._deletedRowData.push(e);break;case _JGKeyword.rowStatus.insert:}this._rowData.remove(t)},r.prototype.removeRow=function(t){this._removeRow(t),$(this).trigger(_JGKeyword.trigger._rowRemoved,[t])},r.prototype.getRow=function(t){return this._rowData[t]},r.prototype.setRowStatus=function(t,e){this.getRow(t).setRowStatus(e)},r.prototype.getRowStatus=function(t){return this.getRow(t).getRowStatus()},r.prototype.getDeletedRow=function(t){return this._deletedRowData[t]},r.prototype.moveRow=function(t,e,o){this._rowData.move(t,e),$(this).trigger(_JGKeyword.trigger._rowMoved,[t,e,NVL(o,!0)])},r.prototype.sortRow=function(t,e,o){for(var r=this.getRowCount(),n=null,a=!1,i=r-1,s=0,u=0;r>u;++u)for(var l=0;r>l;++l){var d=this.getColumnValue(t,u),h=this.getColumnValue(t,l);e.apply(this,[d,h])&&(a=!0,i>u&&(i=u),l>s&&(s=l),n=this._rowData[u],this._rowData[u]=this._rowData[l],this._rowData[l]=n)}a&&$(this).trigger(_JGKeyword.trigger._datasetSorted,[i,s,NVL(o,!0)])},r.prototype.sortRowByAsc=function(t){this.sortRow(t,function(t,e){return e>t})},r.prototype.sortRowByDesc=function(t){this.sortRow(t,function(t,e){return t>e})},r.prototype._setColumnValue=function(t,e,o,r,n){if("number"===$.type(t)){var a=this.getColumn(t);t=a.getName()}else{var i=this.indexOfColumn(t);0>i&&(NVL(r,!1)?this.addColumn(t,n):console.error("not exists column ["+t+"]"))}var s=this.getRow(e);s.setColumn(t,o)},r.prototype.setColumnValue=function(t,e,o,r){t=this._convertColumnKeyToName(t);var n=this.getColumnValue(t,e);this._setColumnValue(t,e,o,r),n!==o&&$(this).trigger(_JGKeyword.trigger._columnValueChanged,[t,e,!0])},r.prototype.setColumnValues=function(t,e,o){for(var r in t)this.setColumnValue(r,e,t[r],o)},r.prototype.getColumnValue=function(t,e){return this.getRow(e).getColumnValue(this._convertColumnKeyToName(t))},r.prototype.isColumnModified=function(t,e){return this.getRow(e).isColumnModified(this._convertColumnKeyToName(t))},r.prototype.getDeletedColumnValue=function(t,e){return this.getDeletedRow(e).getColumnValue(this._convertColumnKeyToName(t))},r.prototype.clear=function(t){NVL(t,!0)&&(this._columnInfo=new Array),this._rowData=new Array,this._deletedRowData=new Array,$(this).trigger(_JGKeyword.trigger._datasetClear,[NVL(arguments[1],!0)])},r.prototype.apply=function(t){this._orgRowData=new Array,this._orgColumnInfo=new Array;for(var e=this._rowData.length,o=0;e>o;++o){var r=this.getRow(o);r.apply(),this._orgRowData.push(r.clone())}for(var n=this._columnInfo.length,a=0;n>a;++a)this._orgColumnInfo.push(this.getColumn(a).clone());this._deletedRowData=new Array,$(this).trigger(_JGKeyword.trigger._datasetApply,[NVL(t,!0)])},r.prototype.reset=function(t){this._columnInfo=new Array,this._rowData=new Array;for(var e=this._orgRowData.length,o=0;e>o;++o)this._rowData.push(this._orgRowData[o].clone());for(var r=this._orgColumnInfo.length,n=0;r>n;++n)this._columnInfo.push(this._orgColumnInfo[n].clone());this._deletedRowData=new Array,$(this).trigger(_JGKeyword.trigger._datasetReset,[NVL(t,!0)])},r.prototype.isModified=function(){for(var t=this.getRowCount(),e=0;t>e;++e)if(this.getRowStatus(e)!==_JGKeyword.rowStatus.normal)return!0;return!1},r.prototype.sumOfColumnValues=function(t,e){for(var o=0,r=this.getRowCount(),n=this.getColumn(t),a=0;r>a;++a)if(NVL2(e,e,function(){return!0})(n.getName(),a)){var i=this.getColumnValue(n.getName(),a);o+=isNull(i)||isNaN(i)?0:new Number(i)}return o},r.prototype.avgOfColumnValues=function(t,e){var o=this.sumOfColumnValues(t,e),r=this.getRowCount(),n=o/r;return isNaN(n)?0:n},r.prototype._calcOfColumnValues=function(t,e,o){for(var r=void 0,n=this.getRowCount(),a=this.getColumn(t),i=0;n>i;++i){var s=this.getColumnValue(a.getName(),i);isBlank(s)||isNaN(s)||!NVL2(o,o,function(){return!0})(a.getName(),i)||(isNull(r)||new Function("return ("+r+e+s+");").apply(this))&&(r=s)}return r},r.prototype.maxOfColumnValues=function(t,e){return this._calcOfColumnValues(t,"<",e)},r.prototype.minOfColumnValues=function(t,e){return this._calcOfColumnValues(t,">",e)},r.prototype.toJSON=function(t){if(NVL(t,!1)){for(var e=new Array,o=this._rowData.length,r=this._columnInfo.length,n=0;o>n;++n){for(var a=this._rowData[n],i={},s=0;r>s;++s){var u=this._columnInfo[s];i[u.getName()]=a.getColumnValue(u.getName())}e.push(i)}return e}for(var l={},d=new Array,r=this._columnInfo.length,s=0;r>s;++s){var u=this._columnInfo[s],h={};h[_JGKeyword.key.name]=u.getName(),h[_JGKeyword.key.isKey]=u.isKey(),d[s]=h}l[_JGKeyword.key.columnInfo]=d;for(var g=new Array,o=this._rowData.length,n=0;o>n;++n){for(var a=this._rowData[n],i={},_={},s=0;r>s;++s){var u=this._columnInfo[s],h={};h[_JGKeyword.key.value]=this.getColumnValue(u.getName(),n),h[_JGKeyword.key.modify]=a.isColumnModified(u.getName()),_[u.getName()]=h}i[_JGKeyword.key.row]=_,i[_JGKeyword.key.rowStatus]=a.getRowStatus(),g[n]=i}l[_JGKeyword.key.rowData]=g;var w=new Array;o=this._deletedRowData.length;for(var n=0;o>n;++n){for(var a=this._rowData[n],i={},_={},s=0;r>s;++s){var u=this._columnInfo[s],m=this.getDeletedColumnValue(u.getName(),n),h={};h[_JGKeyword.key.value]=m,_[u.getName()]=h}i[_JGKeyword.key.row]=_,w[n]=i}return l[_JGKeyword.key.deletedRowData]=w,l},r.prototype.toJSONString=function(t){return JSON.stringify(this.toJSON(t))},r.prototype.applyJSON=function(t){if(t="string"===$.type(t)?JSON.parse(t):t,this.clear(!0,!1),void 0===t[_JGKeyword.key.columnInfo]){for(var e=t.length,r=0;e>r;++r){this._insertRow(r);for(var n in t[r])this._setColumnValue(n,r,t[r][n],!0,!1)}this.apply(!1)}else{for(var a=t[_JGKeyword.key.columnInfo],i=t[_JGKeyword.key.rowData],s=t[_JGKeyword.key.deletedRowData],u=a.length,l=0;u>l;++l){var d=a[l],h=this.insertColumn(d[_JGKeyword.key.name],l,!1);h.isKey(d[_JGKeyword.key.isKey])}this.apply(!1);for(var e=i.length,r=0;e>r;++r){this._insertRow(r);for(var g=this.getRow(r),_=i[r][_JGKeyword.key.row],l=0;u>l;++l){var h=this.getColumn(l),w=_[h.getName()];g.setColumn(h.getName(),w[_JGKeyword.key.value],w[_JGKeyword.key.modify])}g.setRowStatus(i[r][_JGKeyword.key.rowStatus])}e=s.length;for(var r=0;e>r;++r){var g=new o;this._deletedRowData[this._deletedRowData.length]=g;for(var _=s[r][_JGKeyword.key.row],l=0;u>l;++l){var h=this.getColumn(l),w=_[h.getName()];g.setColumn(h.getName(),w[_JGKeyword.key.value],w[_JGKeyword.key.modify])}g.setRowStatus(s[r][_JGKeyword.key.rowStatus])}}$(this).trigger(_JGKeyword.trigger._datasetChanged,[NVL(arguments[1],!0)])},r.prototype.appendDataset=function(t,e){for(var o=t.getRowCount(),r=t.getColumnCount(),n=0;o>n;++n){var a=this._createRow(_JGKeyword.rowStatus.insert),i=t.getRow(n);a.setRowStatus(i.rowStatus());var s=this.getRowCount();this._rowData.insert(a,s);for(var u=0;r>u;++u){var l=t.getColumn(u).getName();this._setColumnValue(l,s,i.getColumnValue(l),e,!1),a.setColumnModification(l,i.isColumnModified(l))}$(this).trigger(_JGKeyword.trigger._rowInserted,[s,!0])}},r.prototype.appendJSON=function(t,e){t="string"===$.type(t)?JSON.parse(t):t,this.appendDataset(new r(t),e)},r.prototype.exportModifiedData=function(){var t=new r;t._columnInfo=$.extend(!0,[],this._columnInfo),t._deletedRowData=$.extend(!0,[],this._deletedRowData);for(var e=this.getColumnCount(),o=this.getRowCount(),n=0;o>n;++n)for(var a=0;e>a;++a){var i=this._columnInfo[a].getName();if(this.isColumnModified(i,n)){t._rowData.push(this._rowData[n]);break}}return t},r.prototype.each=function(t,e,o){isNull(t)?(t=NVL(t,0),e=NVL(e,this.getRowCount()-1)):e=NVL(e,t),o=NVL(o,function(){});for(var r=t;e>=r&&o.apply(this,[r])!==!1;++r);},r.prototype.on=function(){return $(this).on(arguments)},r.prototype.bind=function(){return $(this).bind(arguments)},r.prototype.trigger=function(){return $(this).trigger(arguments)},t.JGDS=function(){return JGSelector($._JGDS,arguments)};var n=function(t,e){this._name=t,this._dataset=e};n.prototype.name=function(){return this._name},n.prototype.dataset=function(t){return void 0!==t&&(this._dataset=t),this._dataset},$._JGDS={_datasetMap:[],_convertToIndex:function(t){return"number"===$.type(t)?t:this.indexOf(t)},dataset:function(t,e){var o=this._datasetMap[this._convertToIndex(t)];if(void 0===o&&"string"===$.type(t))return o=new n(t,new r(e)),this._datasetMap.push(o),o.dataset();var a=o.dataset();return void 0===e?a:(a.applyJSON(e),a)},indexOf:function(t){for(var e=this._datasetMap.length,o=0;e>o;++o){var r=this._datasetMap[o];if("string"===$.type(t)&&r.name()===t)return o;if(r.dataset()===t)return o}return-1},datasetName:function(t){for(var e=this._datasetMap.length,o=0;e>o;++o){var r=this._datasetMap[o];if(r.dataset()===t)return r.name()}return void 0},remove:function(t){var e=this._convertToIndex(t);return-1===e?void 0:void this._datasetMap.remove(e)},make:function(){for(var t=new Array,e=arguments.length,o=0;e>o;++o)t.push(this.dataset(arguments[o]));return t}}}(window);