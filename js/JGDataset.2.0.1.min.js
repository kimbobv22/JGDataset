(function(d){if($===undefined||$===null){console.error("can't not initialize JGDataset, JQuery not found");return;}d._JGKeyword={key:{row:"row",column:"col",columnInfo:"columninfo",rowData:"rowdata",deletedRowData:"deletedRowdata",name:"name",isKey:"isKey",value:"value",rowStatus:"status",modify:"modify"},trigger:{_rowInserted:"_jgRowInserted",_rowRemoved:"_jgRowRemoved",_rowMoved:"_jgRowMoved",_columnAdded:"_jgColumnAdded",_columnRemoved:"_jgColumnRemoved",_columnValueChanged:"_jgColumnValueChanged",_datasetSorted:"_jgDatasetSorted",_datasetChanged:"_jgDatasetChanged",_datasetClear:"_jgDatasetClear",_datasetReset:"_jgDatasetReset",_datasetApply:"_jgDatasetApply",rowInserted:"rowinserted",rowRemoved:"rowremoved",rowMoved:"rowmoved",columnAdded:"columnadded",columnRemoved:"columnremoved",columnValueChanged:"columnvaluechanged",datasetSorted:"datasetsorted",datasetChanged:"datasetchanged",datasetClear:"datasetclear",datasetReset:"datasetreset",datasetApply:"datasetapply"},rowStatus:{normal:0,insert:1,update:3}};var f=d.JGSelector=(function(j,i){if(i.length===0){return j;}var g=Array.prototype.slice.call(i);var h=j[g[0]];if(h===undefined){console.error(g[0]+" is undefined");return undefined;}else{if($.type(h)!=="function"){console.error(g[0]+" is not function");return undefined;}else{return h.apply(j,g.slice(1));}}});d.isNull=(function(g){return(g===undefined||g===null);});d.NVL=(function(g,h){return NVL2(g,g,h);});d.NVL2=(function(g,i,h){return(!isNull(g)?i:h);});d.isBlank=(function(g){return(isNull(g)||g.length===0);});d.BLK=(function(g,h){return isBlank(g)?(h===undefined?"":h):g;});Array.prototype.indexOf=(function(h){var g=this.length;for(var i=0;i<g;++i){if(this[i]===h){return i;}}return -1;});Array.prototype.insert=(function(g,h){this.splice(h,0,g);});Array.prototype.remove=(function(g){this.splice(g,1);});Array.prototype.removeAll=(function(){this.splice(0,this.length);});Array.prototype.removeObject=(function(g){this.remove(this.indexOf(g));});Array.prototype.move=function(g,i){var h=this[g];this[g]=this[i];this[i]=h;};var b=(function(g){this._name=g.toUpperCase();this._isKey=false;});b.prototype.getName=(function(){return this._name;});b.prototype.isKey=(function(g){if(g!==undefined){this._isKey=g;}return this._isKey;});b.prototype.clone=(function(){var g=new b(this._name);g._isKey=this._isKey;return g;});var e=(function(){this._columns={};this._orgColumns={};this._columnStatus={};this._rowStatus=_JGKeyword.rowStatus.normal;});e.prototype.getRowStatus=(function(){return this._rowStatus;});e.prototype.setRowStatus=(function(g){this._rowStatus=g;});e.prototype._updateRowStatus=(function(){if(this._rowStatus===_JGKeyword.rowStatus.insert){return;}var h=false;for(var g in this._columnStatus){if(NVL(this._columnStatus[g],false)){h=true;break;}}this._rowStatus=(h?_JGKeyword.rowStatus.update:_JGKeyword.rowStatus.normal);});e.prototype.setColumn=(function(i,g,h){i=i.toUpperCase();this._columns[i]=g;if(isNull(h)){this._columnStatus[i]=(this._orgColumns[i]!==g);}else{this._columnStatus[i]=h;}this._updateRowStatus();});e.prototype.removeColumn=(function(g){delete this._columns[g.toUpperCase()];});e.prototype.getColumnValue=(function(g){return this._columns[g.toUpperCase()];});e.prototype.isColumnModified=(function(h){var g=this._columnStatus[h.toUpperCase()];return NVL2(g,g,false);});e.prototype.setColumnModification=(function(h,g){this._columnStatus[h.toUpperCase()]=g;});e.prototype.apply=(function(){this._orgColumns=JSON.parse(JSON.stringify(this._columns));this._rowStatus=_JGKeyword.rowStatus.normal;this._columnStatus={};});e.prototype.clone=(function(){var g=new e();g._columns=$.extend(true,{},this._columns);g._orgColumns=$.extend(true,{},this._orgColumns);g._columnStatus=$.extend(true,{},this._columnStatus);g._rowStatus=this._rowStatus;return g;});var c=d.JGDataset=(function(g){this._columnInfo=new Array();this._orgColumnInfo=new Array();this._rowData=new Array();this._orgRowData=new Array();this._deletedRowData=new Array();$(this).on(_JGKeyword.trigger._rowInserted,function(i,j,h){if(h){$(this).trigger(_JGKeyword.trigger.rowInserted,[j]);}});$(this).on(_JGKeyword.trigger._rowRemoved,function(h,i){$(this).trigger(_JGKeyword.trigger.rowRemoved,[i]);});$(this).on(_JGKeyword.trigger._columnAdded,function(h,i){$(this).trigger(_JGKeyword.trigger.columnAdded,[i]);});$(this).on(_JGKeyword.trigger._rowMoved,function(j,h,k,i){if(i){$(this).trigger(_JGKeyword.trigger.rowMoved,[h,k]);}});$(this).on(_JGKeyword.trigger._columnRemoved,function(h,i){$(this).trigger(_JGKeyword.trigger.columnRemoved,[i]);});$(this).on(_JGKeyword.trigger._columnValueChanged,function(i,k,j,h){if(h){$(this).trigger(_JGKeyword.trigger.columnValueChanged,[k,j]);}});$(this).on(_JGKeyword.trigger._datasetSorted,function(i,j,k,h){if(h){$(this).trigger(_JGKeyword.trigger.datasetSorted,[j,k]);}});$(this).on(_JGKeyword.trigger._datasetClear,function(i,h){if(h){$(this).trigger(_JGKeyword.trigger.datasetClear);}});$(this).on(_JGKeyword.trigger._datasetReset,function(i,h){if(h){$(this).trigger(_JGKeyword.trigger.datasetReset);}});$(this).on(_JGKeyword.trigger._datasetApply,function(i,h){if(h){$(this).trigger(_JGKeyword.trigger.datasetApply);}});$(this).on(_JGKeyword.trigger._datasetChanged,function(i,h){if(h){$(this).trigger(_JGKeyword.trigger.datasetChanged);}});if(!isNull(g)){this.applyJSON(g);}});c.prototype.getName=(function(){return JGDS("datasetName",this);});c.prototype._convertColumnKeyToName=(function(g){return($.type(g)==="number"?this.getColumn(g).getName():g.toUpperCase());});c.prototype._convertColumnKeyToIndex=(function(g){return($.type(g)==="number"?g:this.indexOfColumn(g));});c.prototype.getColumnCount=(function(){return this._columnInfo.length;});c.prototype.getRowCount=(function(){return this._rowData.length;});c.prototype.getDeletedRowCount=(function(){return this._deletedRowData.length;});c.prototype.insertColumn=(function(m,j,g){var h=new b(m);this._columnInfo[j]=h;var l=this._rowData.length;for(var i=0;i<l;++i){var k=this._rowData[i];k.setColumn(m,null);}l=this._deletedRowData.length;for(var i=0;i<l;++i){var k=this._deletedRowData[i];k.setColumn(m,null);}if(NVL(g,true)){$(this).trigger(_JGKeyword.trigger._columnAdded,[h.getName()]);}return h;});c.prototype.addColumn=(function(h,g){return this.insertColumn(h,this._columnInfo.length,g);});c.prototype.addColumns=(function(){var g=arguments.length;for(var h=0;h<g;++h){this.addColumn(arguments[h]);}});c.prototype.removeColumn=(function(g){g=this._convertColumnKeyToIndex(g);var h=this.getColumn(g).getName();this._columnInfo.splice(g,1);$(this).trigger(_JGKeyword.trigger._columnRemoved,[h]);});c.prototype.getColumn=(function(g){g=this._convertColumnKeyToIndex(g);return this._columnInfo[g];});c.prototype.indexOfColumn=(function(i){var g=this._columnInfo.length;for(var h=0;h<g;++h){if(this._columnInfo[h].getName()===i.toUpperCase()){return h;}}return -1;});c.prototype._createRow=(function(h){var j=new e();j.setRowStatus(h);var k=this._columnInfo.length;for(var i=0;i<k;++i){var g=this._columnInfo[i];j.setColumn(g.getName(),null);}return j;});c.prototype._insertRow=(function(g){var h=this._createRow(_JGKeyword.rowStatus.insert);this._rowData.insert(h,g);return h;});c.prototype.insertRow=(function(g){var h=this._insertRow(g);$(this).trigger(_JGKeyword.trigger._rowInserted,[g,true]);return h;});c.prototype.addRow=(function(){var g=this._rowData.length;this.insertRow(g);return g;});c.prototype.addRows=(function(g){for(var h=0;h<g;++h){this.addRow();}});c.prototype._removeRow=(function(g){var h=this.getRow(g);switch(h.getRowStatus()){case _JGKeyword.rowStatus.normal:case _JGKeyword.rowStatus.update:this._deletedRowData.push(h);break;case _JGKeyword.rowStatus.insert:default:break;}this._rowData.remove(g);});c.prototype.removeRow=(function(g){this._removeRow(g);$(this).trigger(_JGKeyword.trigger._rowRemoved,[g]);});c.prototype.getRow=(function(g){return this._rowData[g];});c.prototype.setRowStatus=(function(g,h){this.getRow(g).setRowStatus(h);});c.prototype.getRowStatus=(function(g){return this.getRow(g).getRowStatus();});c.prototype.getDeletedRow=(function(g){return this._deletedRowData[g];});c.prototype.moveRow=(function(i,h,g){this._rowData.move(i,h);$(this).trigger(_JGKeyword.trigger._rowMoved,[i,h,NVL(g,true)]);});c.prototype.sortRow=(function(q,p,j){var o=this.getRowCount();var g=null;var l=false;var k=o-1;var r=0;for(var n=0;n<o;++n){for(var i=0;i<o;++i){var h=this.getColumnValue(q,n);var m=this.getColumnValue(q,i);if(p.apply(this,[h,m])){l=true;if(n<k){k=n;}if(i>r){r=i;}g=this._rowData[n];this._rowData[n]=this._rowData[i];this._rowData[i]=g;}}}if(l){$(this).trigger(_JGKeyword.trigger._datasetSorted,[k,r,NVL(j,true)]);}});c.prototype.sortRowByAsc=(function(g){this.sortRow(g,function(i,h){return i<h;});});c.prototype.sortRowByDesc=(function(g){this.sortRow(g,function(i,h){return h<i;});});c.prototype._setColumnValue=(function(l,k,h,g,i){if($.type(l)==="number"){var j=this.getColumn(l);l=j.getName();}else{var m=this.indexOfColumn(l);if(m<0){if(!NVL(g,false)){console.error("not exists column ["+l+"]");}else{this.addColumn(l,i);}}}var n=this.getRow(k);n.setColumn(l,h);});c.prototype.setColumnValue=(function(k,j,i,h){k=this._convertColumnKeyToName(k);var g=this.getColumnValue(k,j);this._setColumnValue(k,j,i,h);if(g!==i){$(this).trigger(_JGKeyword.trigger._columnValueChanged,[k,j,true]);}});c.prototype.setColumnValues=(function(h,j,g){for(var i in h){this.setColumnValue(i,j,h[i],g);}});c.prototype.getColumnValue=(function(h,g){return this.getRow(g).getColumnValue(this._convertColumnKeyToName(h));});c.prototype.isColumnModified=(function(h,g){return this.getRow(g).isColumnModified(this._convertColumnKeyToName(h));});c.prototype.getDeletedColumnValue=(function(h,g){return this.getDeletedRow(g).getColumnValue(this._convertColumnKeyToName(h));});c.prototype.clear=(function(g){if(NVL(g,true)){this._columnInfo=new Array();}this._rowData=new Array();this._deletedRowData=new Array();$(this).trigger(_JGKeyword.trigger._datasetClear,[NVL(arguments[1],true)]);});c.prototype.apply=(function(g){this._orgRowData=new Array();this._orgColumnInfo=new Array();var k=this._rowData.length;for(var h=0;h<k;++h){var j=this.getRow(h);j.apply();this._orgRowData.push(j.clone());}var l=this._columnInfo.length;for(var i=0;i<l;++i){this._orgColumnInfo.push(this.getColumn(i).clone());}this._deletedRowData=new Array();$(this).trigger(_JGKeyword.trigger._datasetApply,[NVL(g,true)]);});c.prototype.reset=(function(g){this._columnInfo=new Array();this._rowData=new Array();var j=this._orgRowData.length;for(var h=0;h<j;++h){this._rowData.push(this._orgRowData[h].clone());}var k=this._orgColumnInfo.length;for(var i=0;i<k;++i){this._columnInfo.push(this._orgColumnInfo[i].clone());}this._deletedRowData=new Array();$(this).trigger(_JGKeyword.trigger._datasetReset,[NVL(g,true)]);});c.prototype.isModified=(function(){var h=this.getRowCount();for(var g=0;g<h;++g){if(this.getRowStatus(g)!==_JGKeyword.rowStatus.normal){return true;}}return false;});c.prototype.sumOfColumnValues=(function(k,j){var h=0;var m=this.getRowCount();var g=this.getColumn(k);for(var i=0;i<m;++i){if(NVL2(j,j,function(){return true;})(g.getName(),i)){var l=this.getColumnValue(g.getName(),i);h+=(isNull(l)||isNaN(l)?0:new Number(l));}}return h;});c.prototype.avgOfColumnValues=(function(i,h){var g=this.sumOfColumnValues(i,h);var k=this.getRowCount();var j=(g/k);return isNaN(j)?0:j;});c.prototype._calcOfColumnValues=(function(j,k,i){var m=undefined;var l=this.getRowCount();var g=this.getColumn(j);for(var h=0;h<l;++h){var n=this.getColumnValue(g.getName(),h);if(isNull(n)||isNaN(n)||!NVL2(i,i,function(){return true;})(g.getName(),h)){continue;}if(isNull(m)||new Function("return ("+m+k+n+");").apply(this)){m=n;}}return m;});c.prototype.maxOfColumnValues=(function(h,g){return this._calcOfColumnValues(h,"<",g);});c.prototype.minOfColumnValues=(function(h,g){return this._calcOfColumnValues(h,">",g);});c.prototype.toJSON=(function(h){if(NVL(h,false)){var v=new Array();var s=this._rowData.length;var j=this._columnInfo.length;for(var t=0;t<s;++t){var q=this._rowData[t];var u={};for(var k=0;k<j;++k){var n=this._columnInfo[k];u[n.getName()]=q.getColumnValue(n.getName());}v.push(u);}return v;}else{var r={};var o=new Array();var j=this._columnInfo.length;for(var k=0;k<j;++k){var n=this._columnInfo[k];var g={};g[_JGKeyword.key.name]=n.getName();g[_JGKeyword.key.isKey]=n.isKey();o[k]=g;}r[_JGKeyword.key.columnInfo]=o;var m=new Array();var s=this._rowData.length;for(var t=0;t<s;++t){var q=this._rowData[t];var u={};var p={};for(var k=0;k<j;++k){var n=this._columnInfo[k];var g={};g[_JGKeyword.key.value]=this.getColumnValue(n.getName(),t);g[_JGKeyword.key.modify]=q.isColumnModified(n.getName());p[n.getName()]=g;}u[_JGKeyword.key.row]=p;u[_JGKeyword.key.rowStatus]=q.getRowStatus();m[t]=u;}r[_JGKeyword.key.rowData]=m;var i=new Array();s=this._deletedRowData.length;for(var t=0;t<s;++t){var q=this._rowData[t];var u={};var p={};for(var k=0;k<j;++k){var n=this._columnInfo[k];var l=this.getDeletedColumnValue(n.getName(),t);var g={};g[_JGKeyword.key.value]=l;p[n.getName()]=g;}u[_JGKeyword.key.row]=p;i[t]=u;}r[_JGKeyword.key.deletedRowData]=i;return r;}});c.prototype.toJSONString=(function(g){return JSON.stringify(this.toJSON(g));});c.prototype.applyJSON=(function(g){g=($.type(g)==="string"?JSON.parse(g):g);this.clear(true,false);if(g[_JGKeyword.key.columnInfo]===undefined){var r=g.length;for(var s=0;s<r;++s){this._insertRow(s);for(var o in g[s]){this._setColumnValue(o,s,g[s][o],true,false);}}this.apply(false);}else{var p=g[_JGKeyword.key.columnInfo];var m=g[_JGKeyword.key.rowData];var i=g[_JGKeyword.key.deletedRowData];var k=p.length;for(var j=0;j<k;++j){var h=p[j];var n=this.insertColumn(h[_JGKeyword.key.name],j,false);n.isKey(h[_JGKeyword.key.isKey]);}this.apply(false);var r=m.length;for(var s=0;s<r;++s){this._insertRow(s);var q=this.getRow(s);var t=m[s][_JGKeyword.key.row];for(var j=0;j<k;++j){var n=this.getColumn(j);var l=t[n.getName()];q.setColumn(n.getName(),l[_JGKeyword.key.value],l[_JGKeyword.key.modify]);}q.setRowStatus(m[s][_JGKeyword.key.rowStatus]);}r=i.length;for(var s=0;s<r;++s){var q=new e();this._deletedRowData[this._deletedRowData.length]=q;var t=i[s][_JGKeyword.key.row];for(var j=0;j<k;++j){var n=this.getColumn(j);var l=t[n.getName()];q.setColumn(n.getName(),l[_JGKeyword.key.value],l[_JGKeyword.key.modify]);}q.setRowStatus(i[s][_JGKeyword.key.rowStatus]);}}$(this).trigger(_JGKeyword.trigger._datasetChanged,[NVL(arguments[1],true)]);});c.prototype.appendDataset=(function(g,h){var o=g.getRowCount();var j=g.getColumnCount();for(var p=0;p<o;++p){var n=this._createRow(_JGKeyword.rowStatus.insert);var l=g.getRow(p);n.setRowStatus(l.rowStatus());var k=this.getRowCount();this._rowData.insert(n,k);for(var i=0;i<j;++i){var m=g.getColumn(i).getName();this._setColumnValue(m,k,l.getColumnValue(m),h,false);n.setColumnModification(m,l.isColumnModified(m));}$(this).trigger(_JGKeyword.trigger._rowInserted,[k,true]);}});c.prototype.appendJSON=(function(h,g){h=($.type(h)==="string"?JSON.parse(h):h);this.appendDataset(new c(h),g);});c.prototype.exportModifiedData=(function(){var h=new c();h._columnInfo=$.extend(true,[],this._columnInfo);h._deletedRowData=$.extend(true,[],this._deletedRowData);var l=this.getColumnCount();var k=this.getRowCount();for(var g=0;g<k;++g){for(var i=0;i<l;++i){var j=this._columnInfo[i].getName();if(this.isColumnModified(j,g)){h._rowData.push(this._rowData[g]);break;}}}return h;});d.JGDS=(function(){return JGSelector($._JGDS,arguments);});var a=(function(h,g){this._name=h;this._dataset=g;});a.prototype.name=(function(){return this._name;});a.prototype.dataset=(function(g){if(g!==undefined){this._dataset=g;}return this._dataset;});$._JGDS={_datasetMap:[],_convertToIndex:function(g){return($.type(g)==="number"?g:this.indexOf(g));},dataset:function(g,j){var i=this._datasetMap[this._convertToIndex(g)];if(i===undefined&&$.type(g)==="string"){i=new a(g,new c(j));this._datasetMap.push(i);return i.dataset();}var h=i.dataset();if(j===undefined){return h;}else{h.applyJSON(j);return h;}},indexOf:function(h){var g=this._datasetMap.length;for(var i=0;i<g;++i){var j=this._datasetMap[i];if($.type(h)==="string"&&j.name()===h){return i;}else{if(j.dataset()===h){return i;}}}return -1;},datasetName:function(h){var g=this._datasetMap.length;for(var i=0;i<g;++i){var j=this._datasetMap[i];if(j.dataset()===h){return j.name();}}return undefined;},remove:function(g){var h=this._convertToIndex(g);if(h===-1){return undefined;}this._datasetMap.remove(h);},make:function(){var g=new Array();var i=arguments.length;for(var h=0;h<i;++h){g.push(this.dataset(arguments[h]));}return g;}};})(window);