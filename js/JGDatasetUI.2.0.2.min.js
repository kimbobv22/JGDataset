(function(e){if(JGDS===undefined){console.error("can't not initialize JGDataset UI, JGDataset not found");return;}_JGKeyword=$.extend(true,e._JGKeyword,{ui:{attrDataset:"jg-dataset",attrColumn:"jg-column",attrBindDataset:"jg-bind-dataset",attrDisplayColumn:"jg-display-column",attrValueColumn:"jg-value-column",keyFXPrefix:"##fx:",trigger:{rowMapped:"datasetuirowmapped",refreshed:"datasetuirefreshed",FXRefreshed:"datasetuifxrefreshed",columnRefreshed:"datasetuicolumnrefreshed",mappingReloaded:"datasetuimappingreloaded"}},select:{trigger:{selectReloaded:"selectreloaded"}}});String.prototype._jgFuncConvertToColumnRegexp=(function(){return new RegExp("\\#\\#("+this+")\\#\\#","gi");});String.prototype._jgFuncReplaceRegexpByDataset=(function(f,q){var p=this;p=p.replace("dataset\\.rowIndex"._jgFuncConvertToColumnRegexp(),q);p=p.replace("dataset\\.rowStatus"._jgFuncConvertToColumnRegexp(),f.getRowStatus(q));p=p.replace("dataset\\.rowCount"._jgFuncConvertToColumnRegexp(),f.getRowCount());p=p.replace("dataset\\.columnCount"._jgFuncConvertToColumnRegexp(),f.getColumnCount());var h="dataset\\.sum\\([\\s\\w\\#\\@\\-\\+\\*\\/\\%]*\\)"._jgFuncConvertToColumnRegexp();if(h.test(p)){var i=f.getColumnCount();for(var j=0;j<i;++j){var n=f.getColumn(j);var o=n.getName();var g=o._jgFuncConvertToColumnRegexp();if(g.test(p)){var m=0;for(var l=0;l<=q;++l){var k=parseInt(f.getColumnValue(o,l));m+=k;}p=p.replace(g,m);}}p=p.replace("dataset\\.sum"._jgFuncConvertToColumnRegexp(),f.getRowCount());p=p.substr(p.indexOf("(")+1);p=p.substr(0,p.indexOf(")##"));}var i=f.getColumnCount();for(var j=0;j<i;++j){var n=f.getColumn(j);var o=n.getName();var k=f.getColumnValue(o,q);p=p.replace(o._jgFuncConvertToColumnRegexp(),"this.getColumnValue('"+o+"',"+q+")");}return p;});$.fn.insertAtIndex=(function(g,h){var f=this.children().size();if(h<0){h=Math.max(0,f+1+h);}this.append(g);if(h<f){this.children().eq(h).before(this.children().last());}return this;});$.fn.selectValue=(function(){if(this.prop("tagName").toLowerCase()!=="select"){return undefined;}return this.children("option:selected").first().attr("value");});$.fn._jexecute=(function(h,f){var g=new Array();$.each(this,function(){g.push(h.call($(this),f));});return g.length>1?g:g[0];});JGDataset.prototype.datasetUIView=(function(){return $(document).find("["+_JGKeyword.ui.attrDataset+"='"+this.getName()+"']").filter(function(){return $(this)._jgDatasetUIInitialized();});});var a=e.JGDatasetUI=(function(i,g){var f=this;this._element=i;this._datasetName=NVL(g,i.attr(_JGKeyword.ui.attrDataset));if(isNull(this.dataset())){console.error("can't find JGDataset");return;}this._originalRowContent=this._element.children().first().clone(true);this._element.empty();this._rowContents=new Array();var h=this.dataset();$(h).on(_JGKeyword.trigger._rowInserted,function(j,k){f._insertRowContent(k);});$(h).on(_JGKeyword.trigger._rowRemoved,function(j,k){f._removeRowContent(k);});$(h).on(_JGKeyword.trigger._rowMoved,function(k,j,l){if(j>l){f._refresh(l,j);}else{f._refresh(j,l);}});$(h).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved,function(j,k){f._refreshColumn(k,undefined,undefined,false);f._refreshFX();});$(h).on(_JGKeyword.trigger._columnValueChanged,function(j,l,k){f._refreshColumn(l,k,undefined,false);f._refreshFX();});$(h).on(_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(j,k,l){f.reload();});$(h).on(_JGKeyword.trigger._datasetApply,function(j){f._refreshFX();});this.reload();});a.prototype.element=(function(){return this._element;});a.prototype.dataset=(function(){return JGDS("dataset",this._datasetName);});a.prototype.rowContent=(function(f){return this._rowContents[f];});a.prototype._insertRowContent=(function(f){var g=new d(this,this._originalRowContent);this._rowContents.insert(g,f);this.element().insertAtIndex(g.rowContent(),f);this._refresh(f,undefined,false);this.element().trigger(_JGKeyword.ui.trigger.rowMapped,[f]);return g;});a.prototype._removeRowContent=(function(f){var g=this.rowContent(f);g.rowContent().remove();this._rowContents.remove(f);this._refreshFX(f);});a.prototype.indexOf=(function(f){return this._rowContents.indexOf(f);});a.prototype.__rowRangeRefresh=(function(g,i,f){var j=this.dataset().getRowCount();if(isNull(g)){g=NVL(g,0);i=NVL(i,j-1);}else{i=NVL(i,g);}for(var h=g;h<=i;++h){f(this,h);}});a.prototype._refreshFX=(function(f,h,g){this.__rowRangeRefresh(f,h,function(i,j){i.rowContent(j)._refreshFX();if(NVL(g,true)){$(i.element()).trigger(_JGKeyword.ui.trigger.FXRefreshed,[j]);}});});a.prototype._refreshColumn=(function(i,f,h,j,g){j=NVL(j,true);this.__rowRangeRefresh(f,h,function(k,l){k.rowContent(l)._refreshColumn(i,j);if(NVL(g,true)){$(k.element()).trigger(_JGKeyword.ui.trigger.columnRefreshed,[i,l]);}});});a.prototype._refresh=(function(f,h,g){this.__rowRangeRefresh(f,h,function(i,j){i.rowContent(j)._refresh();if(NVL(g,true)){$(i.element()).trigger(_JGKeyword.ui.trigger.refreshed,[j]);}});});a.prototype.reload=(function(){this.element().empty();this._rowContents=new Array();var g=this.dataset();var h=g.getRowCount();var f=0;while(f<h){this._insertRowContent(this._rowContents.length);++f;}$(this.element()).trigger(_JGKeyword.ui.trigger.mappingReloaded);});$.fn._jgDatasetUI=(function(f){if(f!==undefined){this.data("jgdatasetJGDatasetUI",f);}return this.data("jgdatasetJGDatasetUI");});$.fn._jgDatasetUIInitialized=(function(f){if(f!==undefined){this.data("jgdataset_jgDatasetInitialized",f);}return NVL(this.data("jgdataset_jgDatasetInitialized"),false);});$.fn.JGDatasetUI=(function(){return this._jexecute(function(f){if(!this._jgDatasetUIInitialized()){this._jgDatasetUI(new a(this,f[0]));this._jgDatasetUIInitialized(true);}return JGSelector(this._jgDatasetUI(),f);},arguments);});$.fn._jgDataRowContent=(function(f){if(f===undefined){return this.data("jgdataset_rowContent");}this.data("jgdataset_rowContent",f);return this.data("jgdataset_rowContent");});$.fn._jgDataJGDataset=(function(){return this._jgDataRowContent().datasetUI().dataset();});var d=(function(h,p){this._datasetUI=h;this._rowContent=p.clone(true,true);this._mappedElements=new Array();this._FXElements=new Array();var w=this._rowContent.find("*["+_JGKeyword.ui.attrColumn+"]");var r=w.length;for(var k=0;k<r;++k){var x=$(w[k]);var n=x.prop("tagName").toLowerCase();x._jgDataRowContent(this);this._mappedElements.push(x);var o=(function(y){var D=$(y.target);var C=D._jgDataRowContent();var A=C.datasetUI().dataset();var B=D.attr(_JGKeyword.ui.attrColumn);var z=C.rowIndex();A.setColumnValue(B,z,D.val(),true);});if(n==="input"){var g=NVL(x.attr("type"),"text");if(g==="checkbox"){x.on("click change",function(y){var D=$(y.target);var C=D._jgDataRowContent();var A=C.datasetUI().dataset();var B=D.attr(_JGKeyword.ui.attrColumn);var z=C.rowIndex();A.setColumnValue(B,z,D.prop("checked"),true);});}else{x.on("keyup change",o);}}else{if(n==="textarea"){x.on("change",function(y){var D=$(y.target);var C=D._jgDataRowContent();var A=C.datasetUI().dataset();var B=D.attr(_JGKeyword.ui.attrColumn);var z=C.rowIndex();A.setColumnValue(B,z,D.val(),true);});x.on("keyup",function(y){var z=$(y.target);z.trigger("change");});}else{if(n==="div"&&x.prop("contenteditable")){x.on("change",function(y){var D=$(y.target);var C=D._jgDataRowContent();var A=C.datasetUI().dataset();var B=D.attr(_JGKeyword.ui.attrColumn);var z=C.rowIndex();A.setColumnValue(B,z,D.html(),true);});x.on("keyup",function(y){var z=$(y.target);z.trigger("change");});}else{if(n==="select"){if(!isNull(x.attr(_JGKeyword.ui.attrBindDataset))){x.JGSelect();}x.on("change",function(y){var D=$(y.target);var C=D._jgDataRowContent();var A=C.datasetUI().dataset();var B=D.attr(_JGKeyword.ui.attrColumn);var z=C.rowIndex();A.setColumnValue(B,z,D.selectValue(),true);});$(x).on(_JGKeyword.select.trigger.selectReloaded,function(y){var D=$(y.target);var C=D._jgDataRowContent();var A=C.datasetUI().dataset();var B=D.attr(_JGKeyword.ui.attrColumn);var z=C.rowIndex();D.val(A.getColumnValue(B,z));});}else{}}}}}var q=this._rowContent.find("*");q.push(this._rowContent);var t=q.length;for(var m=0;m<t;++m){var l=$(q[m]);var u=l[0].attributes;var i=u.length;for(var j=0;j<i;++j){var f=u[j];var s=f.name.toLowerCase();if(f.name.toLowerCase()!=="jg-column"&&BLK(f.value).replace(/^[\n\t]*/g,"").indexOf(_JGKeyword.ui.keyFXPrefix)===0){this._FXElements.push(new b(this,l,s,0));}}var v=l.html();if(BLK(v).replace(/^[\n\t]*/g,"").indexOf(_JGKeyword.ui.keyFXPrefix)===0){this._FXElements.push(new b(this,l,null,1));}}});d.prototype.datasetUI=(function(){return this._datasetUI;});d.prototype.rowIndex=(function(){return this.datasetUI().indexOf(this);});d.prototype.rowContent=(function(){return this._rowContent;});d.prototype.mappedElements=(function(){return this._mappedElements;});d.prototype.FXElements=(function(){return this._FXElements;});d.prototype._refreshFX=(function(){var f=this.FXElements();var g=f.length;for(var h=0;h<g;++h){f[h].update();}});d.prototype._refreshColumn=(function(j,g){j=j.toUpperCase();g=NVL(g,true);var i=this.datasetUI().dataset().getColumnValue(j,this.rowIndex());var f=this.mappedElements();var l=f.length;for(eIndex_=0;eIndex_<l;++eIndex_){var h=$(f[eIndex_]);if(h.attr("jg-column").toUpperCase()===j){var k=h.prop("tagName").toLowerCase();if(k==="input"&&h.attr("type")==="checkbox"){i=(i===true||i==="true");if(h.prop("checked")!==i){h.prop("checked",i);}}else{if(k==="input"){if(h.val()!==i){h.val(i);}}else{if(k==="textarea"){if(h.val()!==i){h.val(i);}}else{if(k==="select"){if(h.val()!==i){h.val(i);}}else{i=BLK(i);if(h.html()!==i){h.html(i);}}}}}}}if(g){this._refreshFX();}});d.prototype._refresh=(function(){var f=this.datasetUI().dataset();var h=f.getColumnCount();for(var g=0;g<h;++g){this._refreshColumn(f.getColumn(g).getName(),false);}this._refreshFX();});var b=(function(i,g,h,f){this._rowContent=i;this._element=g;this._attrName=h;this._type=f;switch(f){case 0:this._fx=g.attr(h).replace(/^[\n\t]*/g,"").substr(_JGKeyword.ui.keyFXPrefix.length);break;case 1:this._fx=g.html().replace(/^[\n\t]*/g,"").substr(_JGKeyword.ui.keyFXPrefix.length);break;default:console.error("invaild FX Element Type");break;}});b.prototype.rowContent=(function(){return this._rowContent;});b.prototype.element=(function(){return this._element;});b.prototype.attrName=(function(){return this._attrName;});b.prototype.type=(function(){return this._type;});b.prototype.update=(function(){var j=this.rowContent();var h=j.datasetUI().dataset();var g=j.rowIndex();var f=null;try{f=BLK(new Function("return "+this._fx._jgFuncReplaceRegexpByDataset(h,g)+";").apply(h));}catch(i){f="##fx Exception: "+i.toString()+", statement: "+this._fx+"##";}switch(this.type()){case 0:this.element().attr(this.attrName(),f);break;case 1:this.element().html(f);break;default:console.error("invaild FX Element Type");break;}});var c=(function(h,i){var f=this;i=$.extend({datasetName:h.attr(_JGKeyword.ui.attrBindDataset),displayColumn:h.attr(_JGKeyword.ui.attrDisplayColumn),valueColumn:h.attr(_JGKeyword.ui.attrValueColumn)},i);this._element=h;this._datasetName=i.datasetName;this._displayColumn=i.displayColumn;this._valueColumn=i.valueColumn;var g=this.dataset();$(g).on(_JGKeyword.trigger._rowInserted+" "+_JGKeyword.trigger._rowRemoved+" "+_JGKeyword.trigger._rowMoved+" "+_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved+" "+_JGKeyword.trigger._columnValueChanged+" "+_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(j,k){f.reload();});this.reload();});c.prototype.element=(function(){return this._element;});c.prototype.dataset=(function(){return JGDS("dataset",this._datasetName);});c.prototype.displayColumn=(function(){return this._displayColumn;});c.prototype.valueColumn=(function(){return this._valueColumn;});c.prototype.reload=(function(){var i=this.element();i.empty();function f(l,k){return $("<option value='"+k+"'>"+l+"</option>");}var h=this.dataset();var j=h.getRowCount();for(var g=0;g<j;++g){i.append(f(h.getColumnValue(this.displayColumn(),g),h.getColumnValue(this.valueColumn(),g)));}i.trigger(_JGKeyword.select.trigger.selectReloaded);});$.fn._jgSelect=(function(f){if(f!==undefined){this.data("jgdatasetJGSelect",f);}return this.data("jgdatasetJGSelect");});$.fn._jgSelectInitialized=(function(f){if(f!==undefined){this.data("jgdatasetJGSelectInitialized",f);}return NVL(this.data("jgdatasetJGSelectInitialized"),false);});$.fn.JGSelect=(function(){return this._jexecute(function(f){if(!this._jgSelectInitialized()){this._jgSelect(new c(this,f[0]));this._jgSelectInitialized(true);}return JGSelector(this._jgSelect(),f);},arguments);});})(window);