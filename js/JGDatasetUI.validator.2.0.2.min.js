(function(c){if(JGDatasetUI===undefined){console.error("can't not initialize JGValidator, JGDataset UI not found");return;}function e(i,h){for(var g in i){if(g.toUpperCase()===h.toUpperCase()){return i[g];}}return undefined;}function a(h){var i=0;for(var g in h){if(h.hasOwnProperty(g)){++i;}}return i;}function b(h,j){var i=0;for(var g in h){if(h.hasOwnProperty(g)){if(i===j){return h[g];}++i;}}return undefined;}_JGKeyword=$.extend(true,_JGKeyword,{validator:{errorColumn:"jg-error-column",validColumn:"jg-valid-column"}});var f=c.JGValidator=(function(i){this._datasetUI=i;this._engine=$.extend(true,{},f.prototype._engine);this._failedMessages=$.extend(true,{},f.prototype._failedMessages);this._validators={};this._cause={};this._onValidate=false;var g=this;var h=this.dataset();$(h).on(_JGKeyword.trigger._columnValueChanged,function(j,l,k){if(g._options.realtimeCheck){g._singleValidate(l,k,function(){});}});$(h).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved+" "+_JGKeyword.trigger._rowInserted+" "+_JGKeyword.trigger._rowRemoved+" "+_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged,function(j,k){g.refresh();});this.refresh();});f.prototype.datasetUI=(function(){return this._datasetUI;});f.prototype.dataset=(function(){return this._datasetUI.dataset();});f.prototype.isValid=(function(){var i=this.dataset();var m=i.getRowCount();var j=this._validators;for(var l in this._validators){var g=this._cause[l];if(g===undefined){return false;}var n=this._validators[l];if(m!==g.length){return false;}for(var h in g){var k=g[h];if(isNull(k)||a(k)>0){return false;}}}return true;});f.prototype.engine=(function(g){if(g!==undefined){this._engine=$.extend(true,this._engine,g);}return this._engine;});f.prototype.failedMessages=(function(g){if(g!==undefined){this._failedMessages=$.extend(true,this._failedMessages,g);this._updateErrorLabels();}return this._failedMessages;});f.prototype.commonFailedMessages=(function(g){if(g!==undefined){this._commonFailedMessages=$.extend(true,this._commonFailedMessages,g);}return this._commonFailedMessages;});f.prototype.cause=(function(){var g={};for(var i in this._cause){g[i]={};for(var h=this._cause[i].length-1;h>=0;--h){if(a(this._cause[i][h])>0){g[i][h]=this._cause[i][h];}}if(a(g[i])===0){delete g[i];}}return g;});f.prototype.refresh=(function(){this._validators={};this._cause={};var g=this.datasetUI();var h=this.dataset();var i=g._originalRowContent;var j=h.getColumnCount();for(var k=0;k<j;++k){var n=h.getColumn(k).getName();var o=i.find("*["+_JGKeyword.ui.attrColumn+"]").filter(function(){return $(this).attr(_JGKeyword.ui.attrColumn).toUpperCase()===n;});this._validators[n]={};var m=o.filter(function(){return $(this).attr("required")!==undefined;});var q=m.length;for(var p=0;p<q;++p){this._validators[n].required={name:"required"};}m=o.filter(function(){return $(this).attr("maxLength")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].maxLength={name:"maxLength",length:parseInt(r.attr("maxLength"))};}m=o.filter(function(){return $(this).attr("minLength")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].minLength={name:"minLength",length:parseInt(r.attr("minLength"))};}m=o.filter(function(){return $(this).attr("length")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].length={name:"length",length:parseInt(r.attr("length"))};}m=o.filter(function(){return $(this).attr("equals")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].equals={name:"equals",value:r.attr("equals")};}m=o.filter(function(){return $(this).attr("notEquals")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].equals={name:"notEquals",value:r.attr("notEquals")};}m=o.filter(function(){return $(this).attr("range")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));var s=r.attr("range").split(",");this._validators[n].range={name:"range",from:parseInt(s[0]),to:parseInt(s[1])};}m=o.filter(function(){return $(this).attr("rangeLength")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));var s=r.attr("rangeLength").split(",");this._validators[n].rangeLength={name:"rangeLength",from:parseInt(s[0]),to:parseInt(s[1])};}m=o.filter(function(){return $(this).attr("pattern")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].pattern={name:"pattern",pattern:r.attr("pattern")};}m=o.filter(function(){return $(this).attr("patternWord")!==undefined;});q=m.length;for(var p=0;p<q;++p){this._validators[n].patternWord={name:"patternWord"};}m=o.filter(function(){return $(this).attr("patternAlphabet")!==undefined;});q=m.length;for(var p=0;p<q;++p){this._validators[n].patternAlphabet={name:"patternAlphabet"};}m=o.filter(function(){return $(this).attr("patternAlphanum")!==undefined;});q=m.length;for(var p=0;p<q;++p){this._validators[n].patternAlphanum={name:"patternAlphanum"};}m=o.filter(function(){return $(this).attr("patternEmail")!==undefined;});q=m.length;for(var p=0;p<q;++p){this._validators[n].patternEmail={name:"patternEmail"};}m=o.filter(function(){return $(this).attr("patternNumber")!==undefined;});q=m.length;for(var p=0;p<q;++p){this._validators[n].patternNumber={name:"patternNumber"};}m=o.filter(function(){return $(this).attr("patternPhone")!==undefined;});q=m.length;for(var p=0;p<q;++p){this._validators[n].patternPhone={name:"patternPhone"};}m=o.filter(function(){return $(this).attr("columnEquals")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].columnEquals={name:"columnEquals",value:r.attr("columnEquals")};}m=o.filter(function(){return $(this).attr("columnNotEquals")!==undefined;});q=m.length;for(var p=0;p<q;++p){var r=$(m.get(p));this._validators[n].columnNotEquals={name:"columnNotEquals",value:r.attr("columnNotEquals")};}var l=this;m=o.each(function(){var x=$(this).get(0).attributes;var t=x.length;for(var y=0;y<t;++y){var u=x[y];var v="(custom\\-validator\\-)+";if(new RegExp(v,"gi").test(u.name)){var w=u.name.replace("custom-validator-","");l._validators[n][w]={name:w,value:u.value};}}});this.validate(function(){});}});f.prototype._recursiveSingleValidate=(function(o,q,g,m){var k=this;var i=this.datasetUI();var j=this.dataset();var n=j.getColumnValue(o,q);var t=e(this._validators,o);m=NVL(m,function(){});var l=this._cause[o]=NVL(this._cause[o],[]);this._cause[o][q]=$.extend(true,this._cause[o][q],{});if(isNull(t)){var h=this.cause()[o];m.apply(i.element(),[h===undefined?null:h[q]]);return;}g=NVL(g,0);var s=a(t);if(g===s){var h=this.cause()[o];m.apply(i.element(),[h===undefined?null:h[q]]);return;}var p=b(t,g);var u=p.name.toLowerCase();var r=e(this._engine,u);if(isNull(r)){this._recursiveSingleValidate(o,q,g+1,m);return;}r.apply(j,[p,o,q,n,function(w){if(!w){var v={name:p.name};l[q][p.name]=v;if(k._options.stepValidation){g=s-1;}}else{delete l[q][p.name];}k._recursiveSingleValidate(o,q,g+1,m);}]);});f.prototype._singleValidate=(function(j,h,i){var g=this;this._recursiveSingleValidate(j.toUpperCase(),h,0,function(){g._updateErrorLabels();g._updateValidLabels();i.apply(g.datasetUI().element(),arguments);});});f.prototype._recursiveValidate=(function(l,j,k){var g=this;var i=this.datasetUI();var h=this.dataset();var n=h.getColumnCount();var m=h.getRowCount();l=NVL(l,0);j=NVL(j,0);k=NVL(k,function(){});if(l===n){k.apply(i.element(),[this.isValid(),this.cause()]);return;}else{if(l<n&&j===m){this._recursiveValidate(l+1,0,k);return;}else{this._singleValidate(h.getColumn(l).getName(),j,function(o){g._recursiveValidate(l,j+1,k);});return;}}});f.prototype.validate=(function(g){this._recursiveValidate(0,0,g);});f.prototype._updateErrorLabels=(function(){var j=this.datasetUI();var u=this.dataset();var w=u.getRowCount();for(var v=0;v<w;++v){var p=j.rowContent(v).rowContent();if(isNull(p)){continue;}var y=p.find("["+_JGKeyword.validator.errorColumn+"]");y.hide();y.html("");}var l=this.cause();for(var n in l){if(!l.hasOwnProperty(n)){continue;}var g=l[n];for(var v in g){if(!g.hasOwnProperty(v)){continue;}var t=g[v];var p=j.rowContent(v).rowContent();if(isNull(p)){continue;}var y=p.find("["+_JGKeyword.validator.errorColumn+"]").filter(function(){return(n.toUpperCase()===$(this).attr(_JGKeyword.validator.errorColumn).toUpperCase());});for(var r in t){var m="";var s=e(this._failedMessages,n);if(!isNull(s)){var k=e(s,r);if(!isNull(k)){m=k;}}if(isNull(m)||m.length===0){m=BLK(e(this._commonFailedMessages,r));}var q=(function(z){return new RegExp("\\{("+z+")\\}","gi");});m=m.replace(q("columnName"),n);m=m.replace(q("rowIndex"),v);m=m.replace(q("columnValue"),u.getColumnValue(n,v));for(var x in this._validators[n][r]){m=m.replace(q(x),this._validators[n][r][x]);}if(m.length>0){var o=y.length;for(var i=0;i<o;++i){var h=$(y[i]);h.show();m=$(this._options.errorMessageTag).html(m);if(NVL(this._options.appendErrorMessage,false)){h.append(m);}else{h.html(m);}}}}}}});f.prototype._updateValidLabels=(function(){var g=this.datasetUI();var i=this.dataset();var p=i.getRowCount();for(var q=0;q<p;++q){var j=g.rowContent(q).rowContent();if(isNull(j)){continue;}var n=j.find("["+_JGKeyword.validator.validColumn+"]");if(n.length>0){n.show();}}var h=this.cause();for(var m in h){if(!h.hasOwnProperty(m)){continue;}var o=h[m];for(var q in o){if(!o.hasOwnProperty(q)){continue;}var l=o[q];var j=g.rowContent(q).rowContent();if(isNull(j)){continue;}var k=j.find("["+_JGKeyword.validator.validColumn+"]").filter(function(){return(m.toUpperCase()===$(this).attr(_JGKeyword.validator.validColumn).toUpperCase());});if(k.length>0){k.hide();}}}});f.prototype._options={errorMessageTag:"<span style='display:block;' />",appendErrorMessage:true,stepValidation:true,realtimeCheck:true};f.prototype.options=(function(){if($.type(arguments[0])==="string"){if(arguments.length===2){this._options[arguments[0]]=arguments[1];if(arguments[0]==="errorMessageTag"||arguments[0]==="appendErrorMessage"){this._updateErrorLabels();}}return this._options[arguments[0]];}else{if($.type(arguments[0])==="object"){this._options=$.extend(true,this._options,arguments[0]);this.refresh();}}return this._options;});f.prototype._commonFailedMessages={required:"field is required",maxLength:"max length : {length}",minLength:"min length : {length}",length:"length : {length}",range:"range : {from} ~ {to}",rangeLength:"length : {from} ~ {to}",equals:"equals : {value}",notEquals:"not equals : {value}",pattern:"pattern : {pattern}",patternWord:"pattern word",patternAlphabet:"pattern alphabet",patternAlphanum:"pattern alphanum",patternEmail:"pattern email",patternNumber:"pattern number",patternPhone:"pattern phone",columnEquals:"column be equals to {value}",columnNotEquals:"column be not equals to {value}"};function d(j,g,h){var i=new RegExp(j,h);return i.test(BLK(g));}f.prototype._engine={_customValidate:function(k,j,g,i,h){this[k.name](k,j,g,i,h);},required:function(k,j,g,i,h){h(0<BLK(i).length);},maxLength:function(k,j,g,i,h){h(k.length>=BLK(i).length);},minLength:function(k,j,g,i,h){h(k.length<=BLK(i).length);},length:function(k,j,g,i,h){h(k.length===BLK(i).length);},range:function(l,k,g,j,i){var h=parseInt(j);i(l.from<=h&&l.to>=h);},rangeLength:function(l,k,h,j,i){var g=BLK(j).length;i(l.from<=g&&l.to>=g);},equals:function(k,j,g,i,h){h(k.value===i);},notEquals:function(k,j,g,i,h){h(k.value!==i);},pattern:function(k,j,g,i,h){h(d(k.pattern,i));},patternWord:function(k,j,g,i,h){h(d("^[\\w]+$",i));},patternAlphabet:function(k,j,g,i,h){h(d("^[a-zA-Z]+$",i));},patternAlphanum:function(k,j,g,i,h){h(d("^[0-9a-zA-Z]+$",i));},patternEmail:function(k,j,g,i,h){h(d("^[\\w\\-\\.]+@[\\w\\-\\.]+\\.[\\w]{1,5}$",i));},patternNumber:function(k,j,g,i,h){h(d("^[\\-]?[0-9]+$",i));},patternPhone:function(k,j,g,i,h){h(d("^(\\+?\\d{0,2}\\s?\\d{2,3}\\s?\\-?\\s?\\d{3,4}\\s?\\-?\\s?\\d{4})$",i));},columnEquals:function(l,k,g,j,h){var i=l.value;h(BLK(this.getColumnValue(i,g))===BLK(j));},columnNotEquals:function(l,k,g,j,h){var i=l.value;h(BLK(this.getColumnValue(i,g))!==BLK(j));}};$.fn._jgValidator=(function(g){if(g!==undefined){this.data("jgdataset_jgValidator",g);}return this.data("jgdataset_jgValidator");});$.fn._jgValidatorInitialized=(function(g){if(g!==undefined){this.data("jgdataset_jgValidatorInitialized",g);}return NVL(this.data("jgdataset_jgValidatorInitialized"),false);});$.fn.JGValidator=(function(){return this._jexecute(function(g){if(!this._jgValidatorInitialized()){this._jgValidator(new f(this.JGDatasetUI(),g[0]));this._jgValidatorInitialized(true);}return JGSelector(this._jgValidator(),g);},arguments);});})(window);