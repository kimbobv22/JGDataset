!function(t){if(void 0===JGDS)return void console.error("can't not initialize JGDatasetUI, JGDataset not found");_JGKeyword=$.extend(!0,t._JGKeyword,{ui:{attrDataset:"jg-dataset",attrColumn:"jg-column",attrBindDataset:"jg-bind-dataset",attrDisplayColumn:"jg-display-column",attrValueColumn:"jg-value-column",keyFXPrefix:"##fx:",trigger:{rowMapped:"datasetuirowmapped",refreshed:"datasetuirefreshed",FXRefreshed:"datasetuifxrefreshed",columnRefreshed:"datasetuicolumnrefreshed",mappingReloaded:"datasetuimappingreloaded"}},select:{trigger:{selectReloaded:"selectreloaded"}}}),String.prototype._jgFuncConvertToColumnRegexp=function(){return new RegExp("\\#\\#"+this+"\\#\\#","gi")},String.prototype._jgFuncReplaceRegexpByDataset=function(t,e){var n=this;n=n.replace("dataset\\.rowCount"._jgFuncConvertToColumnRegexp(),t.getRowCount()),n=n.replace("dataset\\.columnCount"._jgFuncConvertToColumnRegexp(),t.getColumnCount()),n=n.replace("dataset\\.columnName"._jgFuncConvertToColumnRegexp(),t.getColumnCount());for(var r="dataset\\.columnName\\([0-9]+\\)"._jgFuncConvertToColumnRegexp();found_=r.exec(n);){var o=found_[0],a=o.substr(o.indexOf("(")+1);a=a.substr(0,a.indexOf(")##")),n=n.replace(o,"this.getColumn("+a+").getName()")}for(var i="[\\s\\w\\#\\@\\-\\+\\*\\/\\%]*",s=("dataset\\.sum\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.sumOfColumnValues('"+u+"')")}for(s=("dataset\\.avg\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.avgOfColumnValues('"+u+"')")}for(s=("dataset\\.min\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.minOfColumnValues('"+u+"')")}for(s=("dataset\\.max\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.maxOfColumnValues('"+u+"')")}if(void 0!==e){for(s=("dataset\\.plus\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##"));for(var l=0,d=0;e>=d;++d){var g=parseInt(t.getColumnValue(u,d));l+=g}n=n.replace(o,l)}for(s=("dataset\\.minus\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##"));for(var l=parseInt(t.getColumnValue(u,0)),d=1;e>=d;++d){var g=parseInt(t.getColumnValue(u,d));l-=g}n=n.replace(o,l)}n=n.replace("dataset\\.rowIndex"._jgFuncConvertToColumnRegexp(),e),n=n.replace("dataset\\.rowStatus"._jgFuncConvertToColumnRegexp(),t.getRowStatus(e));for(var h=t.getColumnCount(),a=0;h>a;++a){var _=t.getColumn(a),u=_.getName(),g=t.getColumnValue(u,e);n=n.replace(u._jgFuncConvertToColumnRegexp(),"this.getColumnValue('"+u+"',"+e+")")}}return n},String.prototype.replaceBlank=function(t){return this.replace(/^[\n\t]*/g,t)},$.fn.insertAtIndex=function(t,e){var n=this.children().size();return 0>e&&(e=Math.max(0,n+1+e)),this.append(t),n>e&&this.children().eq(e).before(this.children().last()),this},$.fn.selectValue=function(){return"select"!==this.prop("tagName").toLowerCase()?void 0:this.children("option:selected").first().attr("value")},$.fn._jexecute=function(t,e){var n=new Array;return $.each(this,function(){n.push(t.call($(this),e))}),n.length>1?n:n[0]},JGDataset.prototype.datasetUIView=function(){return $(document).find("["+_JGKeyword.ui.attrDataset+"='"+this.getName()+"']").filter(function(){return $(this)._jgDatasetUIInitialized()})};var e=t.JGDatasetUI=function(t,n){var r=this;if(this.options=$.extend(!0,e.prototype.options),this._element=t,this._datasetName=NVL(n,t.attr(_JGKeyword.ui.attrDataset)),isNull(this.dataset()))return void console.error("can't find JGDataset");this._originalRowContent=this._element.children().first().clone(!0),this._element.empty(),this._rowContents=new Array;var o=this.dataset();$(o).on(_JGKeyword.trigger._rowInserted,function(t,e){r._insertRowContent(e)}),$(o).on(_JGKeyword.trigger._rowRemoved,function(t,e){r._removeRowContent(e)}),$(o).on(_JGKeyword.trigger._rowMoved,function(t,e,n){e>n?r._refresh(n,e):r._refresh(e,n)}),$(o).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved,function(t,e){r._refreshColumn(e,void 0,void 0,!1),r._refreshFX()}),$(o).on(_JGKeyword.trigger._columnValueChanged,function(t,e,n){r._refreshColumn(e,n,void 0,!1),r._refreshFX()}),$(o).on(_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(){r.reload()}),$(o).on(_JGKeyword.trigger._datasetApply,function(){r._refreshFX()}),this.reload()};e.prototype.options={blankToNull:!1},e.prototype.element=function(){return this._element},e.prototype.dataset=function(){return JGDS("dataset",this._datasetName)},e.prototype.rowContent=function(t){return this._rowContents[t]},e.prototype._insertRowContent=function(t){var e=new n(this,this._originalRowContent);return this._rowContents.insert(e,t),this.element().insertAtIndex(e.rowContent(),t),this._refresh(t,void 0,!1),this.element().trigger(_JGKeyword.ui.trigger.rowMapped,[t]),e},e.prototype._removeRowContent=function(t){var e=this.rowContent(t);e.rowContent().remove(),this._rowContents.remove(t),this._refreshFX(0)},e.prototype.indexOf=function(t){return this._rowContents.indexOf(t)},e.prototype.__rowRangeRefresh=function(t,e,n){var r=this.dataset().getRowCount();isNull(t)?(t=NVL(t,0),e=NVL(e,r-1)):e=NVL(e,t);for(var o=t;e>=o;++o)n(this,o)},e.prototype._refreshFX=function(t,e,n){this.__rowRangeRefresh(t,e,function(t,e){t.rowContent(e)._refreshFX(),NVL(n,!0)&&$(t.element()).trigger(_JGKeyword.ui.trigger.FXRefreshed,[e])})},e.prototype._refreshColumn=function(t,e,n,r,o){r=NVL(r,!0),this.__rowRangeRefresh(e,n,function(e,n){e.rowContent(n)._refreshColumn(t,r),NVL(o,!0)&&$(e.element()).trigger(_JGKeyword.ui.trigger.columnRefreshed,[t,n])})},e.prototype._refresh=function(t,e,n){this.__rowRangeRefresh(t,e,function(t,e){t.rowContent(e)._refresh(),NVL(n,!0)&&$(t.element()).trigger(_JGKeyword.ui.trigger.refreshed,[e])})},e.prototype.reload=function(){this.element().empty(),this._rowContents=new Array;for(var t=this.dataset(),e=t.getRowCount(),n=0;e>n;)this._insertRowContent(this._rowContents.length),++n;$(this.element()).trigger(_JGKeyword.ui.trigger.mappingReloaded)},$.fn._jgDatasetUI=function(t){return void 0!==t&&this.data("jgdatasetJGDatasetUI",t),this.data("jgdatasetJGDatasetUI")},$.fn._jgDatasetUIInitialized=function(t){return void 0!==t&&this.data("jgdatasetJGDatasetUIInitialized",t),NVL(this.data("jgdatasetJGDatasetUIInitialized"),!1)},$.fn.JGDatasetUI=function(){return this._jexecute(function(t){return this._jgDatasetUIInitialized()||(this._jgDatasetUI(new e(this,t[0])),this._jgDatasetUIInitialized(!0)),JGSelector(this._jgDatasetUI(),t)},arguments)},$.fn._jgDataRowContent=function(t){return void 0===t?this.data("jgdataset_rowContent"):(this.data("jgdataset_rowContent",t),this.data("jgdataset_rowContent"))},$.fn._jgDataJGDataset=function(){return this._jgDataRowContent().datasetUI().dataset()};var n=function(t,e){this._datasetUI=t,this._rowContent=e.clone(!0,!0),this._mappedElements=new Array,this._FXElements=new Array;for(var n=this._rowContent.find("*["+_JGKeyword.ui.attrColumn+"]"),o=n.length,a=0;o>a;++a){var i=$(n[a]),s=i.prop("tagName").toLowerCase();i._jgDataRowContent(this),this._mappedElements.push(i);var u=function(t){var e=$(t.target),n=e._jgDataRowContent(),r=n.datasetUI(),o=r.dataset(),a=e.attr(_JGKeyword.ui.attrColumn),i=n.rowIndex(),s=e.val();r.options.blankToNull&&(s=BLK(s,null)),o.setColumnValue(a,i,s,!0)};if("input"===s){var l=NVL(i.attr("type"),"text");"checkbox"===l?i.on("click change",function(t){var e=$(t.target),n=e._jgDataRowContent(),r=n.datasetUI(),o=r.dataset(),a=e.attr(_JGKeyword.ui.attrColumn),i=n.rowIndex();o.setColumnValue(a,i,e.prop("checked"),!0)}):i.on("keyup change",u)}else"textarea"===s?(i.on("change",function(t){var e=$(t.target),n=e._jgDataRowContent(),r=n.datasetUI(),o=r.dataset(),a=e.attr(_JGKeyword.ui.attrColumn),i=n.rowIndex(),s=e.val();r.options.blankToNull&&(s=BLK(s,null)),o.setColumnValue(a,i,s,!0)}),i.on("keyup",function(t){var e=$(t.target);e.trigger("change")})):"div"===s&&i.prop("contenteditable")?(i.on("change",function(t){var e=$(t.target),n=e._jgDataRowContent(),r=n.datasetUI(),o=r.dataset(),a=e.attr(_JGKeyword.ui.attrColumn),i=n.rowIndex(),s=e.html();r.options.blankToNull&&(s=BLK(s,null)),o.setColumnValue(a,i,s,!0)}),i.on("keyup",function(t){var e=$(t.target);e.trigger("change")})):"select"===s&&(isNull(i.attr(_JGKeyword.ui.attrBindDataset))||i.JGSelect(),i.on("change",function(t){var e=$(t.target),n=e._jgDataRowContent(),r=n.datasetUI().dataset(),o=e.attr(_JGKeyword.ui.attrColumn),a=n.rowIndex();r.setColumnValue(o,a,e.selectValue(),!0)}),$(i).on(_JGKeyword.select.trigger.selectReloaded,function(t){var e=$(t.target),n=e._jgDataRowContent(),r=n.datasetUI().dataset(),o=e.attr(_JGKeyword.ui.attrColumn),a=n.rowIndex();e.val(r.getColumnValue(o,a))}))}var d=this._rowContent.find("*");d.push(this._rowContent);for(var g=d.length,h=0;g>h;++h){for(var _=$(d[h]),c=_[0].attributes,f=c.length,p=0;f>p;++p){var m=c[p],C=m.name.toLowerCase();m.name.toLowerCase()!==_JGKeyword.ui.attrColumn&&0===BLK(m.value).replaceBlank("").indexOf(_JGKeyword.ui.keyFXPrefix)&&this._FXElements.push(new r(_,C,0))}var w=_.html();0===BLK(w).replaceBlank("").indexOf(_JGKeyword.ui.keyFXPrefix)&&this._FXElements.push(new r(_,null,1))}};n.prototype.datasetUI=function(){return this._datasetUI},n.prototype.rowIndex=function(){return this.datasetUI().indexOf(this)},n.prototype.rowContent=function(){return this._rowContent},n.prototype.mappedElements=function(){return this._mappedElements},n.prototype.FXElements=function(){return this._FXElements},n.prototype._refreshFX=function(){for(var t=this.FXElements(),e=this.datasetUI().dataset(),n=this.rowIndex(),r=t.length,o=0;r>o;++o)t[o].update(e,n)},n.prototype._refreshColumn=function(t,e){t=t.toUpperCase(),e=NVL(e,!0);var n=this.datasetUI().dataset().getColumnValue(t,this.rowIndex()),r=this.mappedElements(),o=r.length;for(eIndex_=0;o>eIndex_;++eIndex_){var a=$(r[eIndex_]);if(a.attr(_JGKeyword.ui.attrColumn).toUpperCase()===t){var i=a.prop("tagName").toLowerCase();"input"===i&&"checkbox"===a.attr("type")?(n=n===!0||"true"===n,a.prop("checked")!==n&&a.prop("checked",n)):"input"===i?a.val()!==n&&a.val(n):"textarea"===i?a.val()!==n&&a.val(n):"select"===i?a.val()!==n&&a.val(n):(n=BLK(n),a.html()!==n&&a.html(n))}}e&&this._refreshFX()},n.prototype._refresh=function(){for(var t=this.datasetUI().dataset(),e=t.getColumnCount(),n=0;e>n;++n)this._refreshColumn(t.getColumn(n).getName(),!1);this._refreshFX()};var r=t.JGFXElement=function(t,e,n){switch(this._element=t,this._attrName=e,this._type=n,n){case 0:this._fx=t.attr(e).replaceBlank("").substr(_JGKeyword.ui.keyFXPrefix.length);break;case 1:this._fx=t.html().replaceBlank("").substr(_JGKeyword.ui.keyFXPrefix.length);break;default:console.error("invaild FX Element Type")}};r.prototype.element=function(){return this._element},r.prototype.attrName=function(){return this._attrName},r.prototype.type=function(){return this._type},r.prototype.update=function(t,e){var n=null;try{n=BLK(new Function("return "+this._fx._jgFuncReplaceRegexpByDataset(t,e)+";").apply(t))}catch(r){n="##fx Exception: "+r.toString()+", statement: "+this._fx+"##"}switch(this.type()){case 0:this.element().attr(this.attrName(),n);break;case 1:this.element().html(n);break;default:console.error("invaild FX Element Type")}};var o=function(t,e){var n=this;e=$.extend({datasetName:t.attr(_JGKeyword.ui.attrBindDataset),displayColumn:t.attr(_JGKeyword.ui.attrDisplayColumn),valueColumn:t.attr(_JGKeyword.ui.attrValueColumn)},e),this._element=t,this._datasetName=e.datasetName,this._displayColumn=e.displayColumn,this._valueColumn=e.valueColumn;var r=this.dataset();$(r).on(_JGKeyword.trigger._rowInserted+" "+_JGKeyword.trigger._rowRemoved+" "+_JGKeyword.trigger._rowMoved+" "+_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved+" "+_JGKeyword.trigger._columnValueChanged+" "+_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(){n.reload()}),this.reload()};o.prototype.element=function(){return this._element},o.prototype.dataset=function(){return JGDS("dataset",this._datasetName)},o.prototype.displayColumn=function(){return this._displayColumn},o.prototype.valueColumn=function(){return this._valueColumn},o.prototype.reload=function(){function t(t,e){return $("<option value='"+e+"'>"+t+"</option>")}var e=this.element();e.empty();for(var n=this.dataset(),r=n.getRowCount(),o=0;r>o;++o)e.append(t(n.getColumnValue(this.displayColumn(),o),n.getColumnValue(this.valueColumn(),o)));e.trigger(_JGKeyword.select.trigger.selectReloaded)},$.fn._jgSelect=function(t){return void 0!==t&&this.data("jgdatasetJGSelect",t),this.data("jgdatasetJGSelect")},$.fn._jgSelectInitialized=function(t){return void 0!==t&&this.data("jgdatasetJGSelectInitialized",t),NVL(this.data("jgdatasetJGSelectInitialized"),!1)},$.fn.JGSelect=function(){return this._jexecute(function(t){return this._jgSelectInitialized()||(this._jgSelect(new o(this,t[0])),this._jgSelectInitialized(!0)),JGSelector(this._jgSelect(),t)},arguments)}}(window);