!function(t,e){if(void 0===JGDS)return void console.error("can't not initialize JGDatasetUI, JGDataset not found");_JGKeyword=e.extend(!0,t._JGKeyword,{ui:{attrDataset:"jg-dataset",attrColumn:"jg-column",attrBindDataset:"jg-bind-dataset",attrDisplayColumn:"jg-display-column",attrValueColumn:"jg-value-column",keyFXPrefix:"##fx:",trigger:{rowMapped:"datasetuirowmapped",refreshed:"datasetuirefreshed",FXRefreshed:"datasetuifxrefreshed",columnRefreshed:"datasetuicolumnrefreshed",mappingReloaded:"datasetuimappingreloaded"}},select:{trigger:{selectReloaded:"selectreloaded"}}}),String.prototype._jgFuncConvertToColumnRegexp=function(){return new RegExp("\\#\\#"+this+"\\#\\#","gi")},String.prototype._jgFuncReplaceRegexpByDataset=function(t,e){var n=this;n=n.replace("dataset\\.rowCount"._jgFuncConvertToColumnRegexp(),t.getRowCount()),n=n.replace("dataset\\.columnCount"._jgFuncConvertToColumnRegexp(),t.getColumnCount()),n=n.replace("dataset\\.columnName"._jgFuncConvertToColumnRegexp(),t.getColumnCount());for(var r="dataset\\.columnName\\([0-9]+\\)"._jgFuncConvertToColumnRegexp();found_=r.exec(n);){var o=found_[0],a=o.substr(o.indexOf("(")+1);a=a.substr(0,a.indexOf(")##")),n=n.replace(o,"this.getColumn("+a+").getName()")}for(var i="[\\s\\w\\#\\@\\-\\+\\*\\/\\%]*",s=("dataset\\.sum\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.sumOfColumnValues('"+u+"')")}for(s=("dataset\\.avg\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.avgOfColumnValues('"+u+"')")}for(s=("dataset\\.min\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.minOfColumnValues('"+u+"')")}for(s=("dataset\\.max\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##")),n=n.replace(o,"this.maxOfColumnValues('"+u+"')")}if(void 0!==e){for(s=("dataset\\.plus\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##"));for(var l=0,d=0;e>=d;++d){var h=parseInt(t.getColumnValue(u,d));l+=h}n=n.replace(o,l)}for(s=("dataset\\.minus\\("+i+"\\)")._jgFuncConvertToColumnRegexp();found_=s.exec(n);){var o=found_[0],u=o.substr(o.indexOf("(")+1);u=u.substr(0,u.indexOf(")##"));for(var l=parseInt(t.getColumnValue(u,0)),d=1;e>=d;++d){var h=parseInt(t.getColumnValue(u,d));l-=h}n=n.replace(o,l)}n=n.replace("dataset\\.rowIndex"._jgFuncConvertToColumnRegexp(),e),n=n.replace("dataset\\.rowStatus"._jgFuncConvertToColumnRegexp(),t.getRowStatus(e));for(var g=t.getColumnCount(),a=0;g>a;++a){var _=t.getColumn(a),u=_.getName(),h=t.getColumnValue(u,e);n=n.replace(u._jgFuncConvertToColumnRegexp(),"this.getColumnValue('"+u+"',"+e+")")}}return n},String.prototype.replaceBlank=function(t){return this.replace(/^[\n\t]*/g,t)},e.fn.insertAtIndex=function(t,e){var n=this.children().size();return 0>e&&(e=Math.max(0,n+1+e)),this.append(t),n>e&&this.children().eq(e).before(this.children().last()),this},e.fn.selectValue=function(){return"select"!==this.prop("tagName").toLowerCase()?void 0:this.children("option:selected").first().attr("value")},e.fn._jexecute=function(t,n){var r=new Array;return e.each(this,function(){r.push(t.call(e(this),n))}),r.length>1?r:r[0]},JGDataset.prototype.datasetUIView=function(){return e(document).find("["+_JGKeyword.ui.attrDataset+"='"+this.getName()+"']").filter(function(){return e(this)._jgDatasetUIInitialized()})};var n=t.JGDatasetUI=function(t,r,o){var a=this;if(this.options=e.extend(!0,n.prototype.options,o),this._element=t,this._datasetName=NVL(r,t.attr(_JGKeyword.ui.attrDataset)),isNull(this.dataset()))return void console.error("can't find JGDataset");this._originalRowContent=this._element.children().first().clone(!0),this._element.empty(),this._rowContents=new Array;var i=this.dataset();e(i).on(_JGKeyword.trigger._rowInserted,function(t,e){a._insertRowContent(e),a._randerNoRow()}),e(i).on(_JGKeyword.trigger._rowRemoved,function(t,e){a._removeRowContent(e),a._randerNoRow()}),e(i).on(_JGKeyword.trigger._rowMoved,function(t,e,n){e>n?a._refresh(n,e):a._refresh(e,n)}),e(i).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved,function(t,e){a._refreshColumn(e,void 0,void 0,!1),a._refreshFX()}),e(i).on(_JGKeyword.trigger._columnValueChanged,function(t,e,n){a._refreshColumn(e,n,void 0,!1),a._refreshFX()}),e(i).on(_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(t,e,n){a.reload(),a._randerNoRow()}),e(i).on(_JGKeyword.trigger._datasetApply,function(t){a._refreshFX()}),this.reload()};n.prototype.options={blankToNull:!1,noRowContent:null},n.prototype.element=function(){return this._element},n.prototype.dataset=function(){return JGDS("dataset",this._datasetName)},n.prototype.rowContent=function(t){return this._rowContents[t]},n.prototype._insertRowContent=function(t){var e=new r(this,this._originalRowContent);return this._rowContents.insert(e,t),this.element().insertAtIndex(e.rowContent(),t),this._refresh(t,void 0,!1),this.element().trigger(_JGKeyword.ui.trigger.rowMapped,[t]),e},n.prototype._removeRowContent=function(t){var e=this.rowContent(t);e.rowContent().remove(),this._rowContents.remove(t),this._refreshFX(0)},n.prototype.indexOf=function(t){return this._rowContents.indexOf(t)},n.prototype._refreshFX=function(t,n,r){var o=this;this.dataset().each(t,n,function(t){o.rowContent(t)._refreshFX(),NVL(r,!0)&&e(o.element()).trigger(_JGKeyword.ui.trigger.FXRefreshed,[t])})},n.prototype._refreshColumn=function(t,n,r,o,a){o=NVL(o,!0);var i=this;this.dataset().each(n,r,function(n){i.rowContent(n)._refreshColumn(t,o),NVL(a,!0)&&e(i.element()).trigger(_JGKeyword.ui.trigger.columnRefreshed,[t,n])})},n.prototype._refresh=function(t,n,r){var o=this;this.dataset().each(t,n,function(t){o.rowContent(t)._refresh(),NVL(r,!0)&&e(o.element()).trigger(_JGKeyword.ui.trigger.refreshed,[t])})},n.prototype._randerNoRow=function(){void 0!==this._noRowElement&&null!==this._noRowElement&&(this._noRowElement.remove(),this._noRowElement=null);var t=this.dataset().getRowCount();if(0>=t){var n=NVL(this.options.noRowContent,"");""!==n&&(this._noRowElement=e(n),this.element().append(this._noRowElement))}},n.prototype.reload=function(){this.element().empty(),this._rowContents=new Array;for(var t=this.dataset(),n=t.getRowCount(),r=0;n>r;)this._insertRowContent(this._rowContents.length),++r;e(this.element()).trigger(_JGKeyword.ui.trigger.mappingReloaded)},e.fn._jgDatasetUI=function(t){return void 0!==t&&this.data("jgdatasetJGDatasetUI",t),this.data("jgdatasetJGDatasetUI")},e.fn._jgDatasetUIInitialized=function(t){return void 0!==t&&this.data("jgdatasetJGDatasetUIInitialized",t),NVL(this.data("jgdatasetJGDatasetUIInitialized"),!1)},e.fn.JGDatasetUI=function(t){return this._jexecute(function(t){if(this._jgDatasetUIInitialized())return JGSelector(this._jgDatasetUI(),t);var r,o;return"object"===e.type(t[0])?o=t[0]:(r=t[0],o=t[1]),this._jgDatasetUI(new n(this,r,o)),this._jgDatasetUIInitialized(!0),this},arguments)},e.fn._jgDataRowContent=function(t){return void 0===t?this.data("jgdataset_rowContent"):(this.data("jgdataset_rowContent",t),this.data("jgdataset_rowContent"))},e.fn._jgDataJGDataset=function(){return this._jgDataRowContent().datasetUI().dataset()};var r=function(t,n){this._datasetUI=t,this._rowContent=n.clone(!0,!0),this._mappedElements=new Array,this._FXElements=new Array;for(var r=this._rowContent.find("*["+_JGKeyword.ui.attrColumn+"]"),a=r.length,i=0;a>i;++i){var s=e(r[i]),u=s.prop("tagName").toLowerCase();s._jgDataRowContent(this),this._mappedElements.push(s);var l=function(t){var n=e(t.target),r=n._jgDataRowContent(),o=r.datasetUI(),a=o.dataset(),i=n.attr(_JGKeyword.ui.attrColumn),s=r.rowIndex(),u=n.val();o.options.blankToNull&&(u=BLK(u,null)),a.setColumnValue(i,s,u,!0)};if("input"===u){var d=NVL(s.attr("type"),"text");"checkbox"===d?s.on("click change",function(t){var n=e(t.target),r=n._jgDataRowContent(),o=r.datasetUI(),a=o.dataset(),i=n.attr(_JGKeyword.ui.attrColumn),s=r.rowIndex();a.setColumnValue(i,s,n.prop("checked"),!0)}):s.on("keyup change",l)}else"textarea"===u?(s.on("change",function(t){var n=e(t.target),r=n._jgDataRowContent(),o=r.datasetUI(),a=o.dataset(),i=n.attr(_JGKeyword.ui.attrColumn),s=r.rowIndex(),u=n.val();o.options.blankToNull&&(u=BLK(u,null)),a.setColumnValue(i,s,u,!0)}),s.on("keyup",function(t){var n=e(t.target);n.trigger("change")})):"div"===u&&s.prop("contenteditable")?(s.on("change",function(t){var n=e(t.target),r=n._jgDataRowContent(),o=r.datasetUI(),a=o.dataset(),i=n.attr(_JGKeyword.ui.attrColumn),s=r.rowIndex(),u=n.html();o.options.blankToNull&&(u=BLK(u,null)),a.setColumnValue(i,s,u,!0)}),s.on("keyup",function(t){var n=e(t.target);n.trigger("change")})):"select"===u&&(isNull(s.attr(_JGKeyword.ui.attrBindDataset))||s.JGSelect(),s.on("change",function(t){var n=e(t.target),r=n._jgDataRowContent(),o=r.datasetUI().dataset(),a=n.attr(_JGKeyword.ui.attrColumn),i=r.rowIndex();o.setColumnValue(a,i,n.selectValue(),!0)}),e(s).on(_JGKeyword.select.trigger.selectReloaded,function(t){var n=e(t.target),r=n._jgDataRowContent(),o=r.datasetUI().dataset(),a=n.attr(_JGKeyword.ui.attrColumn),i=r.rowIndex();n.val(o.getColumnValue(a,i))}))}var h=this._rowContent.find("*");h.push(this._rowContent);for(var g=h.length,_=0;g>_;++_){for(var c=e(h[_]),p=c[0].attributes,f=p.length,m=0;f>m;++m){var w=p[m],C=w.name.toLowerCase();w.name.toLowerCase()!==_JGKeyword.ui.attrColumn&&0===BLK(w.value).replaceBlank("").indexOf(_JGKeyword.ui.keyFXPrefix)&&this._FXElements.push(new o(c,C,0))}var v=c.html();0===BLK(v).replaceBlank("").indexOf(_JGKeyword.ui.keyFXPrefix)&&this._FXElements.push(new o(c,null,1))}};r.prototype.datasetUI=function(){return this._datasetUI},r.prototype.rowIndex=function(){return this.datasetUI().indexOf(this)},r.prototype.rowContent=function(){return this._rowContent},r.prototype.mappedElements=function(){return this._mappedElements},r.prototype.FXElements=function(){return this._FXElements},r.prototype._refreshFX=function(){for(var t=this.FXElements(),e=this.datasetUI().dataset(),n=this.rowIndex(),r=t.length,o=0;r>o;++o)t[o].update(e,n)},r.prototype._refreshColumn=function(t,n){t=t.toUpperCase(),n=NVL(n,!0);var r=this.datasetUI().dataset().getColumnValue(t,this.rowIndex()),o=this.mappedElements(),a=o.length;for(eIndex_=0;eIndex_<a;++eIndex_){var i=e(o[eIndex_]);if(i.attr(_JGKeyword.ui.attrColumn).toUpperCase()===t){var s=i.prop("tagName").toLowerCase();"input"===s&&"checkbox"===i.attr("type")?(r=r===!0||"true"===r,i.prop("checked")!==r&&i.prop("checked",r)):"input"===s?i.val()!==r&&i.val(r):"textarea"===s?i.val()!==r&&i.val(r):"select"===s?i.val()!==r&&i.val(r):(r=BLK(r),i.html()!==r&&i.html(r))}}n&&this._refreshFX()},r.prototype._refresh=function(){for(var t=this.datasetUI().dataset(),e=t.getColumnCount(),n=0;e>n;++n)this._refreshColumn(t.getColumn(n).getName(),!1);this._refreshFX()};var o=t.JGFXElement=function(t,e,n){switch(this._element=t,this._attrName=e,this._type=n,n){case 0:this._fx=t.attr(e).replaceBlank("").substr(_JGKeyword.ui.keyFXPrefix.length);break;case 1:this._fx=t.html().replaceBlank("").substr(_JGKeyword.ui.keyFXPrefix.length);break;default:console.error("invaild FX Element Type")}};o.prototype.element=function(){return this._element},o.prototype.attrName=function(){return this._attrName},o.prototype.type=function(){return this._type},o.prototype.update=function(t,e){var n=null;try{n=BLK(new Function("return "+this._fx._jgFuncReplaceRegexpByDataset(t,e)+";").apply(t))}catch(r){n="##fx Exception: "+r.toString()+", statement: "+this._fx+"##"}switch(this.type()){case 0:this.element().attr(this.attrName(),n);break;case 1:this.element().html(n);break;default:console.error("invaild FX Element Type")}};var a=function(t,n){var r=this;n=e.extend({datasetName:t.attr(_JGKeyword.ui.attrBindDataset),displayColumn:t.attr(_JGKeyword.ui.attrDisplayColumn),valueColumn:t.attr(_JGKeyword.ui.attrValueColumn)},n),this._element=t,this._datasetName=n.datasetName,this._displayColumn=n.displayColumn,this._valueColumn=n.valueColumn;var o=this.dataset();e(o).on(_JGKeyword.trigger._rowInserted+" "+_JGKeyword.trigger._rowRemoved+" "+_JGKeyword.trigger._rowMoved+" "+_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved+" "+_JGKeyword.trigger._columnValueChanged+" "+_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged+" "+_JGKeyword.trigger._datasetSorted,function(t,e){r.reload()}),this.reload()};a.prototype.element=function(){return this._element},a.prototype.dataset=function(){return JGDS("dataset",this._datasetName)},a.prototype.displayColumn=function(){return this._displayColumn},a.prototype.valueColumn=function(){return this._valueColumn},a.prototype.reload=function(){function t(t,n){return e("<option value='"+n+"'>"+t+"</option>")}var n=this.element();n.empty();for(var r=this.dataset(),o=r.getRowCount(),a=0;o>a;++a)n.append(t(r.getColumnValue(this.displayColumn(),a),r.getColumnValue(this.valueColumn(),a)));n.trigger(_JGKeyword.select.trigger.selectReloaded)},e.fn._jgSelect=function(t){return void 0!==t&&this.data("jgdatasetJGSelect",t),this.data("jgdatasetJGSelect")},e.fn._jgSelectInitialized=function(t){return void 0!==t&&this.data("jgdatasetJGSelectInitialized",t),NVL(this.data("jgdatasetJGSelectInitialized"),!1)},e.fn.JGSelect=function(){return this._jexecute(function(t){return this._jgSelectInitialized()?JGSelector(this._jgSelect(),t):(this._jgSelect(new a(this,t[0])),this._jgSelectInitialized(!0),this)},arguments)}}(window,jQuery);