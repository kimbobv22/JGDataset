!function(t,e){if(void 0===e||null===e)return void console.error("can't not initialize JGDataset, JQuery not found");t._JGKeyword={key:{row:"row",column:"col",columnInfo:"columninfo",rowData:"rowdata",deletedRowData:"deletedRowdata",name:"name",isKey:"isKey",value:"value",rowStatus:"status",modify:"modify"},trigger:{_rowInserted:"_jgRowInserted",_rowRemoved:"_jgRowRemoved",_rowMoved:"_jgRowMoved",_columnAdded:"_jgColumnAdded",_columnRemoved:"_jgColumnRemoved",_columnValueChanged:"_jgColumnValueChanged",_datasetSorted:"_jgDatasetSorted",_datasetChanged:"_jgDatasetChanged",_datasetClear:"_jgDatasetClear",_datasetReset:"_jgDatasetReset",_datasetApply:"_jgDatasetApply",rowInserted:"rowinserted",rowRemoved:"rowremoved",rowMoved:"rowmoved",columnAdded:"columnadded",columnRemoved:"columnremoved",columnValueChanged:"columnvaluechanged",datasetSorted:"datasetsorted",datasetChanged:"datasetchanged",datasetClear:"datasetclear",datasetReset:"datasetreset",datasetApply:"datasetapply"},rowStatus:{normal:0,insert:1,update:3}};t.JGSelector=function(t,o){if(0===o.length)return t;var r=Array.prototype.slice.call(o),n=t[r[0]];return void 0===n?void console.error(r[0]+" is undefined"):"function"!==e.type(n)?void console.error(r[0]+" is not function"):n.apply(t,r.slice(1))};t.isNull=function(t){return void 0===t||null===t},t.NVL=function(t,e){return NVL2(t,t,e)},t.NVL2=function(t,e,o){return isNull(t)?o:e},t.isBlank=function(t){return isNull(t)||0===t.length},t.BLK=function(t,e){return isBlank(t)?void 0===e?"":e:t},Array.prototype.indexOf=function(t){for(var e=this.length,o=0;e>o;++o)if(this[o]===t)return o;return-1},Array.prototype.insert=function(t,e){this.splice(e,0,t)},Array.prototype.remove=function(t){this.splice(t,1)},Array.prototype.removeAll=function(){this.splice(0,this.length)},Array.prototype.removeObject=function(t){this.remove(this.indexOf(t))},Array.prototype.move=function(t,e){var o=this[t];this[t]=this[e],this[e]=o};var o=function(t){this._name=t.toUpperCase(),this._isKey=!1};o.prototype.getName=function(){return this._name},o.prototype.isKey=function(t){return void 0!==t&&(this._isKey=t),this._isKey},o.prototype.clone=function(){var t=new o(this._name);return t._isKey=this._isKey,t};var r=function(){this._columns={},this._orgColumns={},this._columnStatus={},this._rowStatus=_JGKeyword.rowStatus.normal};r.prototype.getRowStatus=function(){return this._rowStatus},r.prototype.setRowStatus=function(t){this._rowStatus=t},r.prototype._updateRowStatus=function(){if(this._rowStatus!==_JGKeyword.rowStatus.insert){var t=!1;for(var e in this._columnStatus)if(NVL(this._columnStatus[e],!1)){t=!0;break}this._rowStatus=t?_JGKeyword.rowStatus.update:_JGKeyword.rowStatus.normal}},r.prototype.setColumn=function(t,e,o){t=t.toUpperCase(),this._columns[t]=e,isNull(o)?this._columnStatus[t]=this._orgColumns[t]!==e:this._columnStatus[t]=o,this._updateRowStatus()},r.prototype.removeColumn=function(t){delete this._columns[t.toUpperCase()]},r.prototype.getColumnValue=function(t){return this._columns[t.toUpperCase()]},r.prototype.isColumnModified=function(t){var e=this._columnStatus[t.toUpperCase()];return NVL2(e,e,!1)},r.prototype.setColumnModification=function(t,e){this._columnStatus[t.toUpperCase()]=e},r.prototype.apply=function(){this._orgColumns=JSON.parse(JSON.stringify(this._columns)),this._rowStatus=_JGKeyword.rowStatus.normal,this._columnStatus={}},r.prototype.clone=function(){var t=new r;return t._columns=e.extend(!0,{},this._columns),t._orgColumns=e.extend(!0,{},this._orgColumns),t._columnStatus=e.extend(!0,{},this._columnStatus),t._rowStatus=this._rowStatus,t};var n=t.JGDataset=function(t){this._columnInfo=new Array,this._orgColumnInfo=new Array,this._rowData=new Array,this._orgRowData=new Array,this._deletedRowData=new Array,e(this).on(_JGKeyword.trigger._rowInserted,function(t,o,r){r&&e(this).trigger(_JGKeyword.trigger.rowInserted,[o])}),e(this).on(_JGKeyword.trigger._rowRemoved,function(t,o){e(this).trigger(_JGKeyword.trigger.rowRemoved,[o])}),e(this).on(_JGKeyword.trigger._columnAdded,function(t,o){e(this).trigger(_JGKeyword.trigger.columnAdded,[o])}),e(this).on(_JGKeyword.trigger._rowMoved,function(t,o,r,n){n&&e(this).trigger(_JGKeyword.trigger.rowMoved,[o,r])}),e(this).on(_JGKeyword.trigger._columnRemoved,function(t,o){e(this).trigger(_JGKeyword.trigger.columnRemoved,[o])}),e(this).on(_JGKeyword.trigger._columnValueChanged,function(t,o,r,n){n&&e(this).trigger(_JGKeyword.trigger.columnValueChanged,[o,r])}),e(this).on(_JGKeyword.trigger._datasetSorted,function(t,o,r,n){n&&e(this).trigger(_JGKeyword.trigger.datasetSorted,[o,r])}),e(this).on(_JGKeyword.trigger._datasetClear,function(t,o){o&&e(this).trigger(_JGKeyword.trigger.datasetClear)}),e(this).on(_JGKeyword.trigger._datasetReset,function(t,o){o&&e(this).trigger(_JGKeyword.trigger.datasetReset)}),e(this).on(_JGKeyword.trigger._datasetApply,function(t,o){o&&e(this).trigger(_JGKeyword.trigger.datasetApply)}),e(this).on(_JGKeyword.trigger._datasetChanged,function(t,o){o&&e(this).trigger(_JGKeyword.trigger.datasetChanged)}),isNull(t)||this.applyJSON(t)};n.prototype.getName=function(){return JGDS("datasetName",this)},n.prototype._convertColumnKeyToName=function(t){return"number"===e.type(t)?this.getColumn(t).getName():t.toUpperCase()},n.prototype._convertColumnKeyToIndex=function(t){return"number"===e.type(t)?t:this.indexOfColumn(t)},n.prototype.getColumnCount=function(){return this._columnInfo.length},n.prototype.getRowCount=function(){return this._rowData.length},n.prototype.getDeletedRowCount=function(){return this._deletedRowData.length},n.prototype.insertColumn=function(t,r,n){var a=new o(t);this._columnInfo[r]=a;for(var i=this._rowData.length,s=0;i>s;++s){var u=this._rowData[s];u.setColumn(t,null)}i=this._deletedRowData.length;for(var s=0;i>s;++s){var u=this._deletedRowData[s];u.setColumn(t,null)}return NVL(n,!0)&&e(this).trigger(_JGKeyword.trigger._columnAdded,[a.getName()]),a},n.prototype.addColumn=function(t,e){return this.insertColumn(t,this._columnInfo.length,e)},n.prototype.addColumns=function(){for(var t=arguments.length,e=0;t>e;++e)this.addColumn(arguments[e])},n.prototype.removeColumn=function(t){t=this._convertColumnKeyToIndex(t);var o=this.getColumn(t).getName();this._columnInfo.splice(t,1),e(this).trigger(_JGKeyword.trigger._columnRemoved,[o])},n.prototype.getColumn=function(t){return t=this._convertColumnKeyToIndex(t),this._columnInfo[t]},n.prototype.indexOfColumn=function(t){for(var e=this._columnInfo.length,o=0;e>o;++o)if(this._columnInfo[o].getName()===t.toUpperCase())return o;return-1},n.prototype._createRow=function(t){var e=new r;e.setRowStatus(t);for(var o=this._columnInfo.length,n=0;o>n;++n){var a=this._columnInfo[n];e.setColumn(a.getName(),null)}return e},n.prototype._insertRow=function(t){var e=this._createRow(_JGKeyword.rowStatus.insert);return this._rowData.insert(e,t),e},n.prototype.insertRow=function(t){var o=this._insertRow(t);return e(this).trigger(_JGKeyword.trigger._rowInserted,[t,!0]),o},n.prototype.addRow=function(){var t=this._rowData.length;return this.insertRow(t),t},n.prototype.addRows=function(t){for(var e=0;t>e;++e)this.addRow()},n.prototype._removeRow=function(t){var e=this.getRow(t);switch(e.getRowStatus()){case _JGKeyword.rowStatus.normal:case _JGKeyword.rowStatus.update:this._deletedRowData.push(e);break;case _JGKeyword.rowStatus.insert:}this._rowData.remove(t)},n.prototype.removeRow=function(t){this._removeRow(t),e(this).trigger(_JGKeyword.trigger._rowRemoved,[t])},n.prototype.getRow=function(t){return this._rowData[t]},n.prototype.setRowStatus=function(t,e){this.getRow(t).setRowStatus(e)},n.prototype.getRowStatus=function(t){return this.getRow(t).getRowStatus()},n.prototype.getDeletedRow=function(t){return this._deletedRowData[t]},n.prototype.moveRow=function(t,o,r){this._rowData.move(t,o),e(this).trigger(_JGKeyword.trigger._rowMoved,[t,o,NVL(r,!0)])},n.prototype.sortRow=function(t,o,r){for(var n=this.getRowCount(),a=null,i=!1,s=n-1,u=0,l=0;n>l;++l)for(var d=0;n>d;++d){var h=this.getColumnValue(t,l),g=this.getColumnValue(t,d);o.apply(this,[h,g])&&(i=!0,s>l&&(s=l),d>u&&(u=d),a=this._rowData[l],this._rowData[l]=this._rowData[d],this._rowData[d]=a)}i&&e(this).trigger(_JGKeyword.trigger._datasetSorted,[s,u,NVL(r,!0)])},n.prototype.sortRowByAsc=function(t){this.sortRow(t,function(t,e){return e>t})},n.prototype.sortRowByDesc=function(t){this.sortRow(t,function(t,e){return t>e})},n.prototype._setColumnValue=function(t,o,r,n,a){if("number"===e.type(t)){var i=this.getColumn(t);t=i.getName()}else{var s=this.indexOfColumn(t);0>s&&(NVL(n,!1)?this.addColumn(t,a):console.error("not exists column ["+t+"]"))}var u=this.getRow(o);u.setColumn(t,r)},n.prototype.setColumnValue=function(t,o,r,n){t=this._convertColumnKeyToName(t);var a=this.getColumnValue(t,o);this._setColumnValue(t,o,r,n),a!==r&&e(this).trigger(_JGKeyword.trigger._columnValueChanged,[t,o,!0])},n.prototype.setColumnValues=function(t,e,o){for(var r in t)this.setColumnValue(r,e,t[r],o)},n.prototype.getColumnValue=function(t,e){return this.getRow(e).getColumnValue(this._convertColumnKeyToName(t))},n.prototype.isColumnModified=function(t,e){return this.getRow(e).isColumnModified(this._convertColumnKeyToName(t))},n.prototype.getDeletedColumnValue=function(t,e){return this.getDeletedRow(e).getColumnValue(this._convertColumnKeyToName(t))},n.prototype.clear=function(t){NVL(t,!0)&&(this._columnInfo=new Array),this._rowData=new Array,this._deletedRowData=new Array,e(this).trigger(_JGKeyword.trigger._datasetClear,[NVL(arguments[1],!0)])},n.prototype.apply=function(t){this._orgRowData=new Array,this._orgColumnInfo=new Array;for(var o=this._rowData.length,r=0;o>r;++r){var n=this.getRow(r);n.apply(),this._orgRowData.push(n.clone())}for(var a=this._columnInfo.length,i=0;a>i;++i)this._orgColumnInfo.push(this.getColumn(i).clone());this._deletedRowData=new Array,e(this).trigger(_JGKeyword.trigger._datasetApply,[NVL(t,!0)])},n.prototype.reset=function(t){this._columnInfo=new Array,this._rowData=new Array;for(var o=this._orgRowData.length,r=0;o>r;++r)this._rowData.push(this._orgRowData[r].clone());for(var n=this._orgColumnInfo.length,a=0;n>a;++a)this._columnInfo.push(this._orgColumnInfo[a].clone());this._deletedRowData=new Array,e(this).trigger(_JGKeyword.trigger._datasetReset,[NVL(t,!0)])},n.prototype.isModified=function(){for(var t=this.getRowCount(),e=0;t>e;++e)if(this.getRowStatus(e)!==_JGKeyword.rowStatus.normal)return!0;return!1},n.prototype.sumOfColumnValues=function(t,e){for(var o=0,r=this.getRowCount(),n=this.getColumn(t),a=0;r>a;++a)if(NVL2(e,e,function(){return!0})(n.getName(),a)){var i=this.getColumnValue(n.getName(),a);o+=isNull(i)||isNaN(i)?0:new Number(i)}return o},n.prototype.avgOfColumnValues=function(t,e){var o=this.sumOfColumnValues(t,e),r=this.getRowCount(),n=o/r;return isNaN(n)?0:n},n.prototype._calcOfColumnValues=function(t,e,o){for(var r=void 0,n=this.getRowCount(),a=this.getColumn(t),i=0;n>i;++i){var s=this.getColumnValue(a.getName(),i);isBlank(s)||isNaN(s)||!NVL2(o,o,function(){return!0})(a.getName(),i)||(isNull(r)||new Function("return ("+r+e+s+");").apply(this))&&(r=s)}return r},n.prototype.maxOfColumnValues=function(t,e){return this._calcOfColumnValues(t,"<",e)},n.prototype.minOfColumnValues=function(t,e){return this._calcOfColumnValues(t,">",e)},n.prototype.toJSON=function(t){if(NVL(t,!1)){for(var e=new Array,o=this._rowData.length,r=this._columnInfo.length,n=0;o>n;++n){for(var a=this._rowData[n],i={},s=0;r>s;++s){var u=this._columnInfo[s];i[u.getName()]=a.getColumnValue(u.getName())}e.push(i)}return e}for(var l={},d=new Array,r=this._columnInfo.length,s=0;r>s;++s){var u=this._columnInfo[s],h={};h[_JGKeyword.key.name]=u.getName(),h[_JGKeyword.key.isKey]=u.isKey(),d[s]=h}l[_JGKeyword.key.columnInfo]=d;for(var g=new Array,o=this._rowData.length,n=0;o>n;++n){for(var a=this._rowData[n],i={},_={},s=0;r>s;++s){var u=this._columnInfo[s],h={};h[_JGKeyword.key.value]=this.getColumnValue(u.getName(),n),h[_JGKeyword.key.modify]=a.isColumnModified(u.getName()),_[u.getName()]=h}i[_JGKeyword.key.row]=_,i[_JGKeyword.key.rowStatus]=a.getRowStatus(),g[n]=i}l[_JGKeyword.key.rowData]=g;var w=new Array;o=this._deletedRowData.length;for(var n=0;o>n;++n){for(var a=this._rowData[n],i={},_={},s=0;r>s;++s){var u=this._columnInfo[s],m=this.getDeletedColumnValue(u.getName(),n),h={};h[_JGKeyword.key.value]=m,_[u.getName()]=h}i[_JGKeyword.key.row]=_,w[n]=i}return l[_JGKeyword.key.deletedRowData]=w,l},n.prototype.toJSONString=function(t){return JSON.stringify(this.toJSON(t))},n.prototype.applyJSON=function(t){if(t="string"===e.type(t)?JSON.parse(t):t,this.clear(!0,!1),void 0===t[_JGKeyword.key.columnInfo]){for(var o=t.length,n=0;o>n;++n){this._insertRow(n);for(var a in t[n])this._setColumnValue(a,n,t[n][a],!0,!1)}this.apply(!1)}else{for(var i=t[_JGKeyword.key.columnInfo],s=t[_JGKeyword.key.rowData],u=t[_JGKeyword.key.deletedRowData],l=i.length,d=0;l>d;++d){var h=i[d],g=this.insertColumn(h[_JGKeyword.key.name],d,!1);g.isKey(h[_JGKeyword.key.isKey])}this.apply(!1);for(var o=s.length,n=0;o>n;++n){this._insertRow(n);for(var _=this.getRow(n),w=s[n][_JGKeyword.key.row],d=0;l>d;++d){var g=this.getColumn(d),m=w[g.getName()];_.setColumn(g.getName(),m[_JGKeyword.key.value],m[_JGKeyword.key.modify])}_.setRowStatus(s[n][_JGKeyword.key.rowStatus])}o=u.length;for(var n=0;o>n;++n){var _=new r;this._deletedRowData[this._deletedRowData.length]=_;for(var w=u[n][_JGKeyword.key.row],d=0;l>d;++d){var g=this.getColumn(d),m=w[g.getName()];_.setColumn(g.getName(),m[_JGKeyword.key.value],m[_JGKeyword.key.modify])}_.setRowStatus(u[n][_JGKeyword.key.rowStatus])}}e(this).trigger(_JGKeyword.trigger._datasetChanged,[NVL(arguments[1],!0)])},n.prototype.appendDataset=function(t,o){for(var r=t.getRowCount(),n=t.getColumnCount(),a=0;r>a;++a){var i=this._createRow(_JGKeyword.rowStatus.insert),s=t.getRow(a);i.setRowStatus(s.rowStatus());var u=this.getRowCount();this._rowData.insert(i,u);for(var l=0;n>l;++l){var d=t.getColumn(l).getName();this._setColumnValue(d,u,s.getColumnValue(d),o,!1),i.setColumnModification(d,s.isColumnModified(d))}e(this).trigger(_JGKeyword.trigger._rowInserted,[u,!0])}},n.prototype.appendJSON=function(t,o){t="string"===e.type(t)?JSON.parse(t):t,this.appendDataset(new n(t),o)},n.prototype.exportModifiedData=function(){var t=new n;t._columnInfo=e.extend(!0,[],this._columnInfo),t._deletedRowData=e.extend(!0,[],this._deletedRowData);for(var o=this.getColumnCount(),r=this.getRowCount(),a=0;r>a;++a)for(var i=0;o>i;++i){var s=this._columnInfo[i].getName();if(this.isColumnModified(s,a)){t._rowData.push(this._rowData[a]);break}}return t},n.prototype.each=function(t,e,o){var r=this.getRowCount();isNull(t)?(t=NVL(t,0),e=NVL(e,this.getRowCount()-1)):e=NVL(e,t),o=NVL(o,function(){});for(var n=t;e>=n&&r>n&&o.apply(this,[n])!==!1;++n);},n.prototype.on=function(){return e(this).on(arguments)},n.prototype.bind=function(){return e(this).bind(arguments)},n.prototype.trigger=function(){return e(this).trigger(arguments)},t.JGDS=function(){return JGSelector(e._JGDS,arguments)};var a=function(t,e){this._name=t,this._dataset=e};a.prototype.name=function(){return this._name},a.prototype.dataset=function(t){return void 0!==t&&(this._dataset=t),this._dataset},e._JGDS={_datasetMap:[],_convertToIndex:function(t){return"number"===e.type(t)?t:this.indexOf(t)},dataset:function(t,o){var r=this._datasetMap[this._convertToIndex(t)];if(void 0===r&&"string"===e.type(t))return r=new a(t,new n(o)),this._datasetMap.push(r),r.dataset();var i=r.dataset();return void 0===o?i:(i.applyJSON(o),i)},indexOf:function(t){for(var o=this._datasetMap.length,r=0;o>r;++r){var n=this._datasetMap[r];if("string"===e.type(t)&&n.name()===t)return r;if(n.dataset()===t)return r}return-1},datasetName:function(t){for(var e=this._datasetMap.length,o=0;e>o;++o){var r=this._datasetMap[o];if(r.dataset()===t)return r.name()}return void 0},remove:function(t){var e=this._convertToIndex(t);return-1===e?void 0:void this._datasetMap.remove(e)},make:function(){for(var t=new Array,e=arguments.length,o=0;e>o;++o)t.push(this.dataset(arguments[o]));return t}}}(window,$);