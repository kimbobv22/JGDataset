!function(t){function e(t,e){for(var a in t)if(a.toUpperCase()===e.toUpperCase())return t[a];return void 0}function a(t){var e=0;for(var a in t)t.hasOwnProperty(a)&&++e;return e}function r(t,e){var a=0;for(var r in t)if(t.hasOwnProperty(r)){if(a===e)return t[r];++a}return void 0}function n(t,e,a){var r=new RegExp(t,a);return r.test(BLK(e))}if(void 0===JGDatasetUI)return void console.error("can't not initialize JGValidator, JGDataset UI not found");_JGKeyword=$.extend(!0,_JGKeyword,{validator:{errorColumn:"jg-error-column",validColumn:"jg-valid-column",trigger:{changeColumnValidation:"changecolumnvalidation"}}});var i=t.JGValidator=function(t){this._datasetUI=t,this._engine=$.extend(!0,{},i.prototype._engine),this._failedMessages=$.extend(!0,{},i.prototype._failedMessages),this._validators={},this._cause={},this._onValidate=!1;var e=this,a=this.dataset();$(a).on(_JGKeyword.trigger._columnValueChanged,function(t,a,r){e._options.realtimeCheck&&e._singleValidate(a,r,function(){})}),$(a).on(_JGKeyword.trigger._columnAdded+" "+_JGKeyword.trigger._columnRemoved+" "+_JGKeyword.trigger._rowInserted+" "+_JGKeyword.trigger._rowRemoved+" "+_JGKeyword.trigger._datasetClear+" "+_JGKeyword.trigger._datasetReset+" "+_JGKeyword.trigger._datasetChanged,function(){e.refresh()}),this.refresh()};i.prototype.datasetUI=function(){return this._datasetUI},i.prototype.dataset=function(){return this._datasetUI.dataset()},i.prototype.isValid=function(){{var t=this.dataset(),e=t.getRowCount();this._validators}for(var a in this._validators)for(var r=0;e>r;++r)if(!this.isColumnValid(a,r))return!1;return!0},i.prototype.isColumnValid=function(t,e){var r=this.dataset(),n=r.getRowCount(),i=(this._validators,this._cause[t.toUpperCase()]);if(void 0===i)return!1;this._validators[t];if(n!==i.length)return!1;var o=i[e];return isNull(o)||a(o)>0?!1:!0},i.prototype.engine=function(t){return void 0!==t&&(this._engine=$.extend(!0,this._engine,t)),this._engine},i.prototype.failedMessages=function(t){return void 0!==t&&(this._failedMessages=$.extend(!0,this._failedMessages,t),this._updateErrorLabels()),this._failedMessages},i.prototype.commonFailedMessages=function(t){return void 0!==t&&(this._commonFailedMessages=$.extend(!0,this._commonFailedMessages,t)),this._commonFailedMessages},i.prototype.cause=function(){var t={};for(var e in this._cause){t[e]={};for(var r=this._cause[e].length-1;r>=0;--r)a(this._cause[e][r])>0&&(t[e][r]=this._cause[e][r]);0===a(t[e])&&delete t[e]}return t},i.prototype.refresh=function(){this._validators={},this._cause={};for(var t=this.datasetUI(),e=this.dataset(),a=t._originalRowContent,r=e.getColumnCount(),n=0;r>n;++n){var i=e.getColumn(n).getName(),o=a.find("*["+_JGKeyword.ui.attrColumn+"]").filter(function(){return $(this).attr(_JGKeyword.ui.attrColumn).toUpperCase()===i});this._validators[i]={};for(var s=o.filter(function(){return void 0!==$(this).attr("required")}),l=s.length,u=0;l>u;++u)this._validators[i].required={name:"required"};s=o.filter(function(){return void 0!==$(this).attr("maxLength")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].maxLength={name:"maxLength",length:parseInt(d.attr("maxLength"))}}s=o.filter(function(){return void 0!==$(this).attr("minLength")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].minLength={name:"minLength",length:parseInt(d.attr("minLength"))}}s=o.filter(function(){return void 0!==$(this).attr("length")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].length={name:"length",length:parseInt(d.attr("length"))}}s=o.filter(function(){return void 0!==$(this).attr("equals")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].equals={name:"equals",value:d.attr("equals")}}s=o.filter(function(){return void 0!==$(this).attr("notEquals")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].equals={name:"notEquals",value:d.attr("notEquals")}}s=o.filter(function(){return void 0!==$(this).attr("range")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u)),h=d.attr("range").split(",");this._validators[i].range={name:"range",from:parseInt(h[0]),to:parseInt(h[1])}}s=o.filter(function(){return void 0!==$(this).attr("rangeLength")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u)),h=d.attr("rangeLength").split(",");this._validators[i].rangeLength={name:"rangeLength",from:parseInt(h[0]),to:parseInt(h[1])}}s=o.filter(function(){return void 0!==$(this).attr("pattern")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].pattern={name:"pattern",pattern:d.attr("pattern")}}s=o.filter(function(){return void 0!==$(this).attr("patternWord")}),l=s.length;for(var u=0;l>u;++u)this._validators[i].patternWord={name:"patternWord"};s=o.filter(function(){return void 0!==$(this).attr("patternAlphabet")}),l=s.length;for(var u=0;l>u;++u)this._validators[i].patternAlphabet={name:"patternAlphabet"};s=o.filter(function(){return void 0!==$(this).attr("patternAlphanum")}),l=s.length;for(var u=0;l>u;++u)this._validators[i].patternAlphanum={name:"patternAlphanum"};s=o.filter(function(){return void 0!==$(this).attr("patternEmail")}),l=s.length;for(var u=0;l>u;++u)this._validators[i].patternEmail={name:"patternEmail"};s=o.filter(function(){return void 0!==$(this).attr("patternNumber")}),l=s.length;for(var u=0;l>u;++u)this._validators[i].patternNumber={name:"patternNumber"};s=o.filter(function(){return void 0!==$(this).attr("patternPhone")}),l=s.length;for(var u=0;l>u;++u)this._validators[i].patternPhone={name:"patternPhone"};s=o.filter(function(){return void 0!==$(this).attr("columnEquals")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].columnEquals={name:"columnEquals",value:d.attr("columnEquals")}}s=o.filter(function(){return void 0!==$(this).attr("columnNotEquals")}),l=s.length;for(var u=0;l>u;++u){var d=$(s.get(u));this._validators[i].columnNotEquals={name:"columnNotEquals",value:d.attr("columnNotEquals")}}var g=this;s=o.each(function(){for(var t=$(this).get(0).attributes,e=t.length,a=0;e>a;++a){var r=t[a],n="(custom\\-validator\\-)+";if(new RegExp(n,"gi").test(r.name)){var o=r.name.replace("custom-validator-","");g._validators[i][o]={name:o,value:r.value}}}}),this.validate(function(){})}},i.prototype._recursiveSingleValidate=function(t,n,i,o){var s=this,l=this.datasetUI(),u=this.dataset(),d=u.getColumnValue(t,n),h=e(this._validators,t);o=NVL(o,function(){});var g=this._cause[t]=NVL(this._cause[t],[]);if(this._cause[t][n]=$.extend(!0,this._cause[t][n],{}),isNull(h)){var v=this.cause()[t];return void o.apply(l.element(),[void 0===v?null:v[n]])}i=NVL(i,0);var p=a(h);if(i===p){var v=this.cause()[t];return void o.apply(l.element(),[void 0===v?null:v[n]])}var f=r(h,i),m=f.name.toLowerCase(),c=e(this._engine,m);return isNull(c)?void this._recursiveSingleValidate(t,n,i+1,o):void c.apply(u,[f,t,n,d,function(e){if(e)delete g[n][f.name];else{var a={name:f.name};g[n][f.name]=a,s._options.stepValidation&&(i=p-1)}s._recursiveSingleValidate(t,n,i+1,o)}])},i.prototype._singleValidate=function(t,e,a){var r=this,n=this.isColumnValid(t,e);this._recursiveSingleValidate(t.toUpperCase(),e,0,function(){r._updateErrorLabels(),r._updateValidLabels();var i=r.isColumnValid(t,e);i!==n&&r.datasetUI().element().trigger(_JGKeyword.validator.trigger.changeColumnValidation,[t,e,i]),a.apply(r.datasetUI().element(),arguments)})},i.prototype._recursiveValidate=function(t,e,a){var r=this,n=this.datasetUI(),i=this.dataset(),o=i.getColumnCount(),s=i.getRowCount();if(t=NVL(t,0),e=NVL(e,0),a=NVL(a,function(){}),t===o)return void a.apply(n.element(),[this.isValid(),this.cause()]);if(o>t&&e===s)return void this._recursiveValidate(t+1,0,a);var l=i.getColumn(t).getName();return void this._singleValidate(l,e,function(){r._recursiveValidate(t,e+1,a)})},i.prototype.validate=function(t){this._recursiveValidate(0,0,t)},i.prototype._updateErrorLabels=function(){for(var t=this.datasetUI(),a=this.dataset(),r=a.getRowCount(),n=0;r>n;++n){var i=t.rowContent(n).rowContent();if(!isNull(i)){var o=i.find("["+_JGKeyword.validator.errorColumn+"]");o.hide(),o.html("")}}var s=this.cause();for(var l in s)if(s.hasOwnProperty(l)){var u=s[l];for(var n in u)if(u.hasOwnProperty(n)){var d=u[n],i=t.rowContent(n).rowContent();if(!isNull(i)){var o=i.find("["+_JGKeyword.validator.errorColumn+"]").filter(function(){return l.toUpperCase()===$(this).attr(_JGKeyword.validator.errorColumn).toUpperCase()});for(var h in d){var g="",v=e(this._failedMessages,l);if(!isNull(v)){var p=e(v,h);isNull(p)||(g=p)}(isNull(g)||0===g.length)&&(g=BLK(e(this._commonFailedMessages,h)));var f=function(t){return new RegExp("\\{("+t+")\\}","gi")};g=g.replace(f("columnName"),l),g=g.replace(f("rowIndex"),n),g=g.replace(f("columnValue"),a.getColumnValue(l,n));for(var m in this._validators[l][h])g=g.replace(f(m),this._validators[l][h][m]);if(g.length>0)for(var c=o.length,_=0;c>_;++_){var w=$(o[_]);w.show(),g=$(this._options.errorMessageTag).html(g),NVL(this._options.appendErrorMessage,!1)?w.append(g):w.html(g)}}}}}},i.prototype._updateValidLabels=function(){for(var t=this.datasetUI(),e=this.dataset(),a=e.getRowCount(),r=0;a>r;++r){var n=t.rowContent(r).rowContent();if(!isNull(n)){var i=n.find("["+_JGKeyword.validator.validColumn+"]");i.length>0&&i.show()}}var o=this.cause();for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];for(var r in l)if(l.hasOwnProperty(r)){var n=(l[r],t.rowContent(r).rowContent());if(!isNull(n)){var u=n.find("["+_JGKeyword.validator.validColumn+"]").filter(function(){return s.toUpperCase()===$(this).attr(_JGKeyword.validator.validColumn).toUpperCase()});u.length>0&&u.hide()}}}},i.prototype._options={errorMessageTag:"<span style='display:block;' />",appendErrorMessage:!0,stepValidation:!0,realtimeCheck:!0},i.prototype.options=function(){return"string"===$.type(arguments[0])?(2===arguments.length&&(this._options[arguments[0]]=arguments[1],("errorMessageTag"===arguments[0]||"appendErrorMessage"===arguments[0])&&this._updateErrorLabels()),this._options[arguments[0]]):("object"===$.type(arguments[0])&&(this._options=$.extend(!0,this._options,arguments[0]),this.refresh()),this._options)},i.prototype._commonFailedMessages={required:"field is required",maxLength:"max length : {length}",minLength:"min length : {length}",length:"length : {length}",range:"range : {from} ~ {to}",rangeLength:"length : {from} ~ {to}",equals:"equals : {value}",notEquals:"not equals : {value}",pattern:"pattern : {pattern}",patternWord:"pattern word",patternAlphabet:"pattern alphabet",patternAlphanum:"pattern alphanum",patternEmail:"pattern email",patternNumber:"pattern number",patternPhone:"pattern phone",columnEquals:"column be equals to {value}",columnNotEquals:"column be not equals to {value}"},i.prototype._engine={_customValidate:function(t,e,a,r,n){this[t.name](t,e,a,r,n)},required:function(t,e,a,r,n){n(0<BLK(r).length)},maxLength:function(t,e,a,r,n){n(t.length>=BLK(r).length)},minLength:function(t,e,a,r,n){n(t.length<=BLK(r).length)},length:function(t,e,a,r,n){n(t.length===BLK(r).length)},range:function(t,e,a,r,n){var i=parseInt(r);n(t.from<=i&&t.to>=i)},rangeLength:function(t,e,a,r,n){var i=BLK(r).length;n(t.from<=i&&t.to>=i)},equals:function(t,e,a,r,n){n(t.value===r)},notEquals:function(t,e,a,r,n){n(t.value!==r)},pattern:function(t,e,a,r,i){i(n(t.pattern,r))},patternWord:function(t,e,a,r,i){i(n("^[\\w]+$",r))},patternAlphabet:function(t,e,a,r,i){i(n("^[a-zA-Z]+$",r))},patternAlphanum:function(t,e,a,r,i){i(n("^[0-9a-zA-Z]+$",r))},patternEmail:function(t,e,a,r,i){i(n("^[\\w\\-\\.]+@[\\w\\-\\.]+\\.[\\w]{1,5}$",r))},patternNumber:function(t,e,a,r,i){i(n("^[\\-]?[0-9]+$",r))},patternPhone:function(t,e,a,r,i){i(n("^(\\+?\\d{0,2}\\s?\\d{2,3}\\s?\\-?\\s?\\d{3,4}\\s?\\-?\\s?\\d{4})$",r))},columnEquals:function(t,e,a,r,n){var i=t.value;n(BLK(this.getColumnValue(i,a))===BLK(r))},columnNotEquals:function(t,e,a,r,n){var i=t.value;n(BLK(this.getColumnValue(i,a))!==BLK(r))}},$.fn._jgValidator=function(t){return void 0!==t&&this.data("jgdataset_jgValidator",t),this.data("jgdataset_jgValidator")},$.fn._jgValidatorInitialized=function(t){return void 0!==t&&this.data("jgdataset_jgValidatorInitialized",t),NVL(this.data("jgdataset_jgValidatorInitialized"),!1)},$.fn.JGValidator=function(){return this._jexecute(function(t){return this._jgValidatorInitialized()||(this._jgValidator(new i(this.JGDatasetUI(),t[0])),this._jgValidatorInitialized(!0)),JGSelector(this._jgValidator(),t)},arguments)}}(window);