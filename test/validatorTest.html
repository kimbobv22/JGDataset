<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>JGDataset sample</title>
<!-- import JQuery -->
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" /><!---->
<link rel="stylesheet" href="./style.css" />
<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script><!---->
<!-- JGModule -->
<script src="../libs/JGDataset.1.0.0.js"></script>
<script src="../libs/JGDataset.validate.1.0.0.js"></script>
<script type="text/javascript">
$(JGDS).on("beforeload",function(){
	var mainData_ = JGDS("mainData");

	mainData_.setColumnValues(mainData_.addRow(),["col1", "100", "col2", "50", "col3", "001"], true);
	mainData_.setColumnValues(mainData_.addRow(),["col1", "150", "col2", "70", "col3", "002"]);
	mainData_.setColumnValues(mainData_.addRow(),["col1", "50", "col2", "-60", "col3", "003"]);
	mainData_.apply();
	
	$(mainData_).on("columnchanged",function(event_,columnName_,rowIndex_){
		printLog("column changed! : "+columnName_+", "+rowIndex_);
		printTotal();
	});
	
	var selectData_ = JGDS("selectData");
	
	selectData_.setColumnValues(selectData_.addRow(),["code", "001", "name", "test1"], true);
	selectData_.setColumnValues(selectData_.addRow(),["code", "002", "name", "test2"]);
	selectData_.setColumnValues(selectData_.addRow(),["code", "003", "name", "test3"]);
	selectData_.apply();
	
	printTotal();
});
/*$(JGDS).on("afterload",function(){
	JGDS("mainData").validator("failedMessages",{
			"COL1" : {
				"patternNumber" : "숫자가 아님"
			}
		});
});*/

function addRow(){JGDS("mainData").addRow();printTotal();}
function removeRow(){
	var mainData_ = JGDS("mainData");
	if(mainData_.getRowCount() == 0) return;
	mainData_.removeRow(mainData_.getRowCount()-1);
	printTotal();
}
function apply(){JGDS("mainData").apply();printTotal();}
function reset(){JGDS("mainData").reset();printTotal();}
function clear(){JGDS("mainData").clear();printTotal();}
function printTotal(){
	var mainData_ = JGDS("mainData");
	var totalLabel_ = $("#dataset-total");
	totalLabel_.html("<label>COL1 SUM : "+mainData_.sumOfColumnValues("col1")+"</label><br/>");
	totalLabel_.append("<label>COL1 AVG : "+parseInt(mainData_.avgOfColumnValues("col1"))+"</label><br/>");
	totalLabel_.append("<label>COL1 MAX : "+mainData_.maxOfColumnValues("col1")+"</label><br/>");
	totalLabel_.append("<label>COL1 MIN : "+mainData_.minOfColumnValues("col1")+"</label><br/>");
}
function validate(){
	JGDS("mainData").fullValidate(function(){
		printLog("Dataset is "+(this.validator("isValid") ? "valid" : "not valid"));
	});
}

function clearLog(){$(".jg-logbox .log-content").html("");}
function printLog(str_){$(".jg-logbox .log-content").append($("<span>"+str_+"</span><br/>"));}
function printDataset(){printLog("-------------<br>"+JGDS("mainData").toJSONString()+"<br>-----------");}
</script>
</head>
<body>
<div data-role="page">
	<div data-role="content">
	
	<table jg-dataset="mainData" jg-dataset-validator>
		<tr><!-- row template must be only one child-->
			<td><label>##fx:##dataset.rowindex##+1</label></td>
			<td><input jg-column="col1" patternNumber><label jg-error-column="col1"></label></td>
			<td><input jg-column="col2" patternNumber><label jg-error-column="col2"></label></td>
			<td><label><b>COL2 : </b></label><span jg-column="col2"></span></td>
			<td><input jg-column="col3" pattern="^(001)$" patternNumber><label jg-error-column="col3"></label></td>
			<td><select jg-column="col3" jg-bind-dataset="selectData" jg-display-column="name" jg-value-column="code" jg-blank-title="선택"></select></td>
			<td><label readonly="true">##fx:(##col1##)-(##col2##)</label><label style="font-size: 11px; color:gray;">(*COL1 - COL2)</label></td>
		</tr>
	</table>
	
	<a href="javascript:addRow();">add-row</a>
	<a href="javascript:removeRow();">remove-row</a>
	<a href="javascript:apply();">apply</a>
	<a href="javascript:reset();">reset</a>
	<a href="javascript:clear();">clear</a>
	<a href="javascript:printDataset();">print-dataset</a>
	<a href="javascript:validate();">validate</a>
	
	<div class="jg-logbox">
		<div class="log-content"></div>
		<a href="javascript:clearLog();" class="clear">clear</a>
	</div>
	</div>
</div>
</body>
</html>