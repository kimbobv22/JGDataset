<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>JGDataset sample</title>
<!-- import JQuery -->
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" /><!---->
<link rel="stylesheet" href="./style.css" />
<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script><!---->
<!-- JGModule -->
<script src="../js/JGDataset.1.0.0.js"></script>
<script type="text/javascript">
$(JGDS).on("beforeload",function(){
	var mainData_ = JGDS("mainData");

	mainData_.setColumnValues(mainData_.addRow(),["col1", "100", "col2", "50", "col3", "001"], true);
	mainData_.setColumnValues(mainData_.addRow(),["col1", "150", "col2", "70", "col3", "002"]);
	mainData_.setColumnValues(mainData_.addRow(),["col1", "50", "col2", "-60", "col3", "003"]);
	mainData_.apply();
	
	$(mainData_).on("columnchanged",function(event_,columnName_,rowIndex_){
		printLog("column changed! : "+columnName_+", "+rowIndex_);
		printTotal();
	});
	
	var selectData_ = JGDS("selectData");
	
	selectData_.setColumnValues(selectData_.addRow(),["code", "001", "name", "test1"], true);
	selectData_.setColumnValues(selectData_.addRow(),["code", "002", "name", "test2"]);
	selectData_.setColumnValues(selectData_.addRow(),["code", "003", "name", "test3"]);
	selectData_.apply();
	
	$("#testDataView").on("datasetmapped",function(event_,rowIndex_){
		console.log(rowIndex_);
	});
	
	printTotal();
});

function addRow(){JGDS("mainData").addRow();printTotal();}
function removeRow(){
	var mainData_ = JGDS("mainData");
	if(mainData_.getRowCount() == 0) return;
	mainData_.removeRow(mainData_.getRowCount()-1);
	printTotal();
}
function apply(){JGDS("mainData").apply();printTotal();}
function reset(){JGDS("mainData").reset();printTotal();}
function clear(){JGDS("mainData").clear();printTotal();}
function sortRow(){
	//JGDS("mainData").sortRowByAsc("col1");
	JGDS("mainData").sortRowByDesc("col1");
}
function printTotal(){
	var mainData_ = JGDS("mainData");
	var totalLabel_ = $("#dataset-total");
	totalLabel_.html("<label>COL1 SUM : "+mainData_.sumOfColumnValues("col1")+"</label><br/>");
	totalLabel_.append("<label>COL1 AVG : "+parseInt(mainData_.avgOfColumnValues("col1"))+"</label><br/>");
	totalLabel_.append("<label>COL1 MAX : "+mainData_.maxOfColumnValues("col1")+"</label><br/>");
	totalLabel_.append("<label>COL1 MIN : "+mainData_.minOfColumnValues("col1")+"</label><br/>");
}

function clearLog(){$(".jg-logbox .log-content").html("");}
function printLog(str_){$(".jg-logbox .log-content").append($("<span>"+str_+"</span><br/>"));}
function printDataset(){printLog("-------------<br>"+JGDS("mainData").toJSONString(true	)+"<br>-----------");}
</script>
</head>
<body>
<div data-role="page">
	<div data-role="content">
	
	<table jg-dataset="mainData" id="testDataView">
		<tbody>
		<tr>
			<td><label test-attr="##col1##" dummy="##fx:console.log('test')">##fx:##dataset.rowindex##+1</label></td>
			<td><input jg-column="col1" type="text"></td>
			<td><input jg-column="col2" readonly="##fx:'##col1##' == 'lock' ? readonly : false"></td>
			<td><label><b>COL2 : </b></label><div jg-column="col2" contenteditable></div></td>
			<td><input jg-column="col3"></td>
			<td><select jg-column="col3" jg-bind-dataset="selectData" jg-display-column="name" jg-value-column="code" jg-blank-title="¼±ÅÃ"></select></td>
			<td><label>##fx:(##col1##)-(##col2##)</label><label style="font-size: 11px; color:gray;">(*COL1 - COL2)</label></td>
		</tr>
		</tbody>
	</table>
	<p><label id="dataset-total" style="font-size: 12px;"></label></p>
	
	<a href="javascript:addRow();">add-row</a>
	<a href="javascript:removeRow();">remove-row</a>
	<a href="javascript:apply();">apply</a>
	<a href="javascript:reset();">reset</a>
	<a href="javascript:clear();">clear</a>
	<a href="javascript:sortRow();">sort-row</a>
	<a href="javascript:printDataset();">print-dataset</a>
	
	<div class="jg-logbox">
		<div class="log-content" contenteditable></div>
		<a href="javascript:clearLog();" class="clear">clear</a>
	</div>
	</div>
</div>
</body>
</html>